(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[261],{70127:function(e,t,r){"use strict";function i(){return(null===r.g||void 0===r.g?void 0:r.g.crypto)||(null===r.g||void 0===r.g?void 0:r.g.msCrypto)||{}}function s(){let e=i();return e.subtle||e.webkitSubtle}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserCryptoAvailable=t.getSubtleCrypto=t.getBrowerCrypto=void 0,t.getBrowerCrypto=i,t.getSubtleCrypto=s,t.isBrowserCryptoAvailable=function(){return!!i()&&!!s()}},26962:function(e,t,r){"use strict";var i=r(28611);function s(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function n(){return void 0!==i&&void 0!==i.versions&&void 0!==i.versions.node}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isNode=t.isReactNative=void 0,t.isReactNative=s,t.isNode=n,t.isBrowser=function(){return!s()&&!n()}},97303:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(2772);i.__exportStar(r(70127),t),i.__exportStar(r(26962),t)},2772:function(e,t,r){"use strict";r.r(t),r.d(t,{__assign:function(){return n},__asyncDelegator:function(){return v},__asyncGenerator:function(){return w},__asyncValues:function(){return E},__await:function(){return b},__awaiter:function(){return h},__classPrivateFieldGet:function(){return S},__classPrivateFieldSet:function(){return P},__createBinding:function(){return d},__decorate:function(){return a},__exportStar:function(){return p},__extends:function(){return s},__generator:function(){return u},__importDefault:function(){return D},__importStar:function(){return I},__makeTemplateObject:function(){return _},__metadata:function(){return l},__param:function(){return c},__read:function(){return g},__rest:function(){return o},__spread:function(){return y},__spreadArrays:function(){return m},__values:function(){return f}});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function s(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function o(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)0>t.indexOf(i[s])&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(r[i[s]]=e[i[s]]);return r}function a(e,t,r,i){var s,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}function c(e,t){return function(r,i){t(r,i,e)}}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,i){return new(r||(r=Promise))(function(s,n){function o(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})}function u(e,t){var r,i,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}function d(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}function p(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,s,n=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function m(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),s=0,t=0;t<r;t++)for(var n=arguments[t],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function w(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,s=r.apply(e,t||[]),n=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){s[e]&&(i[e]=function(t){return new Promise(function(r,i){n.push([e,t,r,i])>1||a(e,t)})})}function a(e,t){try{var r;(r=s[e](t)).value instanceof b?Promise.resolve(r.value.v).then(c,l):h(n[0][2],r)}catch(e){h(n[0][3],e)}}function c(e){a("next",e)}function l(e){a("throw",e)}function h(e,t){e(t),n.shift(),n.length&&a(n[0][0],n[0][1])}}function v(e){var t,r;return t={},i("next"),i("throw",function(e){throw e}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,s){t[i]=e[i]?function(t){return(r=!r)?{value:b(e[i](t)),done:"return"===i}:s?s(t):t}:s}}function E(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=f(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise(function(i,s){!function(e,t,r,i){Promise.resolve(i).then(function(t){e({value:t,done:r})},t)}(i,s,(t=e[r](t)).done,t.value)})}}}function _(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function D(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return t.get(e)}function P(e,t,r){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");return t.set(e,r),r}},99670:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(33985);i.__exportStar(r(90273),t),i.__exportStar(r(76930),t)},90273:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_THOUSAND=t.ONE_HUNDRED=void 0,t.ONE_HUNDRED=100,t.ONE_THOUSAND=1e3},76930:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=5*t.ONE_MINUTE,t.TEN_MINUTES=10*t.ONE_MINUTE,t.THIRTY_MINUTES=30*t.ONE_MINUTE,t.SIXTY_MINUTES=60*t.ONE_MINUTE,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=3*t.ONE_HOUR,t.SIX_HOURS=6*t.ONE_HOUR,t.TWELVE_HOURS=12*t.ONE_HOUR,t.TWENTY_FOUR_HOURS=24*t.ONE_HOUR,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=3*t.ONE_DAY,t.FIVE_DAYS=5*t.ONE_DAY,t.SEVEN_DAYS=7*t.ONE_DAY,t.THIRTY_DAYS=30*t.ONE_DAY,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=2*t.ONE_WEEK,t.THREE_WEEKS=3*t.ONE_WEEK,t.FOUR_WEEKS=4*t.ONE_WEEK,t.ONE_YEAR=365*t.ONE_DAY},34901:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(33985);i.__exportStar(r(64462),t),i.__exportStar(r(94809),t),i.__exportStar(r(25442),t),i.__exportStar(r(99670),t)},25442:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(33985);i.__exportStar(r(14680),t)},14680:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IWatch=void 0,t.IWatch=class{}},26686:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromMiliseconds=t.toMiliseconds=void 0;let i=r(99670);t.toMiliseconds=function(e){return e*i.ONE_THOUSAND},t.fromMiliseconds=function(e){return Math.floor(e/i.ONE_THOUSAND)}},19050:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0,t.delay=function(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}},64462:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(33985);i.__exportStar(r(19050),t),i.__exportStar(r(26686),t)},94809:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){let t=this.get(e);if(void 0!==t.elapsed)throw Error(`Watch already stopped for label: ${e}`);let r=Date.now()-t.started;this.timestamps.set(e,{started:t.started,elapsed:r})}get(e){let t=this.timestamps.get(e);if(void 0===t)throw Error(`No timestamp found for label: ${e}`);return t}elapsed(e){let t=this.get(e),r=t.elapsed||Date.now()-t.started;return r}}t.Watch=r,t.default=r},33985:function(e,t,r){"use strict";r.r(t),r.d(t,{__assign:function(){return n},__asyncDelegator:function(){return v},__asyncGenerator:function(){return w},__asyncValues:function(){return E},__await:function(){return b},__awaiter:function(){return h},__classPrivateFieldGet:function(){return S},__classPrivateFieldSet:function(){return P},__createBinding:function(){return d},__decorate:function(){return a},__exportStar:function(){return p},__extends:function(){return s},__generator:function(){return u},__importDefault:function(){return D},__importStar:function(){return I},__makeTemplateObject:function(){return _},__metadata:function(){return l},__param:function(){return c},__read:function(){return g},__rest:function(){return o},__spread:function(){return y},__spreadArrays:function(){return m},__values:function(){return f}});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function s(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function o(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)0>t.indexOf(i[s])&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(r[i[s]]=e[i[s]]);return r}function a(e,t,r,i){var s,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}function c(e,t){return function(r,i){t(r,i,e)}}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,i){return new(r||(r=Promise))(function(s,n){function o(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})}function u(e,t){var r,i,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}function d(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}function p(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,s,n=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function m(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),s=0,t=0;t<r;t++)for(var n=arguments[t],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function w(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,s=r.apply(e,t||[]),n=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){s[e]&&(i[e]=function(t){return new Promise(function(r,i){n.push([e,t,r,i])>1||a(e,t)})})}function a(e,t){try{var r;(r=s[e](t)).value instanceof b?Promise.resolve(r.value.v).then(c,l):h(n[0][2],r)}catch(e){h(n[0][3],e)}}function c(e){a("next",e)}function l(e){a("throw",e)}function h(e,t){e(t),n.shift(),n.length&&a(n[0][0],n[0][1])}}function v(e){var t,r;return t={},i("next"),i("throw",function(e){throw e}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,s){t[i]=e[i]?function(t){return(r=!r)?{value:b(e[i](t)),done:"return"===i}:s?s(t):t}:s}}function E(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=f(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise(function(i,s){!function(e,t,r,i){Promise.resolve(i).then(function(t){e({value:t,done:r})},t)}(i,s,(t=e[r](t)).done,t.value)})}}}function _(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function D(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return t.get(e)}function P(e,t,r){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");return t.set(e,r),r}},57261:function(e,t,r){"use strict";let i;r.r(t),r.d(t,{UniversalProvider:function(){return gZ},default:function(){return gJ}});var s={};r.r(s),r.d(s,{identity:function(){return sk}});var n={};r.r(n),r.d(n,{base2:function(){return sU}});var o={};r.r(o),r.d(o,{base8:function(){return sB}});var a={};r.r(a),r.d(a,{base10:function(){return sL}});var c={};r.r(c),r.d(c,{base16:function(){return sq},base16upper:function(){return s$}});var l={};r.r(l),r.d(l,{base32:function(){return sM},base32hex:function(){return sV},base32hexpad:function(){return sW},base32hexpadupper:function(){return sG},base32hexupper:function(){return sK},base32pad:function(){return sF},base32padupper:function(){return sH},base32upper:function(){return sz},base32z:function(){return sY}});var h={};r.r(h),r.d(h,{base36:function(){return sJ},base36upper:function(){return sZ}});var u={};r.r(u),r.d(u,{base58btc:function(){return sQ},base58flickr:function(){return sX}});var d={};r.r(d),r.d(d,{base64:function(){return s0},base64pad:function(){return s1},base64url:function(){return s2},base64urlpad:function(){return s8}});var p={};r.r(p),r.d(p,{base256emoji:function(){return s4}});var f={};r.r(f),r.d(f,{sha256:function(){return nu},sha512:function(){return nd}});var g={};r.r(g),r.d(g,{identity:function(){return np}});var y={};r.r(y),r.d(y,{code:function(){return ng},decode:function(){return nm},encode:function(){return ny},name:function(){return nf}});var m={};r.r(m),r.d(m,{code:function(){return nE},decode:function(){return nI},encode:function(){return n_},name:function(){return nv}});var b=r(83172),w=r.n(b),v=r(34901);class E{}class _ extends E{constructor(e){super()}}let I=v.FIVE_SECONDS,D={pulse:"heartbeat_pulse"};class S extends _{constructor(e){super(e),this.events=new b.EventEmitter,this.interval=I,this.interval=e?.interval||I}static async init(e){let t=new S(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,v.toMiliseconds)(this.interval))}pulse(){this.events.emit(D.pulse)}}let P=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,O=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,x=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function A(e,t){if("__proto__"===e||"constructor"===e&&t&&"object"==typeof t&&"prototype"in t){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`);return}return t}function C(e,t={}){if("string"!=typeof e)return e;if('"'===e[0]&&'"'===e[e.length-1]&&-1===e.indexOf("\\"))return e.slice(1,-1);let r=e.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!x.test(e)){if(t.strict)throw SyntaxError("[destr] Invalid JSON");return e}try{if(P.test(e)||O.test(e)){if(t.strict)throw Error("[destr] Possible prototype pollution");return JSON.parse(e,A)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}var T=r(27669).Buffer;function N(e,...t){try{var r;return(r=e(...t))&&"function"==typeof r.then?r:Promise.resolve(r)}catch(e){return Promise.reject(e)}}function R(e){if(function(e){let t=typeof e;return null===e||"object"!==t&&"function"!==t}(e))return String(e);if(function(e){let t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}(e)||Array.isArray(e))return JSON.stringify(e);if("function"==typeof e.toJSON)return R(e.toJSON());throw Error("[unstorage] Cannot stringify value!")}let j="base64:";function k(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function U(e){return(e=k(e))?e+":":""}let B=()=>{let e=new Map;return{name:"memory",getInstance:()=>e,hasItem:t=>e.has(t),getItem:t=>e.get(t)??null,getItemRaw:t=>e.get(t)??null,setItem(t,r){e.set(t,r)},setItemRaw(t,r){e.set(t,r)},removeItem(t){e.delete(t)},getKeys:()=>[...e.keys()],clear(){e.clear()},dispose(){e.clear()}}};function L(e,t,r){return e.watch?e.watch((e,i)=>t(e,r+i)):()=>{}}async function q(e){"function"==typeof e.dispose&&await N(e.dispose)}function $(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function M(e,t){let r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);let i=$(r);return(e,r)=>i.then(i=>r(i.transaction(t,e).objectStore(t)))}function z(){return i||(i=M("keyval-store","keyval")),i}function F(e,t=z()){return t("readonly",t=>$(t.get(e)))}let H=e=>JSON.stringify(e,(e,t)=>"bigint"==typeof t?t.toString()+"n":t),V=e=>{let t=e.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3');return JSON.parse(t,(e,t)=>{let r="string"==typeof t&&t.match(/^\d+n$/);return r?BigInt(t.substring(0,t.length-1)):t})};function K(e){if("string"!=typeof e)throw Error(`Cannot safe json parse value of type ${typeof e}`);try{return V(e)}catch(t){return e}}function W(e){return"string"==typeof e?e:H(e)||""}var G=(e={})=>{let t;let r=e.base&&e.base.length>0?`${e.base}:`:"",i=e=>r+e;return e.dbName&&e.storeName&&(t=M(e.dbName,e.storeName)),{name:"idb-keyval",options:e,hasItem:async e=>!(typeof await F(i(e),t)>"u"),getItem:async e=>await F(i(e),t)??null,setItem:(e,r)=>(function(e,t,r=z()){return r("readwrite",r=>(r.put(t,e),$(r.transaction)))})(i(e),r,t),removeItem:e=>(function(e,t=z()){return t("readwrite",t=>(t.delete(e),$(t.transaction)))})(i(e),t),getKeys:()=>(function(e=z()){return e("readonly",e=>{var t;if(e.getAllKeys)return $(e.getAllKeys());let r=[];return(t=e=>r.push(e.key),e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},$(e.transaction)).then(()=>r)})})(t),clear:()=>(function(e=z()){return e("readwrite",e=>(e.clear(),$(e.transaction)))})(t)}};class Y{constructor(){this.indexedDb=function(e={}){let t={mounts:{"":e.driver||B()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=e=>{for(let r of t.mountpoints)if(e.startsWith(r))return{base:r,relativeKey:e.slice(r.length),driver:t.mounts[r]};return{base:"",relativeKey:e,driver:t.mounts[""]}},i=(e,r)=>t.mountpoints.filter(t=>t.startsWith(e)||r&&e.startsWith(t)).map(r=>({relativeBase:e.length>r.length?e.slice(r.length):void 0,mountpoint:r,driver:t.mounts[r]})),s=(e,r)=>{if(t.watching)for(let i of(r=k(r),t.watchListeners))i(e,r)},n=async()=>{if(!t.watching)for(let e in t.watching=!0,t.mounts)t.unwatch[e]=await L(t.mounts[e],s,e)},o=async()=>{if(t.watching){for(let e in t.unwatch)await t.unwatch[e]();t.unwatch={},t.watching=!1}},a=(e,t,i)=>{let s=new Map,n=e=>{let t=s.get(e.base);return t||(t={driver:e.driver,base:e.base,items:[]},s.set(e.base,t)),t};for(let i of e){let e="string"==typeof i,s=k(e?i:i.key),o=e?void 0:i.value,a=e||!i.options?t:{...t,...i.options},c=r(s);n(c).items.push({key:s,value:o,relativeKey:c.relativeKey,options:a})}return Promise.all([...s.values()].map(e=>i(e))).then(e=>e.flat())},c={hasItem(e,t={}){e=k(e);let{relativeKey:i,driver:s}=r(e);return N(s.hasItem,i,t)},getItem(e,t={}){e=k(e);let{relativeKey:i,driver:s}=r(e);return N(s.getItem,i,t).then(e=>C(e))},getItems:(e,t={})=>a(e,t,e=>e.driver.getItems?N(e.driver.getItems,e.items.map(e=>({key:e.relativeKey,options:e.options})),t).then(t=>t.map(t=>({key:function(...e){return k(e.join(":"))}(e.base,t.key),value:C(t.value)}))):Promise.all(e.items.map(t=>N(e.driver.getItem,t.relativeKey,t.options).then(e=>({key:t.key,value:C(e)}))))),getItemRaw(e,t={}){e=k(e);let{relativeKey:i,driver:s}=r(e);return s.getItemRaw?N(s.getItemRaw,i,t):N(s.getItem,i,t).then(e=>{var t;return"string"==typeof e&&e.startsWith(j)?(t=e.slice(j.length),globalThis.Buffer?T.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))):e})},async setItem(e,t,i={}){if(void 0===t)return c.removeItem(e);e=k(e);let{relativeKey:n,driver:o}=r(e);o.setItem&&(await N(o.setItem,n,R(t),i),o.watch||s("update",e))},async setItems(e,t){await a(e,t,async e=>{if(e.driver.setItems)return N(e.driver.setItems,e.items.map(e=>({key:e.relativeKey,value:R(e.value),options:e.options})),t);e.driver.setItem&&await Promise.all(e.items.map(t=>N(e.driver.setItem,t.relativeKey,R(t.value),t.options)))})},async setItemRaw(e,t,i={}){if(void 0===t)return c.removeItem(e,i);e=k(e);let{relativeKey:n,driver:o}=r(e);if(o.setItemRaw)await N(o.setItemRaw,n,t,i);else{if(!o.setItem)return;await N(o.setItem,n,"string"==typeof t?t:j+(globalThis.Buffer?T.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))),i)}o.watch||s("update",e)},async removeItem(e,t={}){"boolean"==typeof t&&(t={removeMeta:t}),e=k(e);let{relativeKey:i,driver:n}=r(e);n.removeItem&&(await N(n.removeItem,i,t),(t.removeMeta||t.removeMata)&&await N(n.removeItem,i+"$",t),n.watch||s("remove",e))},async getMeta(e,t={}){"boolean"==typeof t&&(t={nativeOnly:t}),e=k(e);let{relativeKey:i,driver:s}=r(e),n=Object.create(null);if(s.getMeta&&Object.assign(n,await N(s.getMeta,i,t)),!t.nativeOnly){let e=await N(s.getItem,i+"$",t).then(e=>C(e));e&&"object"==typeof e&&("string"==typeof e.atime&&(e.atime=new Date(e.atime)),"string"==typeof e.mtime&&(e.mtime=new Date(e.mtime)),Object.assign(n,e))}return n},setMeta(e,t,r={}){return this.setItem(e+"$",t,r)},removeMeta(e,t={}){return this.removeItem(e+"$",t)},async getKeys(e,t={}){e=U(e);let r=i(e,!0),s=[],n=[],o=!0;for(let e of r){e.driver.flags?.maxDepth||(o=!1);let r=await N(e.driver.getKeys,e.relativeBase,t);for(let t of r){let r=e.mountpoint+k(t);s.some(e=>r.startsWith(e))||n.push(r)}s=[e.mountpoint,...s.filter(t=>!t.startsWith(e.mountpoint))]}let a=void 0!==t.maxDepth&&!o;return n.filter(r=>{var i;return(!a||function(e,t){if(void 0===t)return!0;let r=0,i=e.indexOf(":");for(;i>-1;)r++,i=e.indexOf(":",i+1);return r<=t}(r,t.maxDepth))&&((i=e)?r.startsWith(i)&&"$"!==r[r.length-1]:"$"!==r[r.length-1])})},async clear(e,t={}){e=U(e),await Promise.all(i(e,!1).map(async e=>{if(e.driver.clear)return N(e.driver.clear,e.relativeBase,t);if(e.driver.removeItem){let r=await e.driver.getKeys(e.relativeBase||"",t);return Promise.all(r.map(r=>e.driver.removeItem(r,t)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(e=>q(e)))},watch:async e=>(await n(),t.watchListeners.push(e),async()=>{t.watchListeners=t.watchListeners.filter(t=>t!==e),0===t.watchListeners.length&&await o()}),async unwatch(){t.watchListeners=[],await o()},mount(e,r){if((e=U(e))&&t.mounts[e])throw Error(`already mounted at ${e}`);return e&&(t.mountpoints.push(e),t.mountpoints.sort((e,t)=>t.length-e.length)),t.mounts[e]=r,t.watching&&Promise.resolve(L(r,s,e)).then(r=>{t.unwatch[e]=r}).catch(console.error),c},async unmount(e,r=!0){(e=U(e))&&t.mounts[e]&&(t.watching&&e in t.unwatch&&(t.unwatch[e]?.(),delete t.unwatch[e]),r&&await q(t.mounts[e]),t.mountpoints=t.mountpoints.filter(t=>t!==e),delete t.mounts[e])},getMount(e=""){e=k(e)+":";let t=r(e);return{driver:t.driver,base:t.base}},getMounts(e="",t={}){e=k(e);let r=i(e,t.parents);return r.map(e=>({driver:e.driver,base:e.mountpoint}))},keys:(e,t={})=>c.getKeys(e,t),get:(e,t={})=>c.getItem(e,t),set:(e,t,r={})=>c.setItem(e,t,r),has:(e,t={})=>c.hasItem(e,t),del:(e,t={})=>c.removeItem(e,t),remove:(e,t={})=>c.removeItem(e,t)};return c}({driver:G({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){let t=await this.indexedDb.getItem(e);if(null!==t)return t}async setItem(e,t){await this.indexedDb.setItem(e,W(t))}async removeItem(e){await this.indexedDb.removeItem(e)}}var J="u">typeof globalThis?globalThis:"u">typeof window?window:"u">typeof r.g?r.g:"u">typeof self?self:{},Z={exports:{}};function Q(e){var t;return[e[0],K(null!=(t=e[1])?t:"")]}!function(){function e(){}e.prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},e.prototype.setItem=function(e,t){this[e]=String(t)},e.prototype.removeItem=function(e){delete this[e]},e.prototype.clear=function(){let e=this;Object.keys(e).forEach(function(t){e[t]=void 0,delete e[t]})},e.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),"u">typeof J&&J.localStorage?Z.exports=J.localStorage:"u">typeof window&&window.localStorage?Z.exports=window.localStorage:Z.exports=new e}();class X{constructor(){this.localStorage=Z.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Q)}async getItem(e){let t=this.localStorage.getItem(e);if(null!==t)return K(t)}async setItem(e,t){this.localStorage.setItem(e,W(t))}async removeItem(e){this.localStorage.removeItem(e)}}let ee=async(e,t,r)=>{let i="wc_storage_version",s=await t.getItem(i);if(s&&s>=1){r(t);return}let n=await e.getKeys();if(!n.length){r(t);return}let o=[];for(;n.length;){let r=n.shift();if(!r)continue;let i=r.toLowerCase();if(i.includes("wc@")||i.includes("walletconnect")||i.includes("wc_")||i.includes("wallet_connect")){let i=await e.getItem(r);await t.setItem(r,i),o.push(r)}}await t.setItem(i,1),r(t),et(e,o)},et=async(e,t)=>{t.length&&t.forEach(async t=>{await e.removeItem(t)})};class er{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};let e=new X;this.storage=e;try{let t=new Y;ee(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{let t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}}var ei=r(60554),es=r.n(ei);let en={level:"info"},eo="custom_context";class ea{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class ec{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let t=new ea(e);if(t.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let t=e.value;return e=e.next,{done:!1,value:t}}}}}class el{constructor(e,t=1024e3){this.level=e??"error",this.levelValue=ei.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new ec(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===ei.levels.values.error?console.error(e):t===ei.levels.values.warn?console.warn(e):t===ei.levels.values.debug?console.debug(e):t===ei.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(W({timestamp:new Date().toISOString(),log:e}));let t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new ec(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let t=this.getLogArray();return t.push(W({extraMetadata:e})),new Blob(t,{type:"application/json"})}}class eh{constructor(e,t=1024e3){this.baseChunkLogger=new el(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let t=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=t,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}class eu{constructor(e,t=1024e3){this.baseChunkLogger=new el(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var ed=Object.defineProperty,ep=Object.defineProperties,ef=Object.getOwnPropertyDescriptors,eg=Object.getOwnPropertySymbols,ey=Object.prototype.hasOwnProperty,em=Object.prototype.propertyIsEnumerable,eb=(e,t,r)=>t in e?ed(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ew=(e,t)=>{for(var r in t||(t={}))ey.call(t,r)&&eb(e,r,t[r]);if(eg)for(var r of eg(t))em.call(t,r)&&eb(e,r,t[r]);return e},ev=(e,t)=>ep(e,ef(t));function eE(e){return ev(ew({},e),{level:e?.level||en.level})}function e_(e,t=eo){return typeof e.bindings>"u"?function(e,t=eo){return e[t]||""}(e,t):e.bindings().context||""}function eI(e,t,r=eo){let i=function(e,t,r=eo){let i=e_(e,r);return i.trim()?`${i}/${t}`:t}(e,t,r),s=e.child({context:i});return function(e,t,r=eo){return e[r]=t,e}(s,i,r)}var eD=Object.defineProperty,eS=(e,t,r)=>t in e?eD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,eP=(e,t,r)=>eS(e,"symbol"!=typeof t?t+"":t,r);class eO extends E{constructor(e){super(),this.opts=e,eP(this,"protocol","wc"),eP(this,"version",2)}}var ex=Object.defineProperty,eA=(e,t,r)=>t in e?ex(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,eC=(e,t,r)=>eA(e,"symbol"!=typeof t?t+"":t,r);class eT extends E{constructor(e,t){super(),this.core=e,this.logger=t,eC(this,"records",new Map)}}class eN{constructor(e,t){this.logger=e,this.core=t}}class eR extends E{constructor(e,t){super(),this.relayer=e,this.logger=t}}class ej extends E{constructor(e){super()}}class ek{constructor(e,t,r,i){this.core=e,this.logger=t,this.name=r}}class eU extends E{constructor(e,t){super(),this.relayer=e,this.logger=t}}class eB extends E{constructor(e,t){super(),this.core=e,this.logger=t}}class eL{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}}class eq{constructor(e,t){this.projectId=e,this.logger=t}}class e${constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}}var eM=Object.defineProperty,ez=(e,t,r)=>t in e?eM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,eF=(e,t,r)=>ez(e,"symbol"!=typeof t?t+"":t,r);class eH{constructor(e){this.opts=e,eF(this,"protocol","wc"),eF(this,"version",2)}}class eV{constructor(e){this.client=e}}function eK(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function eW(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}let eG="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,eY=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function eJ(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}(e)),eK(e),e}class eZ{clone(){return this._cloneInto()}}function eQ(e=32){if(eG&&"function"==typeof eG.getRandomValues)return eG.getRandomValues(new Uint8Array(e));if(eG&&"function"==typeof eG.randomBytes)return eG.randomBytes(e);throw Error("crypto.getRandomValues must be defined")}class eX extends eZ{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=eY(this.buffer)}update(e){eW(this);let{view:t,buffer:r,blockLen:i}=this;e=eJ(e);let s=e.length;for(let n=0;n<s;){let o=Math.min(i-this.pos,s-n);if(o===i){let t=eY(e);for(;i<=s-n;n+=i)this.process(t,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){eW(this),function(e,t){eK(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:i,isLE:s}=this,{pos:n}=this;t[n++]=128,this.buffer.subarray(n).fill(0),this.padOffset>i-n&&(this.process(r,0),n=0);for(let e=n;e<i;e++)t[e]=0;(function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+l,a,i)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);let o=eY(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let c=a/4,l=this.get();if(c>l.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,l[e],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:s,destroyed:n,pos:o}=this;return e.length=i,e.pos=o,e.finished=s,e.destroyed=n,i%t&&e.buffer.set(r),e}}let e0=BigInt(4294967296-1),e1=BigInt(32);function e2(e,t=!1){return t?{h:Number(e&e0),l:Number(e>>e1&e0)}:{h:0|Number(e>>e1&e0),l:0|Number(e&e0)}}let e8={fromBig:e2,split:function(e,t=!1){let r=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let s=0;s<e.length;s++){let{h:n,l:o}=e2(e[s],t);[r[s],i[s]]=[n,o]}return[r,i]},toBig:(e,t)=>BigInt(e>>>0)<<e1|BigInt(t>>>0),shrSH:(e,t,r)=>e>>>r,shrSL:(e,t,r)=>e<<32-r|t>>>r,rotrSH:(e,t,r)=>e>>>r|t<<32-r,rotrSL:(e,t,r)=>e<<32-r|t>>>r,rotrBH:(e,t,r)=>e<<64-r|t>>>r-32,rotrBL:(e,t,r)=>e>>>r-32|t<<64-r,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:(e,t,r)=>e<<r|t>>>32-r,rotlSL:(e,t,r)=>t<<r|e>>>32-r,rotlBH:(e,t,r)=>t<<r-32|e>>>64-r,rotlBL:(e,t,r)=>e<<r-32|t>>>64-r,add:function(e,t,r,i){let s=(t>>>0)+(i>>>0);return{h:e+r+(s/4294967296|0)|0,l:0|s}},add3L:(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),add3H:(e,t,r,i)=>t+r+i+(e/4294967296|0)|0,add4L:(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),add4H:(e,t,r,i,s)=>t+r+i+s+(e/4294967296|0)|0,add5H:(e,t,r,i,s,n)=>t+r+i+s+n+(e/4294967296|0)|0,add5L:(e,t,r,i,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(s>>>0)},[e3,e5]=e8.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),e6=new Uint32Array(80),e4=new Uint32Array(80);class e9 extends eX{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:n,Dh:o,Dl:a,Eh:c,El:l,Fh:h,Fl:u,Gh:d,Gl:p,Hh:f,Hl:g}=this;return[e,t,r,i,s,n,o,a,c,l,h,u,d,p,f,g]}set(e,t,r,i,s,n,o,a,c,l,h,u,d,p,f,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|s,this.Cl=0|n,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|l,this.Fh=0|h,this.Fl=0|u,this.Gh=0|d,this.Gl=0|p,this.Hh=0|f,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)e6[r]=e.getUint32(t),e4[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|e6[e-15],r=0|e4[e-15],i=e8.rotrSH(t,r,1)^e8.rotrSH(t,r,8)^e8.shrSH(t,r,7),s=e8.rotrSL(t,r,1)^e8.rotrSL(t,r,8)^e8.shrSL(t,r,7),n=0|e6[e-2],o=0|e4[e-2],a=e8.rotrSH(n,o,19)^e8.rotrBH(n,o,61)^e8.shrSH(n,o,6),c=e8.rotrSL(n,o,19)^e8.rotrBL(n,o,61)^e8.shrSL(n,o,6),l=e8.add4L(s,c,e4[e-7],e4[e-16]),h=e8.add4H(l,i,a,e6[e-7],e6[e-16]);e6[e]=0|h,e4[e]=0|l}let{Ah:r,Al:i,Bh:s,Bl:n,Ch:o,Cl:a,Dh:c,Dl:l,Eh:h,El:u,Fh:d,Fl:p,Gh:f,Gl:g,Hh:y,Hl:m}=this;for(let e=0;e<80;e++){let t=e8.rotrSH(h,u,14)^e8.rotrSH(h,u,18)^e8.rotrBH(h,u,41),b=e8.rotrSL(h,u,14)^e8.rotrSL(h,u,18)^e8.rotrBL(h,u,41),w=h&d^~h&f,v=u&p^~u&g,E=e8.add5L(m,b,v,e5[e],e4[e]),_=e8.add5H(E,y,t,w,e3[e],e6[e]),I=0|E,D=e8.rotrSH(r,i,28)^e8.rotrBH(r,i,34)^e8.rotrBH(r,i,39),S=e8.rotrSL(r,i,28)^e8.rotrBL(r,i,34)^e8.rotrBL(r,i,39),P=r&s^r&o^s&o,O=i&n^i&a^n&a;y=0|f,m=0|g,f=0|d,g=0|p,d=0|h,p=0|u,({h:h,l:u}=e8.add(0|c,0|l,0|_,0|I)),c=0|o,l=0|a,o=0|s,a=0|n,s=0|r,n=0|i;let x=e8.add3L(I,S,O);r=e8.add3H(x,_,D,P),i=0|x}({h:r,l:i}=e8.add(0|this.Ah,0|this.Al,0|r,0|i)),({h:s,l:n}=e8.add(0|this.Bh,0|this.Bl,0|s,0|n)),({h:o,l:a}=e8.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:l}=e8.add(0|this.Dh,0|this.Dl,0|c,0|l)),({h:h,l:u}=e8.add(0|this.Eh,0|this.El,0|h,0|u)),({h:d,l:p}=e8.add(0|this.Fh,0|this.Fl,0|d,0|p)),({h:f,l:g}=e8.add(0|this.Gh,0|this.Gl,0|f,0|g)),({h:y,l:m}=e8.add(0|this.Hh,0|this.Hl,0|y,0|m)),this.set(r,i,s,n,o,a,c,l,h,u,d,p,f,g,y,m)}roundClean(){e6.fill(0),e4.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let e7=function(e){let t=t=>e().update(eJ(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}(()=>new e9),te=BigInt(0),tt=BigInt(1),tr=BigInt(2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ti(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function ts(e){if(!ti(e))throw Error("Uint8Array expected")}function tn(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)}let to=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ta(e){ts(e);let t="";for(let r=0;r<e.length;r++)t+=to[e[r]];return t}function tc(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?te:BigInt("0x"+e)}let tl={_0:48,_9:57,A:65,F:70,a:97,f:102};function th(e){return e>=tl._0&&e<=tl._9?e-tl._0:e>=tl.A&&e<=tl.F?e-(tl.A-10):e>=tl.a&&e<=tl.f?e-(tl.a-10):void 0}function tu(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,s=0;t<r;t++,s+=2){let r=th(e.charCodeAt(s)),n=th(e.charCodeAt(s+1));if(void 0===r||void 0===n){let t=e[s]+e[s+1];throw Error('hex string expected, got non-hex character "'+t+'" at index '+s)}i[t]=16*r+n}return i}function td(e){return ts(e),tc(ta(Uint8Array.from(e).reverse()))}function tp(e,t){return tu(e.toString(16).padStart(2*t,"0"))}function tf(e,t){return tp(e,t).reverse()}function tg(e,t,r){let i;if("string"==typeof t)try{i=tu(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(ti(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let s=i.length;if("number"==typeof r&&s!==r)throw Error(e+" of length "+r+" expected, got "+s);return i}function ty(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];ts(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let s=e[t];r.set(s,i),i+=s.length}return r}let tm=e=>"bigint"==typeof e&&te<=e;function tb(e,t,r,i){if(!(tm(t)&&tm(r)&&tm(i))||!(r<=t)||!(t<i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}let tw=e=>(tr<<BigInt(e-1))-tt,tv={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||ti(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function tE(e,t,r={}){let i=(t,r,i)=>{let s=tv[r];if("function"!=typeof s)throw Error("invalid validator function");let n=e[t];if(!(i&&void 0===n)&&!s(n,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+n)};for(let[e,r]of Object.entries(t))i(e,r,!1);for(let[e,t]of Object.entries(r))i(e,t,!0);return e}function t_(e){let t=new WeakMap;return(r,...i)=>{let s=t.get(r);if(void 0!==s)return s;let n=e(r,...i);return t.set(r,n),n}}let tI=BigInt(0),tD=BigInt(1),tS=BigInt(2),tP=BigInt(3),tO=BigInt(4),tx=BigInt(5),tA=BigInt(8);function tC(e,t){let r=e%t;return r>=tI?r:t+r}function tT(e,t,r){let i=e;for(;t-- >tI;)i*=i,i%=r;return i}function tN(e,t){if(e===tI)throw Error("invert: expected non-zero number");if(t<=tI)throw Error("invert: expected positive modulus, got "+t);let r=tC(e,t),i=t,s=tI,n=tD;for(;r!==tI;){let e=i/r,t=i%r,o=s-n*e;i=r,r=t,s=n,n=o}if(i!==tD)throw Error("invert: does not exist");return tC(s,t)}let tR=(e,t)=>(tC(e,t)&tD)===tD,tj=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function tk(e,t){let r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function tU(e,t,r=!1,i={}){let s;if(e<=tI)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:n,nByteLength:o}=tk(e,t);if(o>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let a=Object.freeze({ORDER:e,isLE:r,BITS:n,BYTES:o,MASK:tw(n),ZERO:tI,ONE:tD,create:t=>tC(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return tI<=t&&t<e},is0:e=>e===tI,isOdd:e=>(e&tD)===tD,neg:t=>tC(-t,e),eql:(e,t)=>e===t,sqr:t=>tC(t*t,e),add:(t,r)=>tC(t+r,e),sub:(t,r)=>tC(t-r,e),mul:(t,r)=>tC(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<tI)throw Error("invalid exponent, negatives unsupported");if(r===tI)return e.ONE;if(r===tD)return t;let i=e.ONE,s=t;for(;r>tI;)r&tD&&(i=e.mul(i,s)),s=e.sqr(s),r>>=tD;return i})(a,e,t),div:(t,r)=>tC(t*tN(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>tN(t,e),sqrt:i.sqrt||(t=>(s||(s=function(e){if(e%tO===tP){let t=(e+tD)/tO;return function(e,r){let i=e.pow(r,t);if(!e.eql(e.sqr(i),r))throw Error("Cannot find square root");return i}}if(e%tA===tx){let t=(e-tx)/tA;return function(e,r){let i=e.mul(r,tS),s=e.pow(i,t),n=e.mul(r,s),o=e.mul(e.mul(n,tS),s),a=e.mul(n,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),r))throw Error("Cannot find square root");return a}}return function(e){let t,r,i;let s=(e-tD)/tS;for(t=e-tD,r=0;t%tS===tI;t/=tS,r++);for(i=tS;i<e&&function(e,t,r){if(t<tI)throw Error("invalid exponent, negatives unsupported");if(r<=tI)throw Error("invalid modulus");if(r===tD)return tI;let i=tD;for(;t>tI;)t&tD&&(i=i*e%r),e=e*e%r,t>>=tD;return i}(i,s,e)!==e-tD;i++)if(i>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===r){let t=(e+tD)/tO;return function(e,r){let i=e.pow(r,t);if(!e.eql(e.sqr(i),r))throw Error("Cannot find square root");return i}}let n=(t+tD)/tS;return function(e,o){if(e.pow(o,s)===e.neg(e.ONE))throw Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),t),l=e.pow(o,n),h=e.pow(o,t);for(;!e.eql(h,e.ONE);){if(e.eql(h,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(h);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(c,tD<<BigInt(a-t-1));c=e.sqr(r),l=e.mul(l,r),h=e.mul(h,c),a=t}return l}}(e)}(e)),s(a,t))),invertBatch:e=>(function(e,t){let r=Array(t.length),i=t.reduce((t,i,s)=>e.is0(i)?t:(r[s]=t,e.mul(t,i)),e.ONE),s=e.inv(i);return t.reduceRight((t,i,s)=>e.is0(i)?t:(r[s]=e.mul(t,r[s]),e.mul(t,i)),s),r})(a,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?tf(e,o):tp(e,o),fromBytes:e=>{if(e.length!==o)throw Error("Field.fromBytes: expected "+o+" bytes, got "+e.length);return r?td(e):tc(ta(e))}});return Object.freeze(a)}let tB=BigInt(0),tL=BigInt(1);function tq(e,t){let r=t.negate();return e?r:t}function t$(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function tM(e,t){t$(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1);return{windows:r,windowSize:i}}let tz=new WeakMap,tF=new WeakMap;function tH(e){return tF.get(e)||1}let tV=BigInt(0),tK=BigInt(1),tW=BigInt(2),tG=BigInt(8),tY={zip215:!0};BigInt(0),BigInt(1);let tJ=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),tZ=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let tQ=BigInt(1),tX=BigInt(2);BigInt(3);let t0=BigInt(5),t1=BigInt(8),t2=tU(tJ,void 0,!0),t8={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:t2,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:t1,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:e7,randomBytes:eQ,adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e},uvRatio:function(e,t){let r=tC(t*t*t,tJ),i=tC(r*r*t,tJ),s=function(e){let t=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=e*e%tJ*e%tJ,o=tT(n,tX,tJ)*n%tJ,a=tT(o,tQ,tJ)*e%tJ,c=tT(a,t0,tJ)*a%tJ,l=tT(c,t,tJ)*c%tJ,h=tT(l,r,tJ)*l%tJ,u=tT(h,i,tJ)*h%tJ,d=tT(u,s,tJ)*u%tJ,p=tT(d,s,tJ)*u%tJ,f=tT(p,t,tJ)*c%tJ;return{pow_p_5_8:tT(f,tX,tJ)*e%tJ,b2:n}}(e*i).pow_p_5_8,n=tC(e*r*s,tJ),o=tC(t*n*n,tJ),a=n,c=tC(n*tZ,tJ),l=o===e,h=o===tC(-e,tJ),u=o===tC(-e*tZ,tJ);return l&&(n=a),(h||u)&&(n=c),tR(n,tJ)&&(n=tC(-n,tJ)),{isValid:l||h,value:n}}},t3=function(e){var t;let r=function(e){let t=(function(e){let t=tj.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});tE(e,t)}(e.Fp),tE(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...tk(e.n,e.nBitLength),...e,p:e.Fp.ORDER}));return tE(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:i,n:s,prehash:n,hash:o,randomBytes:a,nByteLength:c,h:l}=r,h=tW<<BigInt(8*c)-tK,u=i.create,d=tU(r.n,r.nBitLength),p=r.uvRatio||((e,t)=>{try{return{isValid:!0,value:i.sqrt(e*i.inv(t))}}catch{return{isValid:!1,value:tV}}}),f=r.adjustScalarBytes||(e=>e),g=r.domain||((e,t,r)=>{if(tn("phflag",r),t.length||r)throw Error("Contexts/pre-hash are not supported");return e});function y(e,t){tb("coordinate "+e,t,tV,h)}function m(e){if(!(e instanceof v))throw Error("ExtendedPoint expected")}let b=t_((e,t)=>{let{ex:r,ey:s,ez:n}=e,o=e.is0();null==t&&(t=o?tG:i.inv(n));let a=u(r*t),c=u(s*t),l=u(n*t);if(o)return{x:tV,y:tK};if(l!==tK)throw Error("invZ was invalid");return{x:a,y:c}}),w=t_(e=>{let{a:t,d:i}=r;if(e.is0())throw Error("bad point: ZERO");let{ex:s,ey:n,ez:o,et:a}=e,c=u(s*s),l=u(n*n),h=u(o*o),d=u(h*h),p=u(c*t),f=u(h*u(p+l)),g=u(d+u(i*u(c*l)));if(f!==g)throw Error("bad point: equation left != right (1)");let y=u(s*n),m=u(o*a);if(y!==m)throw Error("bad point: equation left != right (2)");return!0});class v{constructor(e,t,r,i){this.ex=e,this.ey=t,this.ez=r,this.et=i,y("x",e),y("y",t),y("z",r),y("t",i),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof v)throw Error("extended point not allowed");let{x:t,y:r}=e||{};return y("x",t),y("y",r),new v(t,r,tK,u(t*r))}static normalizeZ(e){let t=i.invertBatch(e.map(e=>e.ez));return e.map((e,r)=>e.toAffine(t[r])).map(v.fromAffine)}static msm(e,t){return function(e,t,r,i){if(function(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})}(r,e),function(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}(i,t),r.length!==i.length)throw Error("arrays of points and scalars must have equal length");let s=e.ZERO,n=function(e){let t;for(t=0;e>te;e>>=tt,t+=1);return t}(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=Array(a+1).fill(s),l=Math.floor((t.BITS-1)/o)*o,h=s;for(let e=l;e>=0;e-=o){c.fill(s);for(let t=0;t<i.length;t++){let s=i[t],n=Number(s>>BigInt(e)&BigInt(a));c[n]=c[n].add(r[t])}let t=s;for(let e=c.length-1,r=s;e>0;e--)r=r.add(c[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<o;e++)h=h.double()}return h}(v,d,e,t)}_setWindowSize(e){I.setWindowSize(this,e)}assertValidity(){w(this)}equals(e){m(e);let{ex:t,ey:r,ez:i}=this,{ex:s,ey:n,ez:o}=e,a=u(t*o),c=u(s*i),l=u(r*o),h=u(n*i);return a===c&&l===h}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:e}=r,{ex:t,ey:i,ez:s}=this,n=u(t*t),o=u(i*i),a=u(tW*u(s*s)),c=u(e*n),l=t+i,h=u(u(l*l)-n-o),d=c+o,p=d-a,f=c-o,g=u(h*p),y=u(d*f),m=u(h*f),b=u(p*d);return new v(g,y,b,m)}add(e){m(e);let{a:t,d:i}=r,{ex:s,ey:n,ez:o,et:a}=this,{ex:c,ey:l,ez:h,et:d}=e;if(t===BigInt(-1)){let e=u((n-s)*(l+c)),t=u((n+s)*(l-c)),r=u(t-e);if(r===tV)return this.double();let i=u(o*tW*d),p=u(a*tW*h),f=p+i,g=t+e,y=p-i,m=u(f*r),b=u(g*y),w=u(f*y),E=u(r*g);return new v(m,b,E,w)}let p=u(s*c),f=u(n*l),g=u(a*i*d),y=u(o*h),b=u((s+n)*(c+l)-p-f),w=y-g,E=y+g,_=u(f-t*p),I=u(b*w),D=u(E*_),S=u(b*_),P=u(w*E);return new v(I,D,P,S)}subtract(e){return this.add(e.negate())}wNAF(e){return I.wNAFCached(this,e,v.normalizeZ)}multiply(e){tb("scalar",e,tK,s);let{p:t,f:r}=this.wNAF(e);return v.normalizeZ([t,r])[0]}multiplyUnsafe(e,t=v.ZERO){return tb("scalar",e,tV,s),e===tV?_:this.is0()||e===tK?this:I.wNAFCachedUnsafe(this,e,v.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return I.unsafeLadder(this,s).is0()}toAffine(e){return b(this,e)}clearCofactor(){let{h:e}=r;return e===tK?this:this.multiplyUnsafe(e)}static fromHex(e,t=!1){let{d:s,a:n}=r,o=i.BYTES;e=tg("pointHex",e,o),tn("zip215",t);let a=e.slice(),c=e[o-1];a[o-1]=-129&c;let l=td(a),d=t?h:i.ORDER;tb("pointHex.y",l,tV,d);let f=u(l*l),g=u(f-tK),y=u(s*f-n),{isValid:m,value:b}=p(g,y);if(!m)throw Error("Point.fromHex: invalid y coordinate");let w=(b&tK)===tK,E=(128&c)!=0;if(!t&&b===tV&&E)throw Error("Point.fromHex: x=0 and x_0=1");return E!==w&&(b=u(-b)),v.fromAffine({x:b,y:l})}static fromPrivateKey(e){return D(e).point}toRawBytes(){let{x:e,y:t}=this.toAffine(),r=tf(t,i.BYTES);return r[r.length-1]|=e&tK?128:0,r}toHex(){return ta(this.toRawBytes())}}v.BASE=new v(r.Gx,r.Gy,tK,u(r.Gx*r.Gy)),v.ZERO=new v(tV,tK,tK,tV);let{BASE:E,ZERO:_}=v,I=(t=8*c,{constTimeNegate:tq,hasPrecomputes:e=>1!==tH(e),unsafeLadder(e,t,r=v.ZERO){let i=e;for(;t>tB;)t&tL&&(r=r.add(i)),i=i.double(),t>>=tL;return r},precomputeWindow(e,r){let{windows:i,windowSize:s}=tM(r,t),n=[],o=e,a=o;for(let e=0;e<i;e++){a=o,n.push(a);for(let e=1;e<s;e++)a=a.add(o),n.push(a);o=a.double()}return n},wNAF(e,r,i){let{windows:s,windowSize:n}=tM(e,t),o=v.ZERO,a=v.BASE,c=BigInt(2**e-1),l=2**e,h=BigInt(e);for(let e=0;e<s;e++){let t=e*n,s=Number(i&c);i>>=h,s>n&&(s-=l,i+=tL);let u=t+Math.abs(s)-1,d=e%2!=0,p=s<0;0===s?a=a.add(tq(d,r[t])):o=o.add(tq(p,r[u]))}return{p:o,f:a}},wNAFUnsafe(e,r,i,s=v.ZERO){let{windows:n,windowSize:o}=tM(e,t),a=BigInt(2**e-1),c=2**e,l=BigInt(e);for(let e=0;e<n;e++){let t=e*o;if(i===tB)break;let n=Number(i&a);if(i>>=l,n>o&&(n-=c,i+=tL),0===n)continue;let h=r[t+Math.abs(n)-1];n<0&&(h=h.negate()),s=s.add(h)}return s},getPrecomputes(e,t,r){let i=tz.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&tz.set(t,r(i))),i},wNAFCached(e,t,r){let i=tH(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)},wNAFCachedUnsafe(e,t,r,i){let s=tH(e);return 1===s?this.unsafeLadder(e,t,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,i)},setWindowSize(e,r){t$(r,t),tF.set(e,r),tz.delete(e)}});function D(e){let t=i.BYTES;e=tg("private key",e,t);let r=tg("hashed private key",o(e),2*t),n=f(r.slice(0,t)),a=r.slice(t,2*t),c=tC(td(n),s),l=E.multiply(c),h=l.toRawBytes();return{head:n,prefix:a,scalar:c,point:l,pointBytes:h}}function S(e=new Uint8Array,...t){let r=ty(...t);return tC(td(o(g(r,tg("context",e),!!n))),s)}return E._setWindowSize(8),{CURVE:r,getPublicKey:function(e){return D(e).pointBytes},sign:function(e,t,r={}){e=tg("message",e),n&&(e=n(e));let{prefix:o,scalar:a,pointBytes:c}=D(t),l=S(r.context,o,e),h=E.multiply(l).toRawBytes(),u=S(r.context,h,c,e),d=tC(l+u*a,s);tb("signature.s",d,tV,s);let p=ty(h,tf(d,i.BYTES));return tg("result",p,2*i.BYTES)},verify:function(e,t,r,s=tY){let o,a,c;let{context:l,zip215:h}=s,u=i.BYTES;e=tg("signature",e,2*u),t=tg("message",t),r=tg("publicKey",r,u),void 0!==h&&tn("zip215",h),n&&(t=n(t));let d=td(e.slice(u,2*u));try{o=v.fromHex(r,h),a=v.fromHex(e.slice(0,u),h),c=E.multiplyUnsafe(d)}catch{return!1}if(!h&&o.isSmallOrder())return!1;let p=S(l,a.toRawBytes(),o.toRawBytes(),t);return a.add(o.multiplyUnsafe(p)).subtract(c).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:D,randomPrivateKey:()=>a(i.BYTES),precompute:(e=8,t=v.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}}(t8),t5="base64url",t6="utf8",t4="utf8",t9="base58btc";function t7(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function re(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?t7(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function rt(e,t){t||(t=e.reduce((e,t)=>e+t.length,0));let r=re(t),i=0;for(let t of e)r.set(t,i),i+=t.length;return t7(r)}var rr=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),o=n.charCodeAt(0);if(255!==r[o])throw TypeError(n+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var i=0,s=0;e[t]===c;)i++,t++;for(var n=(e.length-t)*l+1>>>0,o=new Uint8Array(n);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=n-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=n-s;p!==n&&0===o[p];)p++;for(var f=new Uint8Array(i+(n-p)),g=i;p!==n;)f[g++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,s=0,n=t.length;s!==n&&0===t[s];)s++,r++;for(var o=(n-s)*h+1>>>0,l=new Uint8Array(o);s!==n;){for(var u=t[s],d=0,p=o-1;(0!==u||d<i)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw Error("Non-zero carry");i=d,s++}for(var f=o-i;f!==o&&0===l[f];)f++;for(var g=c.repeat(r);f<o;++f)g+=e.charAt(l[f]);return g},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}};let ri=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")},rs=e=>new TextEncoder().encode(e),rn=e=>new TextDecoder().decode(e);class ro{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ra{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return rl(this,e)}}class rc{constructor(e){this.decoders=e}or(e){return rl(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let rl=(e,t)=>new rc({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class rh{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new ro(e,t,r),this.decoder=new ra(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let ru=({name:e,prefix:t,encode:r,decode:i})=>new rh(e,t,r,i),rd=({prefix:e,name:t,alphabet:r})=>{let{encode:i,decode:s}=rr(r,t);return ru({prefix:e,name:t,encode:i,decode:e=>ri(s(e))})},rp=(e,t,r,i)=>{let s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let n=e.length;for(;"="===e[n-1];)--n;let o=new Uint8Array(n*r/8|0),a=0,c=0,l=0;for(let t=0;t<n;++t){let n=s[e[t]];if(void 0===n)throw SyntaxError(`Non-${i} character`);c=c<<r|n,(a+=r)>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw SyntaxError("Unexpected end of data");return o},rf=(e,t,r)=>{let i="="===t[t.length-1],s=(1<<r)-1,n="",o=0,a=0;for(let i=0;i<e.length;++i)for(a=a<<8|e[i],o+=8;o>r;)o-=r,n+=t[s&a>>o];if(o&&(n+=t[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},rg=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>ru({prefix:t,name:e,encode:e=>rf(e,i,r),decode:t=>rp(t,i,r,e)}),ry=ru({prefix:"\x00",name:"identity",encode:e=>rn(e),decode:e=>rs(e)});var rm=Object.freeze({__proto__:null,identity:ry});let rb=rg({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rw=Object.freeze({__proto__:null,base2:rb});let rv=rg({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var rE=Object.freeze({__proto__:null,base8:rv});let r_=rd({prefix:"9",name:"base10",alphabet:"0123456789"});var rI=Object.freeze({__proto__:null,base10:r_});let rD=rg({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rS=rg({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rP=Object.freeze({__proto__:null,base16:rD,base16upper:rS});let rO=rg({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rx=rg({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rA=rg({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rC=rg({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rT=rg({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),rN=rg({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),rR=rg({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rj=rg({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rk=rg({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var rU=Object.freeze({__proto__:null,base32:rO,base32upper:rx,base32pad:rA,base32padupper:rC,base32hex:rT,base32hexupper:rN,base32hexpad:rR,base32hexpadupper:rj,base32z:rk});let rB=rd({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rL=rd({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var rq=Object.freeze({__proto__:null,base36:rB,base36upper:rL});let r$=rd({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),rM=rd({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var rz=Object.freeze({__proto__:null,base58btc:r$,base58flickr:rM});let rF=rg({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),rH=rg({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rV=rg({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rK=rg({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var rW=Object.freeze({__proto__:null,base64:rF,base64pad:rH,base64url:rV,base64urlpad:rK});let rG=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),rY=rG.reduce((e,t,r)=>(e[r]=t,e),[]),rJ=rG.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]),rZ=ru({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=rY[t],"")},decode:function(e){let t=[];for(let r of e){let e=rJ[r.codePointAt(0)];if(void 0===e)throw Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var rQ=Object.freeze({__proto__:null,base256emoji:rZ});function rX(e,t,r){t=t||[],r=r||0;for(var i=r;e>=2147483648;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,rX.bytes=r-i+1,t}function r0(e,t){var r,i=0,t=t||0,s=0,n=t,o=e.length;do{if(n>=o)throw r0.bytes=0,RangeError("Could not decode varint");r=e[n++],i+=s<28?(127&r)<<s:(127&r)*Math.pow(2,s),s+=7}while(r>=128);return r0.bytes=n-t,i}var r1={encode:rX,decode:r0,encodingLength:function(e){return e<128?1:e<16384?2:e<2097152?3:e<268435456?4:e<34359738368?5:e<4398046511104?6:e<562949953421312?7:e<72057594037927940?8:e<0x7fffffffffffffff?9:10}};let r2=(e,t,r=0)=>(r1.encode(e,t,r),t),r8=e=>r1.encodingLength(e),r3=(e,t)=>{let r=t.byteLength,i=r8(e),s=i+r8(r),n=new Uint8Array(s+r);return r2(e,n,0),r2(r,n,i),n.set(t,s),new r5(e,r,t,n)};class r5{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}let r6=({name:e,code:t,encode:r})=>new r4(e,t,r);class r4{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?r3(this.code,t):t.then(e=>r3(this.code,e))}throw Error("Unknown type, must be binary type")}}let r9=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),r7=r6({name:"sha2-256",code:18,encode:r9("SHA-256")}),ie=r6({name:"sha2-512",code:19,encode:r9("SHA-512")});var it=Object.freeze({__proto__:null,sha256:r7,sha512:ie}),ir=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:ri,digest:e=>r3(0,ri(e))}});new TextEncoder,new TextDecoder;let ii={...rm,...rw,...rE,...rI,...rP,...rU,...rq,...rz,...rW,...rQ};function is(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}({...it,...ir});let io=is("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),ia=is("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=re(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),ic={utf8:io,"utf-8":io,hex:ii.base16,latin1:ia,ascii:ia,binary:ia,...ii};function il(e,t="utf8"){let r=ic[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}function ih(e,t="utf8"){let r=ic[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?t7(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}function iu(e){return K(il(ih(e,t5),t6))}function id(e){return il(ih(W(e),t6),t5)}function ip(e){let t=ih("K36",t9),r="z"+il(rt([t,e]),t9);return["did","key",r].join(":")}function ig(e){let t=e.split("."),r=iu(t[0]),i=iu(t[1]),s=ih(t[2],t5),n=ih(t.slice(0,2).join("."),t4);return{header:r,payload:i,signature:s,data:n}}function iy(e=eQ(32)){let t=t3.getPublicKey(e);return{secretKey:rt([e,t]),publicKey:t}}async function im(e,t,r,i,s=(0,v.fromMiliseconds)(Date.now())){var n,o;let a={alg:"EdDSA",typ:"JWT"},c=ip(i.publicKey),l={iss:c,sub:e,aud:t,iat:s,exp:s+r},h=ih([id((n={header:a,payload:l}).header),id(n.payload)].join("."),t4),u=t3.sign(h,i.secretKey.slice(0,32));return[id((o={header:a,payload:l,signature:u}).header),id(o.payload),il(o.signature,t5)].join(".")}var ib=r(28611),iw=function(e,t,r){if(r||2==arguments.length)for(var i,s=0,n=t.length;s<n;s++)!i&&s in t||(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return e.concat(i||Array.prototype.slice.call(t))},iv=function(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"},iE=function(e){this.version=e,this.type="node",this.name="node",this.os=ib.platform},i_=function(e,t,r,i){this.name=e,this.version=t,this.os=r,this.bot=i,this.type="bot-device"},iI=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},iD=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},iS=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,iP=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],iO=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function ix(e){var t=""!==e&&iP.reduce(function(t,r){var i=r[0],s=r[1];if(t)return t;var n=s.exec(e);return!!n&&[i,n]},!1);if(!t)return null;var r=t[0],i=t[1];if("searchbot"===r)return new iI;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<3&&(s=iw(iw([],s,!0),function(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}(3-s.length),!0)):s=[];var n=s.join("."),o=function(e){for(var t=0,r=iO.length;t<r;t++){var i=iO[t],s=i[0];if(i[1].exec(e))return s}return null}(e),a=iS.exec(e);return a&&a[1]?new i_(r,n,o,a[1]):new iv(r,n,o)}var iA=r(90224),iC=r(45261);let iT="2.23.2",iN={getDocsUrl:({docsBaseUrl:e,docsPath:t="",docsSlug:r})=>t?`${e??"https://viem.sh"}${t}${r?`#${r}`:""}`:void 0,version:`viem@${iT}`};class iR extends Error{constructor(e,t={}){let r=t.cause instanceof iR?t.cause.details:t.cause?.message?t.cause.message:t.details,i=t.cause instanceof iR&&t.cause.docsPath||t.docsPath,s=iN.getDocsUrl?.({...t,docsPath:i}),n=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...r?[`Details: ${r}`]:[],...iN.version?[`Version: ${iN.version}`]:[]].join("\n");super(n,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=iT}walk(e){return function e(t,r){return r?.(t)?t:t&&"object"==typeof t&&"cause"in t&&void 0!==t.cause?e(t.cause,r):r?null:t}(this,e)}}function ij(e,{strict:t=!0}={}){return!!e&&"string"==typeof e&&(t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith("0x"))}class ik extends iR{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function iU(e,{dir:t,size:r=32}={}){return"string"==typeof e?function(e,{dir:t,size:r=32}={}){if(null===r)return e;let i=e.replace("0x","");if(i.length>2*r)throw new ik({size:Math.ceil(i.length/2),targetSize:r,type:"hex"});return`0x${i["right"===t?"padEnd":"padStart"](2*r,"0")}`}(e,{dir:t,size:r}):function(e,{dir:t,size:r=32}={}){if(null===r)return e;if(e.length>r)throw new ik({size:e.length,targetSize:r,type:"bytes"});let i=new Uint8Array(r);for(let s=0;s<r;s++){let n="right"===t;i[n?s:r-s-1]=e[n?s:e.length-s-1]}return i}(e,{dir:t,size:r})}class iB extends iR{constructor({max:e,min:t,signed:r,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${8*i}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class iL extends iR{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function iq(e){return ij(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}function i$(e,{size:t}){if(iq(e)>t)throw new iL({givenSize:iq(e),maxSize:t})}function iM(e,t={}){let{signed:r}=t;t.size&&i$(e,{size:t.size});let i=BigInt(e);if(!r)return i;let s=(e.length-2)/2,n=(1n<<8n*BigInt(s)-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(2*s,"f")}`)-1n}let iz=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function iF(e,t={}){return"number"==typeof e||"bigint"==typeof e?iV(e,t):"string"==typeof e?function(e,t={}){let r=iK.encode(e);return iH(r,t)}(e,t):"boolean"==typeof e?function(e,t={}){let r=`0x${Number(e)}`;return"number"==typeof t.size?(i$(r,{size:t.size}),iU(r,{size:t.size})):r}(e,t):iH(e,t)}function iH(e,t={}){let r="";for(let t=0;t<e.length;t++)r+=iz[e[t]];let i=`0x${r}`;return"number"==typeof t.size?(i$(i,{size:t.size}),iU(i,{dir:"right",size:t.size})):i}function iV(e,t={}){let r;let{signed:i,size:s}=t,n=BigInt(e);s?r=i?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof e&&(r=BigInt(Number.MAX_SAFE_INTEGER));let o="bigint"==typeof r&&i?-r-1n:0;if(r&&n>r||n<o){let t="bigint"==typeof e?"n":"";throw new iB({max:r?`${r}${t}`:void 0,min:`${o}${t}`,signed:i,size:s,value:`${e}${t}`})}let a=`0x${(i&&n<0?(1n<<BigInt(8*s))+BigInt(n):n).toString(16)}`;return s?iU(a,{size:s}):a}let iK=new TextEncoder,iW=new TextEncoder,iG={zero:48,nine:57,A:65,F:70,a:97,f:102};function iY(e){return e>=iG.zero&&e<=iG.nine?e-iG.zero:e>=iG.A&&e<=iG.F?e-(iG.A-10):e>=iG.a&&e<=iG.f?e-(iG.a-10):void 0}function iJ(e,t={}){let r=e;t.size&&(i$(r,{size:t.size}),r=iU(r,{dir:"right",size:t.size}));let i=r.slice(2);i.length%2&&(i=`0${i}`);let s=i.length/2,n=new Uint8Array(s);for(let e=0,t=0;e<s;e++){let r=iY(i.charCodeAt(t++)),s=iY(i.charCodeAt(t++));if(void 0===r||void 0===s)throw new iR(`Invalid byte sequence ("${i[t-2]}${i[t-1]}" in "${i}").`);n[e]=16*r+s}return n}function iZ(e,t={}){let r=iW.encode(e);return"number"==typeof t.size?(i$(r,{size:t.size}),iU(r,{dir:"right",size:t.size})):r}var iQ=r(16870);let iX=BigInt(4294967296-1),i0=BigInt(32),i1=(e,t,r)=>e<<r|t>>>32-r,i2=(e,t,r)=>t<<r|e>>>32-r,i8=(e,t,r)=>t<<r-32|e>>>64-r,i3=(e,t,r)=>e<<r-32|t>>>64-r;var i5=r(25949);let i6=[],i4=[],i9=[],i7=BigInt(0),se=BigInt(1),st=BigInt(2),sr=BigInt(7),si=BigInt(256),ss=BigInt(113);for(let e=0,t=se,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],i6.push(2*(5*i+r)),i4.push((e+1)*(e+2)/2%64);let s=i7;for(let e=0;e<7;e++)(t=(t<<se^(t>>sr)*ss)%si)&st&&(s^=se<<(se<<BigInt(e))-se);i9.push(s)}let[sn,so]=function(e,t=!1){let r=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let s=0;s<e.length;s++){let{h:n,l:o}=function(e,t=!1){return t?{h:Number(e&iX),l:Number(e>>i0&iX)}:{h:0|Number(e>>i0&iX),l:0|Number(e&iX)}}(e[s],t);[r[s],i[s]]=[n,o]}return[r,i]}(i9,!0),sa=(e,t,r)=>r>32?i8(e,t,r):i1(e,t,r),sc=(e,t,r)=>r>32?i3(e,t,r):i2(e,t,r);class sl extends i5.kb{constructor(e,t,r,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,iQ.k8)(r),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,i5.Jq)(this.state)}keccak(){i5.iA||(0,i5.l1)(this.state32),function(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,s=(t+2)%10,n=r[s],o=r[s+1],a=sa(n,o,1)^r[i],c=sc(n,o,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=c}let t=e[2],s=e[3];for(let r=0;r<24;r++){let i=i4[r],n=sa(t,s,i),o=sc(t,s,i),a=i6[r];t=e[a],s=e[a+1],e[a]=n,e[a+1]=o}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=sn[i],e[1]^=so[i]}r.fill(0)}(this.state32,this.rounds),i5.iA||(0,i5.l1)(this.state32),this.posOut=0,this.pos=0}update(e){(0,iQ.$h)(this);let{blockLen:t,state:r}=this;e=(0,i5.O0)(e);let i=e.length;for(let s=0;s<i;){let n=Math.min(t-this.pos,i-s);for(let t=0;t<n;t++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,iQ.$h)(this,!1),(0,iQ.gk)(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();let n=Math.min(r-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+n),i),this.posOut+=n,i+=n}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,iQ.k8)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,iQ.eB)(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:s,enableXOF:n}=this;return e||(e=new sl(t,r,i,n,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=n,e.destroyed=this.destroyed,e}}let sh=(0,i5.hE)(()=>new sl(136,1,32));function su(e,t){let r=sh(ij(e,{strict:!1})?function(e,t={}){return"number"==typeof e||"bigint"==typeof e?function(e,t){let r=iV(e,t);return iJ(r)}(e,t):"boolean"==typeof e?function(e,t={}){let r=new Uint8Array(1);return(r[0]=Number(e),"number"==typeof t.size)?(i$(r,{size:t.size}),iU(r,{size:t.size})):r}(e,t):ij(e)?iJ(e,t):iZ(e,t)}(e):e);return"bytes"===(t||"hex")?r:iF(r)}class sd extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}let sp=new sd(8192);async function sf({hash:e,signature:t}){let i=ij(e)?e:iF(e),{secp256k1:s}=await r.e(833).then(r.bind(r,61833)),n=(()=>{if("object"==typeof t&&"r"in t&&"s"in t){let{r:e,s:r,v:i,yParity:n}=t,o=Number(n??i),a=sg(o);return new s.Signature(iM(e),iM(r)).addRecoveryBit(a)}let e=ij(t)?t:iF(t),r=function(e,t={}){return Number(iM(e,t))}(`0x${e.slice(130)}`),i=sg(r);return s.Signature.fromCompact(e.substring(2,130)).addRecoveryBit(i)})(),o=n.recoverPublicKey(i.substring(2)).toHex(!1);return`0x${o}`}function sg(e){if(0===e||1===e)return e;if(27===e)return 0;if(28===e)return 1;throw Error("Invalid yParityOrV value")}async function sy({hash:e,signature:t}){return function(e){let t=su(`0x${e.substring(4)}`).substring(26);return function(e,t){if(sp.has(`${e}.${t}`))return sp.get(`${e}.${t}`);let r=t?`${t}${e.toLowerCase()}`:e.substring(2).toLowerCase(),i=su(iZ(r),"bytes"),s=(t?r.substring(`${t}0x`.length):r).split("");for(let e=0;e<40;e+=2)i[e>>1]>>4>=8&&s[e]&&(s[e]=s[e].toUpperCase()),(15&i[e>>1])>=8&&s[e+1]&&(s[e+1]=s[e+1].toUpperCase());let n=`0x${s.join("")}`;return sp.set(`${e}.${t}`,n),n}(`0x${t}`)}(await sf({hash:e,signature:t}))}var sm=function(e){if(e.length>=255)throw TypeError("Alphabet too long");let t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let r=0;r<e.length;r++){let i=e.charAt(r),s=i.charCodeAt(0);if(255!==t[s])throw TypeError(i+" is ambiguous");t[s]=r}let r=e.length,i=e.charAt(0),s=Math.log(r)/Math.log(256),n=Math.log(256)/Math.log(r);function o(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;let n=0,o=0,a=0;for(;e[n]===i;)o++,n++;let c=(e.length-n)*s+1>>>0,l=new Uint8Array(c);for(;n<e.length;){let i=e.charCodeAt(n);if(i>255)return;let s=t[i];if(255===s)return;let o=0;for(let e=c-1;(0!==s||o<a)&&-1!==e;e--,o++)s+=r*l[e]>>>0,l[e]=s%256>>>0,s=s/256>>>0;if(0!==s)throw Error("Non-zero carry");a=o,n++}let h=c-a;for(;h!==c&&0===l[h];)h++;let u=new Uint8Array(o+(c-h)),d=o;for(;h!==c;)u[d++]=l[h++];return u}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";let s=0,o=0,a=0,c=t.length;for(;a!==c&&0===t[a];)a++,s++;let l=(c-a)*n+1>>>0,h=new Uint8Array(l);for(;a!==c;){let e=t[a],i=0;for(let t=l-1;(0!==e||i<o)&&-1!==t;t--,i++)e+=256*h[t]>>>0,h[t]=e%r>>>0,e=e/r>>>0;if(0!==e)throw Error("Non-zero carry");o=i,a++}let u=l-o;for(;u!==l&&0===h[u];)u++;let d=i.repeat(s);for(;u<l;++u)d+=e.charAt(h[u]);return d},decodeUnsafe:o,decode:function(e){let t=o(e);if(t)return t;throw Error("Non-base"+r+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function sb(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function sw(e,t){t||(t=e.reduce((e,t)=>e+t.length,0));let r=sb(t),i=0;for(let t of e)r.set(t,i),i+=t.length;return r}var sv=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),o=n.charCodeAt(0);if(255!==r[o])throw TypeError(n+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var i=0,s=0;e[t]===c;)i++,t++;for(var n=(e.length-t)*l+1>>>0,o=new Uint8Array(n);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=n-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=n-s;p!==n&&0===o[p];)p++;for(var f=new Uint8Array(i+(n-p)),g=i;p!==n;)f[g++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,s=0,n=t.length;s!==n&&0===t[s];)s++,r++;for(var o=(n-s)*h+1>>>0,l=new Uint8Array(o);s!==n;){for(var u=t[s],d=0,p=o-1;(0!==u||d<i)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw Error("Non-zero carry");i=d,s++}for(var f=o-i;f!==o&&0===l[f];)f++;for(var g=c.repeat(r);f<o;++f)g+=e.charAt(l[f]);return g},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}};new Uint8Array(0);let sE=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},s_=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")},sI=e=>new TextEncoder().encode(e),sD=e=>new TextDecoder().decode(e);class sS{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class sP{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return sx(this,e)}}class sO{constructor(e){this.decoders=e}or(e){return sx(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let sx=(e,t)=>new sO({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class sA{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new sS(e,t,r),this.decoder=new sP(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let sC=({name:e,prefix:t,encode:r,decode:i})=>new sA(e,t,r,i),sT=({prefix:e,name:t,alphabet:r})=>{let{encode:i,decode:s}=sv(r,t);return sC({prefix:e,name:t,encode:i,decode:e=>s_(s(e))})},sN=(e,t,r,i)=>{let s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let n=e.length;for(;"="===e[n-1];)--n;let o=new Uint8Array(n*r/8|0),a=0,c=0,l=0;for(let t=0;t<n;++t){let n=s[e[t]];if(void 0===n)throw SyntaxError(`Non-${i} character`);c=c<<r|n,(a+=r)>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw SyntaxError("Unexpected end of data");return o},sR=(e,t,r)=>{let i="="===t[t.length-1],s=(1<<r)-1,n="",o=0,a=0;for(let i=0;i<e.length;++i)for(a=a<<8|e[i],o+=8;o>r;)o-=r,n+=t[s&a>>o];if(o&&(n+=t[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},sj=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>sC({prefix:t,name:e,encode:e=>sR(e,i,r),decode:t=>sN(t,i,r,e)}),sk=sC({prefix:"\x00",name:"identity",encode:e=>sD(e),decode:e=>sI(e)}),sU=sj({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),sB=sj({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),sL=sT({prefix:"9",name:"base10",alphabet:"0123456789"}),sq=sj({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),s$=sj({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),sM=sj({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sz=sj({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sF=sj({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sH=sj({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),sV=sj({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sK=sj({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),sW=sj({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sG=sj({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),sY=sj({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),sJ=sT({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),sZ=sT({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),sQ=sT({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),sX=sT({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),s0=sj({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s1=sj({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),s2=sj({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s8=sj({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),s3=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),s5=s3.reduce((e,t,r)=>(e[r]=t,e),[]),s6=s3.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]),s4=sC({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=s5[t],"")},decode:function(e){let t=[];for(let r of e){let e=s6[r.codePointAt(0)];if(void 0===e)throw Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});function s9(e,t,r){t=t||[];for(var i=r=r||0;e>=2147483648;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,s9.bytes=r-i+1,t}function s7(e,t){var r,i=0,t=t||0,s=0,n=t,o=e.length;do{if(n>=o)throw s7.bytes=0,RangeError("Could not decode varint");r=e[n++],i+=s<28?(127&r)<<s:(127&r)*Math.pow(2,s),s+=7}while(r>=128);return s7.bytes=n-t,i}var ne={encode:s9,decode:s7,encodingLength:function(e){return e<128?1:e<16384?2:e<2097152?3:e<268435456?4:e<34359738368?5:e<4398046511104?6:e<562949953421312?7:e<72057594037927940?8:e<0x7fffffffffffffff?9:10}};let nt=(e,t=0)=>{let r=ne.decode(e,t);return[r,ne.decode.bytes]},nr=(e,t,r=0)=>(ne.encode(e,t,r),t),ni=e=>ne.encodingLength(e),ns=(e,t)=>{let r=t.byteLength,i=ni(e),s=i+ni(r),n=new Uint8Array(s+r);return nr(e,n,0),nr(r,n,i),n.set(t,s),new na(e,r,t,n)},nn=e=>{let t=s_(e),[r,i]=nt(t),[s,n]=nt(t.subarray(i)),o=t.subarray(i+n);if(o.byteLength!==s)throw Error("Incorrect length");return new na(r,s,o,t)},no=(e,t)=>e===t||e.code===t.code&&e.size===t.size&&sE(e.bytes,t.bytes);class na{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}let nc=({name:e,code:t,encode:r})=>new nl(e,t,r);class nl{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?ns(this.code,t):t.then(e=>ns(this.code,e))}throw Error("Unknown type, must be binary type")}}let nh=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),nu=nc({name:"sha2-256",code:18,encode:nh("SHA-256")}),nd=nc({name:"sha2-512",code:19,encode:nh("SHA-512")}),np={code:0,name:"identity",encode:s_,digest:e=>ns(0,s_(e))},nf="raw",ng=85,ny=e=>s_(e),nm=e=>s_(e),nb=new TextEncoder,nw=new TextDecoder,nv="json",nE=512,n_=e=>nb.encode(JSON.stringify(e)),nI=e=>JSON.parse(nw.decode(e));class nD{constructor(e,t,r,i){this.code=t,this.version=e,this.multihash=r,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:nR,byteLength:nR,code:nN,version:nN,multihash:nN,bytes:nN,_baseCache:nR,asCID:nR})}toV0(){if(0===this.version)return this;{let{code:e,multihash:t}=this;if(e!==nx)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==nA)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return nD.createV0(t)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=ns(e,t);return nD.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&no(this.multihash,e.multihash)}toString(e){let{bytes:t,version:r,_baseCache:i}=this;return 0===r?nP(t,i,e||sQ.encoder):nO(t,i,e||sM.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return nj(/^0\.0/,nk),!!(e&&(e[nT]||e.asCID===e))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof nD)return e;if(null!=e&&e.asCID===e){let{version:t,code:r,multihash:i,bytes:s}=e;return new nD(t,r,i,s||nC(t,r,i.bytes))}if(null==e||!0!==e[nT])return null;{let{version:t,multihash:r,code:i}=e,s=nn(r);return nD.create(t,i,s)}}static create(e,t,r){if("number"!=typeof t)throw Error("String codecs are no longer supported");switch(e){case 0:if(t===nx)return new nD(e,t,r,r.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${nx}) block encoding`);case 1:{let i=nC(e,t,r.bytes);return new nD(e,t,r,i)}default:throw Error("Invalid version")}}static createV0(e){return nD.create(0,nx,e)}static createV1(e,t){return nD.create(1,e,t)}static decode(e){let[t,r]=nD.decodeFirst(e);if(r.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=nD.inspectBytes(e),r=t.size-t.multihashSize,i=s_(e.subarray(r,r+t.multihashSize));if(i.byteLength!==t.multihashSize)throw Error("Incorrect length");let s=i.subarray(t.multihashSize-t.digestSize),n=new na(t.multihashCode,t.digestSize,s,i),o=0===t.version?nD.createV0(n):nD.createV1(t.codec,n);return[o,e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,i]=nt(e.subarray(t));return t+=i,r},i=r(),s=nx;if(18===i?(i=0,t=0):1===i&&(s=r()),0!==i&&1!==i)throw RangeError(`Invalid CID version ${i}`);let n=t,o=r(),a=r(),c=t+a;return{version:i,codec:s,multihashCode:o,digestSize:a,multihashSize:c-n,size:c}}static parse(e,t){let[r,i]=nS(e,t),s=nD.decode(i);return s._baseCache.set(r,e),s}}let nS=(e,t)=>{switch(e[0]){case"Q":return[sQ.prefix,(t||sQ).decode(`${sQ.prefix}${e}`)];case sQ.prefix:return[sQ.prefix,(t||sQ).decode(e)];case sM.prefix:return[sM.prefix,(t||sM).decode(e)];default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},nP=(e,t,r)=>{let{prefix:i}=r;if(i!==sQ.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let s=t.get(i);if(null!=s)return s;{let s=r.encode(e).slice(1);return t.set(i,s),s}},nO=(e,t,r)=>{let{prefix:i}=r,s=t.get(i);if(null!=s)return s;{let s=r.encode(e);return t.set(i,s),s}},nx=112,nA=18,nC=(e,t,r)=>{let i=ni(e),s=i+ni(t),n=new Uint8Array(s+r.byteLength);return nr(e,n,0),nr(t,n,i),n.set(r,s),n},nT=Symbol.for("@ipld/js-cid/CID"),nN={writable:!1,configurable:!1,enumerable:!0},nR={writable:!1,enumerable:!1,configurable:!1},nj=(e,t)=>{if(e.test("0.0.0-dev"))console.warn(t);else throw Error(t)},nk=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`,nU={...s,...n,...o,...a,...c,...l,...h,...u,...d,...p};function nB(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}({...f,...g});let nL=nB("utf8","u",e=>{let t=new TextDecoder("utf8");return"u"+t.decode(e)},e=>{let t=new TextEncoder;return t.encode(e.substring(1))}),nq=nB("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=sb(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),n$={utf8:nL,"utf-8":nL,hex:nU.base16,latin1:nq,ascii:nq,binary:nq,...nU};function nM(e,t="utf8"){let r=n$[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(e,"utf8"):r.decoder.decode(`${r.prefix}${e}`)}function nz(e,t="utf8"){let r=n$[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}let nF={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var nH=r(28611),nV=r(27669).Buffer;function nK(e){let[t,r]=e.split(":");return{namespace:t,reference:r}}function nW(e,t){return e.includes(":")?[e]:t.chains||[]}var nG=Object.defineProperty,nY=Object.defineProperties,nJ=Object.getOwnPropertyDescriptors,nZ=Object.getOwnPropertySymbols,nQ=Object.prototype.hasOwnProperty,nX=Object.prototype.propertyIsEnumerable,n0=(e,t,r)=>t in e?nG(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,n1=(e,t)=>{for(var r in t||(t={}))nQ.call(t,r)&&n0(e,r,t[r]);if(nZ)for(var r of nZ(t))nX.call(t,r)&&n0(e,r,t[r]);return e},n2=(e,t)=>nY(e,nJ(t));let n8={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function n3(){return"u">typeof nH&&"u">typeof nH.versions&&"u">typeof nH.versions.node}function n5(){return!(0,iA.getDocument)()&&!!(0,iA.getNavigator)()&&"ReactNative"===navigator.product}function n6(){return!n3()&&!!(0,iA.getNavigator)()&&!!(0,iA.getDocument)()}function n4(){return n5()?n8.reactNative:n3()?n8.node:n6()?n8.browser:n8.unknown}function n9(){var e;try{return n5()&&"u">typeof r.g&&"u">typeof(null==r.g?void 0:r.g.Application)?null==(e=r.g.Application)?void 0:e.applicationId:void 0}catch{return}}function n7(){return(0,iC.D)()||{name:"",description:"",url:"",icons:[""]}}function oe(e,t,i){let s=function(){var e;if(n4()===n8.reactNative&&"u">typeof r.g&&"u">typeof(null==r.g?void 0:r.g.Platform)){let{OS:e,Version:t}=r.g.Platform;return[e,t].join("-")}let t=e?ix(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new iD:"undefined"!=typeof navigator?ix(navigator.userAgent):void 0!==ib&&ib.version?new iE(ib.version.slice(1)):null;if(null===t)return"unknown";let i=t.os?t.os.replace(" ","").toLowerCase():"unknown";return"browser"===t.type?[i,t.name,t.version].join("-"):[i,t.version].join("-")}(),n=function(){var e;let t=n4();return t===n8.browser?[t,(null==(e=(0,iA.getLocation)())?void 0:e.host)||"unknown"].join(":"):t}();return[[e,t].join("-"),["js",i].join("-"),s,n].join("/")}function ot(e,t){return e.filter(e=>t.includes(e)).length===e.length}function or(e){return Object.fromEntries(e.entries())}function oi(e){return new Map(Object.entries(e))}function os(e=v.FIVE_MINUTES,t){let r,i,s,n;let o=(0,v.toMiliseconds)(e||v.FIVE_MINUTES);return{resolve:e=>{s&&r&&(clearTimeout(s),r(e),n=Promise.resolve(e))},reject:e=>{s&&i&&(clearTimeout(s),i(e))},done:()=>new Promise((e,a)=>{if(n)return e(n);s=setTimeout(()=>{let e=Error(t);n=Promise.reject(e),a(e)},o),r=e,i=a})}}function on(e,t,r){return new Promise(async(i,s)=>{let n=setTimeout(()=>s(Error(r)),t);try{let t=await e;i(t)}catch(e){s(e)}clearTimeout(n)})}function oo(e,t){if("string"==typeof t&&t.startsWith(`${e}:`))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}if("id"===e.toLowerCase()){if("number"!=typeof t)throw Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw Error(`Unknown expirer target type: ${e}`)}function oa(e){let[t,r]=e.split(":"),i={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof r)i.topic=r;else if("id"===t&&Number.isInteger(Number(r)))i.id=Number(r);else throw Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return i}function oc(e,t){return(0,v.fromMiliseconds)((t||Date.now())+(0,v.toMiliseconds)(e))}function ol(e){return Date.now()>=(0,v.toMiliseconds)(e)}function oh(e,t){return`${e}${t?`:${t}`:""}`}function ou(e=[],t=[]){return[...new Set([...e,...t])]}async function od({id:e,topic:t,wcDeepLink:i}){var s;try{if(!i)return;let n="string"==typeof i?JSON.parse(i):i,o=n?.href;if("string"!=typeof o)return;let a=function(e,t,r){let i=`requestId=${t}&sessionTopic=${r}`;e.endsWith("/")&&(e=e.slice(0,-1));let s=`${e}`;if(e.startsWith("https://t.me")){let t=e.includes("?")?"&startapp=":"?startapp=";s=`${s}${t}${function(e,t=!1){let r=nV.from(e).toString("base64");return t?r.replace(/[=]/g,""):r}(i,!0)}`}else s=`${s}/wc?${i}`;return s}(o,e,t),c=n4();if(c===n8.browser){let e;if(!(null!=(s=(0,iA.getDocument)())&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}e="_self",function(){try{return window.self!==window.top}catch{return!1}}()?e="_top":("u">typeof window&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)||a.startsWith("https://")||a.startsWith("http://"))&&(e="_blank"),window.open(a,e,"noreferrer noopener")}else c===n8.reactNative&&"u">typeof(null==r.g?void 0:r.g.Linking)&&await r.g.Linking.openURL(a)}catch(e){console.error(e)}}async function op(e,t){let r="";try{if(n6()&&(r=localStorage.getItem(t)))return r;r=await e.getItem(t)}catch(e){console.error(e)}return r}function of(e,t){if(!e.includes(t))return null;let r=e.split(/([&,?,=])/),i=r.indexOf(t);return r[i+2]}function og(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function oy(){return"u">typeof nH&&"true"===nH.env.IS_VITEST}function om(e){return nV.from(e,"base64").toString("utf-8")}function ob(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function ow(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function ov(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");ob(e.outputLen),ob(e.blockLen)}function oE(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function o_(e,t){ow(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}let oI=BigInt(4294967296-1),oD=BigInt(32),oS=(e,t,r)=>e<<r|t>>>32-r,oP=(e,t,r)=>t<<r|e>>>32-r,oO=(e,t,r)=>t<<r-32|e>>>64-r,ox=(e,t,r)=>e<<r-32|t>>>64-r,oA="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function oC(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function oT(e,t){return e<<32-t|e>>>t}let oN=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function oR(e){for(let r=0;r<e.length;r++){var t;e[r]=(t=e[r])<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}}function oj(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}(e)),ow(e),e}class ok{clone(){return this._cloneInto()}}function oU(e){let t=t=>e().update(oj(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function oB(e=32){if(oA&&"function"==typeof oA.getRandomValues)return oA.getRandomValues(new Uint8Array(e));if(oA&&"function"==typeof oA.randomBytes)return oA.randomBytes(e);throw Error("crypto.getRandomValues must be defined")}let oL=[],oq=[],o$=[],oM=BigInt(0),oz=BigInt(1),oF=BigInt(2),oH=BigInt(7),oV=BigInt(256),oK=BigInt(113);for(let e=0,t=oz,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],oL.push(2*(5*i+r)),oq.push((e+1)*(e+2)/2%64);let s=oM;for(let e=0;e<7;e++)(t=(t<<oz^(t>>oH)*oK)%oV)&oF&&(s^=oz<<(oz<<BigInt(e))-oz);o$.push(s)}let[oW,oG]=function(e,t=!1){let r=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let s=0;s<e.length;s++){let{h:n,l:o}=function(e,t=!1){return t?{h:Number(e&oI),l:Number(e>>oD&oI)}:{h:0|Number(e>>oD&oI),l:0|Number(e&oI)}}(e[s],t);[r[s],i[s]]=[n,o]}return[r,i]}(o$,!0),oY=(e,t,r)=>r>32?oO(e,t,r):oS(e,t,r),oJ=(e,t,r)=>r>32?ox(e,t,r):oP(e,t,r);class oZ extends ok{constructor(e,t,r,i=!1,s=24){var n;if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ob(r),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(n=this.state,new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4)))}keccak(){oN||oR(this.state32),function(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,s=(t+2)%10,n=r[s],o=r[s+1],a=oY(n,o,1)^r[i],c=oJ(n,o,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=c}let t=e[2],s=e[3];for(let r=0;r<24;r++){let i=oq[r],n=oY(t,s,i),o=oJ(t,s,i),a=oL[r];t=e[a],s=e[a+1],e[a]=n,e[a+1]=o}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=oW[i],e[1]^=oG[i]}r.fill(0)}(this.state32,this.rounds),oN||oR(this.state32),this.posOut=0,this.pos=0}update(e){oE(this);let{blockLen:t,state:r}=this;e=oj(e);let i=e.length;for(let s=0;s<i;){let n=Math.min(t-this.pos,i-s);for(let t=0;t<n;t++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){oE(this,!1),ow(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();let n=Math.min(r-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+n),i),this.posOut+=n,i+=n}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ob(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(o_(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:s,enableXOF:n}=this;return e||(e=new oZ(t,r,i,n,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=n,e.destroyed=this.destroyed,e}}let oQ=oU(()=>new oZ(136,1,32));function oX(e){let t=`Ethereum Signed Message:
${e.length}`,r=new TextEncoder().encode(t+e);return"0x"+nV.from(oQ(r)).toString("hex")}async function o0(e,t,r,i,s,n){switch(r.t){case"eip191":return await o1(e,t,r.s);case"eip1271":return await o2(e,t,r.s,i,s,n);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function o1(e,t,r){return(await sy({hash:oX(t),signature:r})).toLowerCase()===e.toLowerCase()}async function o2(e,t,r,i,s,n){let o=nK(i);if(!o.namespace||!o.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{let o="0x1626ba7e",a=r.substring(2),c=oX(t).substring(2),l=await fetch(`${n||"https://rpc.walletconnect.org/v1"}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:o+c+"00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000041"+a},"latest"]})}),{result:h}=await l.json();return!!h&&h.slice(0,o.length).toLowerCase()===o.toLowerCase()}catch(e){return console.error("isValidEip1271Signature: ",e),!1}}var o8=Object.defineProperty,o3=Object.defineProperties,o5=Object.getOwnPropertyDescriptors,o6=Object.getOwnPropertySymbols,o4=Object.prototype.hasOwnProperty,o9=Object.prototype.propertyIsEnumerable,o7=(e,t,r)=>t in e?o8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ae=(e,t)=>{for(var r in t||(t={}))o4.call(t,r)&&o7(e,r,t[r]);if(o6)for(var r of o6(t))o9.call(t,r)&&o7(e,r,t[r]);return e},at=(e,t)=>o3(e,o5(t));let ar=e=>e?.split(":"),ai=e=>{let t=e&&ar(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]},as=e=>{let t=e&&ar(e);if(t)return t[2]+":"+t[3]},an=e=>{let t=e&&ar(e);if(t)return t.pop()};async function ao(e){let{cacao:t,projectId:r}=e,{s:i,p:s}=t,n=aa(s,s.iss),o=an(s.iss);return await o0(o,n,i,as(s.iss),r)}let aa=(e,t)=>{let r=`${e.domain} wants you to sign in with your Ethereum account:`,i=an(t);if(!e.aud&&!e.uri)throw Error("Either `aud` or `uri` is required to construct the message");let s=e.statement||void 0,n=`URI: ${e.aud||e.uri}`,o=`Version: ${e.version}`,a=`Chain ID: ${ai(t)}`,c=`Nonce: ${e.nonce}`,l=`Issued At: ${e.iat}`,h=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,d=e.requestId?`Request ID: ${e.requestId}`:void 0,p=e.resources?`Resources:${e.resources.map(e=>`
- ${e}`).join("")}`:void 0,f=ap(e.resources);if(f){let e=ah(f);s=function(e="",t){ac(t);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(r))return e;let i=[],s=0;Object.keys(t.att).forEach(e=>{let r=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));r.sort((e,t)=>e.action.localeCompare(t.action));let n={};r.forEach(e=>{n[e.ability]||(n[e.ability]=[]),n[e.ability].push(e.action)});let o=Object.keys(n).map(t=>`(${++s}) '${t}': '${n[t].join("', '")}' for '${e}'.`);i.push(o.join(", ").replace(".,","."))});let n=i.join(" "),o=`${r}${n}`;return`${e?e+" ":""}${o}`}(s,e)}return[r,i,"",s,"",n,o,a,c,l,h,u,d,p].filter(e=>null!=e).join(`
`)};function ac(e){if(!e)throw Error("No recap provided, value is undefined");if(!e.att)throw Error("No `att` property found");let t=Object.keys(e.att);if(!(null!=t&&t.length))throw Error("No resources found in `att` property");t.forEach(t=>{let r=e.att[t];if(Array.isArray(r)||"object"!=typeof r)throw Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(e=>{let t=r[e];if(!Array.isArray(t))throw Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if("object"!=typeof t)throw Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function al(e){return ac(e),`urn:recap:${nV.from(JSON.stringify(e)).toString("base64").replace(/=/g,"")}`}function ah(e){var t;let r=(t=e.replace("urn:recap:",""),JSON.parse(nV.from(t,"base64").toString("utf-8")));return ac(r),r}function au(e){var t;let r=ah(e);ac(r);let i=null==(t=r.att)?void 0:t.eip155;return i?Object.keys(i).map(e=>e.split("/")[1]):[]}function ad(e){let t=ah(e);ac(t);let r=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=e?.[0])&&t.chains&&r.push(e[0].chains)})}),[...new Set(r.flat())]}function ap(e){if(!e)return;let t=e?.[e.length-1];return t&&t.includes("urn:recap:")?t:void 0}function af(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function ag(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function ay(e,...t){if(!ag(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function am(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function ab(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}let aw=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),av=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),aE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];if(!aE)throw Error("Non little-endian hardware is not supported");function a_(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e);else if(ag(e))e=aS(e);else throw Error("Uint8Array expected, got "+typeof e);return e}function aI(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error("invalid output length, expected "+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw Error("invalid output, must be aligned");return t}function aD(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+l,a,i)}function aS(e){return Uint8Array.from(e)}function aP(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}let aO=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),ax=aO("expand 16-byte k"),aA=aO("expand 32-byte k"),aC=aw(ax),aT=aw(aA);function aN(e,t){return e<<t|e>>>32-t}function aR(e){return e.byteOffset%4==0}let aj=4294967296-1,ak=new Uint32Array,aU=(e,t)=>255&e[t++]|(255&e[t++])<<8;class aB{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,ay(e=a_(e),32);let t=aU(e,0),r=aU(e,2),i=aU(e,4),s=aU(e,6),n=aU(e,8),o=aU(e,10),a=aU(e,12),c=aU(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|n<<12)&255,this.r[5]=n>>>1&8190,this.r[6]=(n>>>14|o<<2)&8191,this.r[7]=(o>>>11|a<<5)&8065,this.r[8]=(a>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=aU(e,16+2*t)}process(e,t,r=!1){let{h:i,r:s}=this,n=s[0],o=s[1],a=s[2],c=s[3],l=s[4],h=s[5],u=s[6],d=s[7],p=s[8],f=s[9],g=aU(e,t+0),y=aU(e,t+2),m=aU(e,t+4),b=aU(e,t+6),w=aU(e,t+8),v=aU(e,t+10),E=aU(e,t+12),_=aU(e,t+14),I=i[0]+(8191&g),D=i[1]+((g>>>13|y<<3)&8191),S=i[2]+((y>>>10|m<<6)&8191),P=i[3]+((m>>>7|b<<9)&8191),O=i[4]+((b>>>4|w<<12)&8191),x=i[5]+(w>>>1&8191),A=i[6]+((w>>>14|v<<2)&8191),C=i[7]+((v>>>11|E<<5)&8191),T=i[8]+((E>>>8|_<<8)&8191),N=i[9]+(_>>>5|(r?0:2048)),R=0,j=0+I*n+D*(5*f)+S*(5*p)+P*(5*d)+O*(5*u);R=j>>>13,j&=8191,j+=x*(5*h)+A*(5*l)+C*(5*c)+T*(5*a)+N*(5*o),R+=j>>>13,j&=8191;let k=R+I*o+D*n+S*(5*f)+P*(5*p)+O*(5*d);R=k>>>13,k&=8191,k+=x*(5*u)+A*(5*h)+C*(5*l)+T*(5*c)+N*(5*a),R+=k>>>13,k&=8191;let U=R+I*a+D*o+S*n+P*(5*f)+O*(5*p);R=U>>>13,U&=8191,U+=x*(5*d)+A*(5*u)+C*(5*h)+T*(5*l)+N*(5*c),R+=U>>>13,U&=8191;let B=R+I*c+D*a+S*o+P*n+O*(5*f);R=B>>>13,B&=8191,B+=x*(5*p)+A*(5*d)+C*(5*u)+T*(5*h)+N*(5*l),R+=B>>>13,B&=8191;let L=R+I*l+D*c+S*a+P*o+O*n;R=L>>>13,L&=8191,L+=x*(5*f)+A*(5*p)+C*(5*d)+T*(5*u)+N*(5*h),R+=L>>>13,L&=8191;let q=R+I*h+D*l+S*c+P*a+O*o;R=q>>>13,q&=8191,q+=x*n+A*(5*f)+C*(5*p)+T*(5*d)+N*(5*u),R+=q>>>13,q&=8191;let $=R+I*u+D*h+S*l+P*c+O*a;R=$>>>13,$&=8191,$+=x*o+A*n+C*(5*f)+T*(5*p)+N*(5*d),R+=$>>>13,$&=8191;let M=R+I*d+D*u+S*h+P*l+O*c;R=M>>>13,M&=8191,M+=x*a+A*o+C*n+T*(5*f)+N*(5*p),R+=M>>>13,M&=8191;let z=R+I*p+D*d+S*u+P*h+O*l;R=z>>>13,z&=8191,z+=x*c+A*a+C*o+T*n+N*(5*f),R+=z>>>13,z&=8191;let F=R+I*f+D*p+S*d+P*u+O*h;R=F>>>13,F&=8191,F+=x*l+A*c+C*a+T*o+N*n,R+=F>>>13,F&=8191,j=8191&(R=(R=(R<<2)+R|0)+j|0),R>>>=13,k+=R,i[0]=j,i[1]=k,i[2]=U,i[3]=B,i[4]=L,i[5]=q,i[6]=$,i[7]=M,i[8]=z,i[9]=F}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=i,i=e[t]>>>13,e[t]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+i,i=r[t]>>>13,r[t]&=8191;r[9]-=8192;let s=(1^i)-1;for(let e=0;e<10;e++)r[e]&=s;s=~s;for(let t=0;t<10;t++)e[t]=e[t]&s|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let n=e[0]+t[0];e[0]=65535&n;for(let r=1;r<8;r++)n=(e[r]+t[r]|0)+(n>>>16)|0,e[r]=65535&n;aP(r)}update(e){am(this);let{buffer:t,blockLen:r}=this;e=a_(e);let i=e.length;for(let s=0;s<i;){let n=Math.min(r-this.pos,i-s);if(n===r){for(;r<=i-s;s+=r)this.process(e,s);continue}t.set(e.subarray(s,s+n),this.pos),this.pos+=n,s+=n,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){aP(this.h,this.r,this.buffer,this.pad)}digestInto(e){am(this),function(e,t){ay(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;let{buffer:t,h:r}=this,{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let t=0;t<8;t++)e[s++]=r[t]>>>0,e[s++]=r[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let aL=function(e){let t=(t,r)=>e(r).update(a_(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}(e=>new aB(e)),aq=function(e,t){let{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return af(s),af(o),ab(n),ab(r),(t,a,c,l,h=0)=>{ay(t),ay(a),ay(c);let u=c.length;if(void 0===l&&(l=new Uint8Array(u)),ay(l),af(h),h<0||h>=aj)throw Error("arx: counter overflow");if(l.length<u)throw Error(`arx: output (${l.length}) is shorter than data (${u})`);let d=[],p=t.length,f,g;if(32===p)d.push(f=aS(t)),g=aT;else if(16===p&&r)(f=new Uint8Array(32)).set(t),f.set(t,16),g=aC,d.push(f);else throw Error(`arx: invalid 32-byte key, got length=${p}`);aR(a)||d.push(a=aS(a));let y=aw(f);if(i){if(24!==a.length)throw Error("arx: extended nonce must be 24 bytes");i(g,y,aw(a.subarray(0,16)),y),a=a.subarray(16)}let m=16-s;if(m!==a.length)throw Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){let e=new Uint8Array(12);e.set(a,n?0:12-a.length),a=e,d.push(a)}let b=aw(a);return function(e,t,r,i,s,n,o,a){let c=s.length,l=new Uint8Array(64),h=aw(l),u=aR(s)&&aR(n),d=u?aw(s):ak,p=u?aw(n):ak;for(let f=0;f<c;o++){if(e(t,r,i,h,o,a),o>=aj)throw Error("arx: counter overflow");let g=Math.min(64,c-f);if(u&&64===g){let e=f/4;if(f%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)p[r=e+t]=d[r]^h[t];f+=64;continue}for(let e=0,t;e<g;e++)n[t=f+e]=s[t]^l[e];f+=g}}(e,g,y,b,c,l,h,o),aP(...d),l}}(function(e,t,r,i,s,n=20){let o=e[0],a=e[1],c=e[2],l=e[3],h=t[0],u=t[1],d=t[2],p=t[3],f=t[4],g=t[5],y=t[6],m=t[7],b=r[0],w=r[1],v=r[2],E=o,_=a,I=c,D=l,S=h,P=u,O=d,x=p,A=f,C=g,T=y,N=m,R=s,j=b,k=w,U=v;for(let e=0;e<n;e+=2)A=A+(R=aN(R^(E=E+S|0),16))|0,E=E+(S=aN(S^A,12))|0,A=A+(R=aN(R^E,8))|0,S=aN(S^A,7),C=C+(j=aN(j^(_=_+P|0),16))|0,_=_+(P=aN(P^C,12))|0,C=C+(j=aN(j^_,8))|0,P=aN(P^C,7),T=T+(k=aN(k^(I=I+O|0),16))|0,I=I+(O=aN(O^T,12))|0,T=T+(k=aN(k^I,8))|0,O=aN(O^T,7),N=N+(U=aN(U^(D=D+x|0),16))|0,D=D+(x=aN(x^N,12))|0,N=N+(U=aN(U^D,8))|0,x=aN(x^N,7),T=T+(U=aN(U^(E=E+P|0),16))|0,E=E+(P=aN(P^T,12))|0,T=T+(U=aN(U^E,8))|0,P=aN(P^T,7),N=N+(R=aN(R^(_=_+O|0),16))|0,_=_+(O=aN(O^N,12))|0,N=N+(R=aN(R^_,8))|0,O=aN(O^N,7),A=A+(j=aN(j^(I=I+x|0),16))|0,I=I+(x=aN(x^A,12))|0,A=A+(j=aN(j^I,8))|0,x=aN(x^A,7),C=C+(k=aN(k^(D=D+S|0),16))|0,D=D+(S=aN(S^C,12))|0,C=C+(k=aN(k^D,8))|0,S=aN(S^C,7);let B=0;i[B++]=o+E|0,i[B++]=a+_|0,i[B++]=c+I|0,i[B++]=l+D|0,i[B++]=h+S|0,i[B++]=u+P|0,i[B++]=d+O|0,i[B++]=p+x|0,i[B++]=f+A|0,i[B++]=g+C|0,i[B++]=y+T|0,i[B++]=m+N|0,i[B++]=s+R|0,i[B++]=b+j|0,i[B++]=w+k|0,i[B++]=v+U|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),a$=new Uint8Array(16),aM=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(a$.subarray(r))},az=new Uint8Array(32);function aF(e,t,r,i,s){let n=e(t,r,az),o=aL.create(n);s&&aM(o,s),aM(o,i);let a=new Uint8Array(16),c=av(a);aD(c,0,BigInt(s?s.length:0),!0),aD(c,8,BigInt(i.length),!0),o.update(a);let l=o.digest();return aP(n,a),l}let aH=((e,t)=>{function r(i,...s){if(ay(i),void 0!==e.nonceLength){let t=s[0];if(!t)throw Error("nonce / iv required");e.varSizeNonce?ay(t):ay(t,e.nonceLength)}let n=e.tagLength;n&&void 0!==s[1]&&ay(s[1]);let o=t(i,...s),a=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");ay(t)}},c=!1;return{encrypt(e,t){if(c)throw Error("cannot encrypt() twice with same key + nonce");return c=!0,ay(e),a(o.encrypt.length,t),o.encrypt(e,t)},decrypt(e,t){if(ay(e),n&&e.length<n)throw Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,t),o.decrypt(e,t)}}}return Object.assign(r,e),r})({blockSize:64,nonceLength:12,tagLength:16},(e,t,r)=>({encrypt(i,s){let n=i.length;(s=aI(n+16,s,!1)).set(i);let o=s.subarray(0,-16);aq(e,t,o,o,1);let a=aF(aq,e,t,o,r);return s.set(a,n),aP(a),s},decrypt(i,s){s=aI(i.length-16,s,!1);let n=i.subarray(0,-16),o=i.subarray(-16),a=aF(aq,e,t,n,r);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}(o,a))throw Error("invalid tag");return s.set(i.subarray(0,-16)),aq(e,t,s,s,1),aP(a),s}}));class aV extends ok{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ov(e);let r=oj(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){return oE(this),this.iHash.update(e),this}digestInto(e){oE(this),ow(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:i,destroyed:s,blockLen:n,outputLen:o}=this;return e.finished=i,e.destroyed=s,e.blockLen=n,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let aK=(e,t,r)=>new aV(e,t).update(r).digest();aK.create=(e,t)=>new aV(e,t);let aW=new Uint8Array([0]),aG=new Uint8Array,aY=(e,t,r,i,s)=>{var n;return function(e,t,r,i=32){if(ov(e),ob(i),i>255*e.outputLen)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(i/e.outputLen);void 0===r&&(r=aG);let n=new Uint8Array(s*e.outputLen),o=aK.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<s;t++)aW[0]=t+1,a.update(0===t?aG:c).update(r).update(aW).digestInto(c),n.set(c,e.outputLen*t),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),aW.fill(0),n.slice(0,i)}(e,(n=r,ov(e),void 0===n&&(n=new Uint8Array(e.outputLen)),aK(e,oj(n),oj(t))),i,s)};class aJ extends ok{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=oC(this.buffer)}update(e){oE(this);let{view:t,buffer:r,blockLen:i}=this;e=oj(e);let s=e.length;for(let n=0;n<s;){let o=Math.min(i-this.pos,s-n);if(o===i){let t=oC(e);for(;i<=s-n;n+=i)this.process(t,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oE(this),o_(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:i,isLE:s}=this,{pos:n}=this;t[n++]=128,this.buffer.subarray(n).fill(0),this.padOffset>i-n&&(this.process(r,0),n=0);for(let e=n;e<i;e++)t[e]=0;(function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+l,a,i)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);let o=oC(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let c=a/4,l=this.get();if(c>l.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,l[e],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:s,destroyed:n,pos:o}=this;return e.length=i,e.pos=o,e.finished=s,e.destroyed=n,i%t&&e.buffer.set(r),e}}let aZ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),aQ=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),aX=new Uint32Array(64);class a0 extends aJ{constructor(){super(64,32,8,!1),this.A=0|aQ[0],this.B=0|aQ[1],this.C=0|aQ[2],this.D=0|aQ[3],this.E=0|aQ[4],this.F=0|aQ[5],this.G=0|aQ[6],this.H=0|aQ[7]}get(){let{A:e,B:t,C:r,D:i,E:s,F:n,G:o,H:a}=this;return[e,t,r,i,s,n,o,a]}set(e,t,r,i,s,n,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|n,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)aX[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=aX[e-15],r=aX[e-2],i=oT(t,7)^oT(t,18)^t>>>3,s=oT(r,17)^oT(r,19)^r>>>10;aX[e]=s+aX[e-7]+i+aX[e-16]|0}let{A:r,B:i,C:s,D:n,E:o,F:a,G:c,H:l}=this;for(let e=0;e<64;e++){var h,u,d,p;let t=oT(o,6)^oT(o,11)^oT(o,25),f=l+t+((h=o)&a^~h&c)+aZ[e]+aX[e]|0,g=(oT(r,2)^oT(r,13)^oT(r,22))+((u=r)&(d=i)^u&(p=s)^d&p)|0;l=c,c=a,a=o,o=n+f|0,n=s,s=i,i=r,r=f+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,n=n+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(r,i,s,n,o,a,c,l)}roundClean(){aX.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let a1=oU(()=>new a0),a2=BigInt(0),a8=BigInt(1),a3=BigInt(2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function a5(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function a6(e){if(!a5(e))throw Error("Uint8Array expected")}function a4(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)}let a9=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function a7(e){a6(e);let t="";for(let r=0;r<e.length;r++)t+=a9[e[r]];return t}function ce(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function ct(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?a2:BigInt("0x"+e)}let cr={_0:48,_9:57,A:65,F:70,a:97,f:102};function ci(e){return e>=cr._0&&e<=cr._9?e-cr._0:e>=cr.A&&e<=cr.F?e-(cr.A-10):e>=cr.a&&e<=cr.f?e-(cr.a-10):void 0}function cs(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,s=0;t<r;t++,s+=2){let r=ci(e.charCodeAt(s)),n=ci(e.charCodeAt(s+1));if(void 0===r||void 0===n){let t=e[s]+e[s+1];throw Error('hex string expected, got non-hex character "'+t+'" at index '+s)}i[t]=16*r+n}return i}function cn(e){return ct(a7(e))}function co(e){return a6(e),ct(a7(Uint8Array.from(e).reverse()))}function ca(e,t){return cs(e.toString(16).padStart(2*t,"0"))}function cc(e,t){return ca(e,t).reverse()}function cl(e,t,r){let i;if("string"==typeof t)try{i=cs(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(a5(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let s=i.length;if("number"==typeof r&&s!==r)throw Error(e+" of length "+r+" expected, got "+s);return i}function ch(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];a6(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let s=e[t];r.set(s,i),i+=s.length}return r}let cu=e=>"bigint"==typeof e&&a2<=e;function cd(e,t,r){return cu(e)&&cu(t)&&cu(r)&&t<=e&&e<r}function cp(e,t,r,i){if(!cd(t,r,i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}function cf(e){let t;for(t=0;e>a2;e>>=a8,t+=1);return t}let cg=e=>(a3<<BigInt(e-1))-a8,cy=e=>new Uint8Array(e),cm=e=>Uint8Array.from(e);function cb(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let i=cy(e),s=cy(e),n=0,o=()=>{i.fill(1),s.fill(0),n=0},a=(...e)=>r(s,i,...e),c=(e=cy())=>{s=a(cm([0]),e),i=a(),0!==e.length&&(s=a(cm([1]),e),i=a())},l=()=>{if(n++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){i=a();let t=i.slice();r.push(t),e+=i.length}return ch(...r)};return(e,t)=>{let r;for(o(),c(e);!(r=t(l()));)c();return o(),r}}let cw={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||a5(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function cv(e,t,r={}){let i=(t,r,i)=>{let s=cw[r];if("function"!=typeof s)throw Error("invalid validator function");let n=e[t];if(!(i&&void 0===n)&&!s(n,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+n)};for(let[e,r]of Object.entries(t))i(e,r,!1);for(let[e,t]of Object.entries(r))i(e,t,!0);return e}function cE(e){let t=new WeakMap;return(r,...i)=>{let s=t.get(r);if(void 0!==s)return s;let n=e(r,...i);return t.set(r,n),n}}var c_=Object.freeze({__proto__:null,isBytes:a5,abytes:a6,abool:a4,bytesToHex:a7,numberToHexUnpadded:ce,hexToNumber:ct,hexToBytes:cs,bytesToNumberBE:cn,bytesToNumberLE:co,numberToBytesBE:ca,numberToBytesLE:cc,numberToVarBytesBE:function(e){return cs(ce(e))},ensureBytes:cl,concatBytes:ch,equalBytes:function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r},utf8ToBytes:function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))},inRange:cd,aInRange:cp,bitLen:cf,bitGet:function(e,t){return e>>BigInt(t)&a8},bitSet:function(e,t,r){return e|(r?a8:a2)<<BigInt(t)},bitMask:cg,createHmacDrbg:cb,validateObject:cv,notImplemented:()=>{throw Error("not implemented")},memoized:cE});let cI=BigInt(0),cD=BigInt(1),cS=BigInt(2),cP=BigInt(3),cO=BigInt(4),cx=BigInt(5),cA=BigInt(8);function cC(e,t){let r=e%t;return r>=cI?r:t+r}function cT(e,t,r){if(t<cI)throw Error("invalid exponent, negatives unsupported");if(r<=cI)throw Error("invalid modulus");if(r===cD)return cI;let i=cD;for(;t>cI;)t&cD&&(i=i*e%r),e=e*e%r,t>>=cD;return i}function cN(e,t,r){let i=e;for(;t-- >cI;)i*=i,i%=r;return i}function cR(e,t){if(e===cI)throw Error("invert: expected non-zero number");if(t<=cI)throw Error("invert: expected positive modulus, got "+t);let r=cC(e,t),i=t,s=cI,n=cD;for(;r!==cI;){let e=i/r,t=i%r,o=s-n*e;i=r,r=t,s=n,n=o}if(i!==cD)throw Error("invert: does not exist");return cC(s,t)}let cj=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ck(e,t){let r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function cU(e,t,r=!1,i={}){let s;if(e<=cI)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:n,nByteLength:o}=ck(e,t);if(o>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let a=Object.freeze({ORDER:e,isLE:r,BITS:n,BYTES:o,MASK:cg(n),ZERO:cI,ONE:cD,create:t=>cC(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return cI<=t&&t<e},is0:e=>e===cI,isOdd:e=>(e&cD)===cD,neg:t=>cC(-t,e),eql:(e,t)=>e===t,sqr:t=>cC(t*t,e),add:(t,r)=>cC(t+r,e),sub:(t,r)=>cC(t-r,e),mul:(t,r)=>cC(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<cI)throw Error("invalid exponent, negatives unsupported");if(r===cI)return e.ONE;if(r===cD)return t;let i=e.ONE,s=t;for(;r>cI;)r&cD&&(i=e.mul(i,s)),s=e.sqr(s),r>>=cD;return i})(a,e,t),div:(t,r)=>cC(t*cR(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>cR(t,e),sqrt:i.sqrt||(t=>(s||(s=function(e){if(e%cO===cP){let t=(e+cD)/cO;return function(e,r){let i=e.pow(r,t);if(!e.eql(e.sqr(i),r))throw Error("Cannot find square root");return i}}if(e%cA===cx){let t=(e-cx)/cA;return function(e,r){let i=e.mul(r,cS),s=e.pow(i,t),n=e.mul(r,s),o=e.mul(e.mul(n,cS),s),a=e.mul(n,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),r))throw Error("Cannot find square root");return a}}return function(e){let t,r,i;let s=(e-cD)/cS;for(t=e-cD,r=0;t%cS===cI;t/=cS,r++);for(i=cS;i<e&&cT(i,s,e)!==e-cD;i++)if(i>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===r){let t=(e+cD)/cO;return function(e,r){let i=e.pow(r,t);if(!e.eql(e.sqr(i),r))throw Error("Cannot find square root");return i}}let n=(t+cD)/cS;return function(e,o){if(e.pow(o,s)===e.neg(e.ONE))throw Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),t),l=e.pow(o,n),h=e.pow(o,t);for(;!e.eql(h,e.ONE);){if(e.eql(h,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(h);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(c,cD<<BigInt(a-t-1));c=e.sqr(r),l=e.mul(l,r),h=e.mul(h,c),a=t}return l}}(e)}(e)),s(a,t))),invertBatch:e=>(function(e,t){let r=Array(t.length),i=t.reduce((t,i,s)=>e.is0(i)?t:(r[s]=t,e.mul(t,i)),e.ONE),s=e.inv(i);return t.reduceRight((t,i,s)=>e.is0(i)?t:(r[s]=e.mul(t,r[s]),e.mul(t,i)),s),r})(a,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?cc(e,o):ca(e,o),fromBytes:e=>{if(e.length!==o)throw Error("Field.fromBytes: expected "+o+" bytes, got "+e.length);return r?co(e):cn(e)}});return Object.freeze(a)}function cB(e){if("bigint"!=typeof e)throw Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function cL(e){let t=cB(e);return t+Math.ceil(t/2)}let cq=BigInt(0),c$=BigInt(1);function cM(e,t){let r=t.negate();return e?r:t}function cz(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function cF(e,t){cz(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1);return{windows:r,windowSize:i}}let cH=new WeakMap,cV=new WeakMap;function cK(e){return cV.get(e)||1}function cW(e){return function(e){let t=cj.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});cv(e,t)}(e.Fp),cv(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ck(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);let cG=BigInt(0),cY=BigInt(1),cJ=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);let cZ=BigInt(1),cQ=BigInt(2),cX=BigInt(3),c0=BigInt(5);BigInt(8);let c1=function(e){let t=(cv(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})),{P:r}=t,i=e=>cC(e,r),s=t.montgomeryBits,n=Math.ceil(s/8),o=t.nByteLength,a=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>cT(e,r-BigInt(2),r));function l(e,t,r){let s=i(e*(t-r));return[t=i(t-s),r=i(r+s)]}let h=(t.a-BigInt(2))/BigInt(4);function u(e,t){let u=function(e){let t=cl("u coordinate",e,n);return 32===o&&(t[31]&=127),co(t)}(t),d=function(e){let t=cl("scalar",e),r=t.length;if(r!==n&&r!==o)throw Error("invalid scalar, expected "+n+" or "+o+" bytes, got "+r);return co(a(t))}(e),p=function(e,t){cp("u",e,cG,r),cp("scalar",t,cG,r);let n=cY,o=cG,a=e,u=cY,d=cG,p;for(let r=BigInt(s-1);r>=cG;r--){let s=t>>r&cY;d^=s,n=(p=l(d,n,a))[0],a=p[1],o=(p=l(d,o,u))[0],u=p[1],d=s;let c=n+o,f=i(c*c),g=n-o,y=i(g*g),m=f-y,b=a+u,w=a-u,v=i(w*c),E=i(b*g),_=v+E,I=v-E;a=i(_*_),u=i(e*i(I*I)),n=i(f*y),o=i(m*(f+i(h*m)))}n=(p=l(d,n,a))[0],a=p[1],o=(p=l(d,o,u))[0],u=p[1];let f=c(o);return i(n*f)}(u,d);if(p===cG)throw Error("invalid private or public key received");return cc(i(p),n)}let d=cc(i(t.Gu),n);function p(e){return u(e,d)}return{scalarMult:u,scalarMultBase:p,getSharedSecret:(e,t)=>u(e,t),getPublicKey:e=>p(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:d}}({P:cJ,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{let{pow_p_5_8:t,b2:r}=function(e){let t=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=e*e%cJ*e%cJ,o=cN(n,cQ,cJ)*n%cJ,a=cN(o,cZ,cJ)*e%cJ,c=cN(a,c0,cJ)*a%cJ,l=cN(c,t,cJ)*c%cJ,h=cN(l,r,cJ)*l%cJ,u=cN(h,i,cJ)*h%cJ,d=cN(u,s,cJ)*u%cJ,p=cN(d,s,cJ)*u%cJ,f=cN(p,t,cJ)*c%cJ;return{pow_p_5_8:cN(f,cQ,cJ)*e%cJ,b2:n}}(e);return cC(cN(t,cX,cJ)*r,cJ)},adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e},randomBytes:oB});function c2(e){void 0!==e.lowS&&a4("lowS",e.lowS),void 0!==e.prehash&&a4("prehash",e.prehash)}let{bytesToNumberBE:c8,hexToBytes:c3}=c_,c5={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=c5;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let i=t.length/2,s=ce(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");let n=i>127?ce(s.length/2|128):"";return ce(e)+n+s+t},decode(e,t){let{Err:r}=c5,i=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[i++]!==e)throw new r("tlv.decode: wrong tlv");let s=t[i++],n=!!(128&s),o=0;if(n){let e=127&s;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let n=t.subarray(i,i+e);if(n.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===n[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of n)o=o<<8|e;if(i+=e,o<128)throw new r("tlv.decode(long): not minimal encoding")}else o=s;let a=t.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(i+o)}}},_int:{encode(e){let{Err:t}=c5;if(e<c6)throw new t("integer: negative integers are not allowed");let r=ce(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=c5;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return c8(e)}},toSig(e){let{Err:t,_int:r,_tlv:i}=c5,s="string"==typeof e?c3(e):e;a6(s);let{v:n,l:o}=i.decode(48,s);if(o.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=i.decode(2,n),{v:l,l:h}=i.decode(2,c);if(h.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(e){let{_tlv:t,_int:r}=c5,i=t.encode(2,r.encode(e.r)),s=t.encode(2,r.encode(e.s));return t.encode(48,i+s)}},c6=BigInt(0),c4=BigInt(1);BigInt(2);let c9=BigInt(3);BigInt(4);let c7=cU(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),le=c7.create(BigInt("-3")),lt=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),lr=function(e,t){let r=t=>(function(e){let t=function(e){let t=cW(e);return cv(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:r,n:i}=t,s=r.BYTES+1,n=2*r.BYTES+1;function o(e){return cC(e,i)}let{ProjectivePoint:a,normPrivateKeyToScalar:c,weierstrassEquation:l,isWithinCurveOrder:h}=function(e){var t;let r=function(e){let t=cW(e);cv(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:i,a:s}=t;if(r){if(!i.eql(s,i.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:i}=r,s=cU(r.n,r.nBitLength),n=r.toBytes||((e,t,r)=>{let s=t.toAffine();return ch(Uint8Array.from([4]),i.toBytes(s.x),i.toBytes(s.y))}),o=r.fromBytes||(e=>{let t=e.subarray(1),r=i.fromBytes(t.subarray(0,i.BYTES)),s=i.fromBytes(t.subarray(i.BYTES,2*i.BYTES));return{x:r,y:s}});function a(e){let{a:t,b:s}=r,n=i.sqr(e),o=i.mul(n,e);return i.add(i.add(o,i.mul(e,t)),s)}if(!i.eql(i.sqr(r.Gy),a(r.Gx)))throw Error("bad generator point: equation left != right");function c(e){let t;let{allowedPrivateKeyLengths:i,nByteLength:s,wrapPrivateKey:n,n:o}=r;if(i&&"bigint"!=typeof e){if(a5(e)&&(e=a7(e)),"string"!=typeof e||!i.includes(e.length))throw Error("invalid private key");e=e.padStart(2*s,"0")}try{t="bigint"==typeof e?e:cn(cl("private key",e,s))}catch{throw Error("invalid private key, expected hex or "+s+" bytes, got "+typeof e)}return n&&(t=cC(t,o)),cp("private key",t,c4,o),t}function l(e){if(!(e instanceof d))throw Error("ProjectivePoint expected")}let h=cE((e,t)=>{let{px:r,py:s,pz:n}=e;if(i.eql(n,i.ONE))return{x:r,y:s};let o=e.is0();null==t&&(t=o?i.ONE:i.inv(n));let a=i.mul(r,t),c=i.mul(s,t),l=i.mul(n,t);if(o)return{x:i.ZERO,y:i.ZERO};if(!i.eql(l,i.ONE))throw Error("invZ was invalid");return{x:a,y:c}}),u=cE(e=>{if(e.is0()){if(r.allowInfinityPoint&&!i.is0(e.py))return;throw Error("bad point: ZERO")}let{x:t,y:s}=e.toAffine();if(!i.isValid(t)||!i.isValid(s))throw Error("bad point: x or y not FE");let n=i.sqr(s),o=a(t);if(!i.eql(n,o))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class d{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!i.isValid(e))throw Error("x required");if(null==t||!i.isValid(t))throw Error("y required");if(null==r||!i.isValid(r))throw Error("z required");Object.freeze(this)}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof d)throw Error("projective point not allowed");let s=e=>i.eql(e,i.ZERO);return s(t)&&s(r)?d.ZERO:new d(t,r,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=i.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(d.fromAffine)}static fromHex(e){let t=d.fromAffine(o(cl("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return d.BASE.multiply(c(e))}static msm(e,t){return function(e,t,r,i){if(function(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})}(r,e),function(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}(i,t),r.length!==i.length)throw Error("arrays of points and scalars must have equal length");let s=e.ZERO,n=cf(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=Array(a+1).fill(s),l=Math.floor((t.BITS-1)/o)*o,h=s;for(let e=l;e>=0;e-=o){c.fill(s);for(let t=0;t<i.length;t++){let s=i[t],n=Number(s>>BigInt(e)&BigInt(a));c[n]=c[n].add(r[t])}let t=s;for(let e=c.length-1,r=s;e>0;e--)r=r.add(c[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<o;e++)h=h.double()}return h}(d,s,e,t)}_setWindowSize(e){f.setWindowSize(this,e)}assertValidity(){u(this)}hasEvenY(){let{y:e}=this.toAffine();if(i.isOdd)return!i.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){l(e);let{px:t,py:r,pz:s}=this,{px:n,py:o,pz:a}=e,c=i.eql(i.mul(t,a),i.mul(n,s)),h=i.eql(i.mul(r,a),i.mul(o,s));return c&&h}negate(){return new d(this.px,i.neg(this.py),this.pz)}double(){let{a:e,b:t}=r,s=i.mul(t,c9),{px:n,py:o,pz:a}=this,c=i.ZERO,l=i.ZERO,h=i.ZERO,u=i.mul(n,n),p=i.mul(o,o),f=i.mul(a,a),g=i.mul(n,o);return g=i.add(g,g),h=i.mul(n,a),h=i.add(h,h),c=i.mul(e,h),l=i.mul(s,f),l=i.add(c,l),c=i.sub(p,l),l=i.add(p,l),l=i.mul(c,l),c=i.mul(g,c),h=i.mul(s,h),f=i.mul(e,f),g=i.sub(u,f),g=i.mul(e,g),g=i.add(g,h),h=i.add(u,u),u=i.add(h,u),u=i.add(u,f),u=i.mul(u,g),l=i.add(l,u),f=i.mul(o,a),f=i.add(f,f),u=i.mul(f,g),c=i.sub(c,u),h=i.mul(f,p),h=i.add(h,h),h=i.add(h,h),new d(c,l,h)}add(e){l(e);let{px:t,py:s,pz:n}=this,{px:o,py:a,pz:c}=e,h=i.ZERO,u=i.ZERO,p=i.ZERO,f=r.a,g=i.mul(r.b,c9),y=i.mul(t,o),m=i.mul(s,a),b=i.mul(n,c),w=i.add(t,s),v=i.add(o,a);w=i.mul(w,v),v=i.add(y,m),w=i.sub(w,v),v=i.add(t,n);let E=i.add(o,c);return v=i.mul(v,E),E=i.add(y,b),v=i.sub(v,E),E=i.add(s,n),h=i.add(a,c),E=i.mul(E,h),h=i.add(m,b),E=i.sub(E,h),p=i.mul(f,v),h=i.mul(g,b),p=i.add(h,p),h=i.sub(m,p),p=i.add(m,p),u=i.mul(h,p),m=i.add(y,y),m=i.add(m,y),b=i.mul(f,b),v=i.mul(g,v),m=i.add(m,b),b=i.sub(y,b),b=i.mul(f,b),v=i.add(v,b),y=i.mul(m,v),u=i.add(u,y),y=i.mul(E,v),h=i.mul(w,h),h=i.sub(h,y),y=i.mul(w,m),p=i.mul(E,p),p=i.add(p,y),new d(h,u,p)}subtract(e){return this.add(e.negate())}is0(){return this.equals(d.ZERO)}wNAF(e){return f.wNAFCached(this,e,d.normalizeZ)}multiplyUnsafe(e){let{endo:t,n:s}=r;cp("scalar",e,c6,s);let n=d.ZERO;if(e===c6)return n;if(this.is0()||e===c4)return this;if(!t||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,e,d.normalizeZ);let{k1neg:o,k1:a,k2neg:c,k2:l}=t.splitScalar(e),h=n,u=n,p=this;for(;a>c6||l>c6;)a&c4&&(h=h.add(p)),l&c4&&(u=u.add(p)),p=p.double(),a>>=c4,l>>=c4;return o&&(h=h.negate()),c&&(u=u.negate()),u=new d(i.mul(u.px,t.beta),u.py,u.pz),h.add(u)}multiply(e){let t,s;let{endo:n,n:o}=r;if(cp("scalar",e,c4,o),n){let{k1neg:r,k1:o,k2neg:a,k2:c}=n.splitScalar(e),{p:l,f:h}=this.wNAF(o),{p:u,f:p}=this.wNAF(c);l=f.constTimeNegate(r,l),u=f.constTimeNegate(a,u),u=new d(i.mul(u.px,n.beta),u.py,u.pz),t=l.add(u),s=h.add(p)}else{let{p:r,f:i}=this.wNAF(e);t=r,s=i}return d.normalizeZ([t,s])[0]}multiplyAndAddUnsafe(e,t,r){let i=d.BASE,s=(e,t)=>t!==c6&&t!==c4&&e.equals(i)?e.multiply(t):e.multiplyUnsafe(t),n=s(this,t).add(s(e,r));return n.is0()?void 0:n}toAffine(e){return h(this,e)}isTorsionFree(){let{h:e,isTorsionFree:t}=r;if(e===c4)return!0;if(t)return t(d,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:t}=r;return e===c4?this:t?t(d,this):this.multiplyUnsafe(r.h)}toRawBytes(e=!0){return a4("isCompressed",e),this.assertValidity(),n(d,this,e)}toHex(e=!0){return a4("isCompressed",e),a7(this.toRawBytes(e))}}d.BASE=new d(r.Gx,r.Gy,i.ONE),d.ZERO=new d(i.ZERO,i.ONE,i.ZERO);let p=r.nBitLength,f=(t=r.endo?Math.ceil(p/2):p,{constTimeNegate:cM,hasPrecomputes:e=>1!==cK(e),unsafeLadder(e,t,r=d.ZERO){let i=e;for(;t>cq;)t&c$&&(r=r.add(i)),i=i.double(),t>>=c$;return r},precomputeWindow(e,r){let{windows:i,windowSize:s}=cF(r,t),n=[],o=e,a=o;for(let e=0;e<i;e++){a=o,n.push(a);for(let e=1;e<s;e++)a=a.add(o),n.push(a);o=a.double()}return n},wNAF(e,r,i){let{windows:s,windowSize:n}=cF(e,t),o=d.ZERO,a=d.BASE,c=BigInt(2**e-1),l=2**e,h=BigInt(e);for(let e=0;e<s;e++){let t=e*n,s=Number(i&c);i>>=h,s>n&&(s-=l,i+=c$);let u=t+Math.abs(s)-1,d=e%2!=0,p=s<0;0===s?a=a.add(cM(d,r[t])):o=o.add(cM(p,r[u]))}return{p:o,f:a}},wNAFUnsafe(e,r,i,s=d.ZERO){let{windows:n,windowSize:o}=cF(e,t),a=BigInt(2**e-1),c=2**e,l=BigInt(e);for(let e=0;e<n;e++){let t=e*o;if(i===cq)break;let n=Number(i&a);if(i>>=l,n>o&&(n-=c,i+=c$),0===n)continue;let h=r[t+Math.abs(n)-1];n<0&&(h=h.negate()),s=s.add(h)}return s},getPrecomputes(e,t,r){let i=cH.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&cH.set(t,r(i))),i},wNAFCached(e,t,r){let i=cK(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)},wNAFCachedUnsafe(e,t,r,i){let s=cK(e);return 1===s?this.unsafeLadder(e,t,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,i)},setWindowSize(e,r){cz(r,t),cV.set(e,r),cH.delete(e)}});return{CURVE:r,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:a,isWithinCurveOrder:function(e){return cd(e,c4,r.n)}}}({...t,toBytes(e,t,i){let s=t.toAffine(),n=r.toBytes(s.x);return a4("isCompressed",i),i?ch(Uint8Array.from([t.hasEvenY()?2:3]),n):ch(Uint8Array.from([4]),n,r.toBytes(s.y))},fromBytes(e){let t=e.length,i=e[0],o=e.subarray(1);if(t===s&&(2===i||3===i)){let e;let t=cn(o);if(!cd(t,c4,r.ORDER))throw Error("Point is not on curve");let s=l(t);try{e=r.sqrt(s)}catch(t){let e=t instanceof Error?": "+t.message:"";throw Error("Point is not on curve"+e)}let n=(e&c4)===c4;return(1&i)==1!==n&&(e=r.neg(e)),{x:t,y:e}}if(t===n&&4===i){let e=r.fromBytes(o.subarray(0,r.BYTES)),t=r.fromBytes(o.subarray(r.BYTES,2*r.BYTES));return{x:e,y:t}}throw Error("invalid Point, expected length of "+s+", or uncompressed "+n+", got "+t)}}),u=e=>a7(ca(e,t.nByteLength));function d(e){let t=i>>c4;return e>t}let p=(e,t,r)=>cn(e.slice(t,r));class f{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){let r=t.nByteLength;return e=cl("compactSignature",e,2*r),new f(p(e,0,r),p(e,r,2*r))}static fromDER(e){let{r:t,s:r}=c5.toSig(cl("DER",e));return new f(t,r)}assertValidity(){cp("r",this.r,c4,i),cp("s",this.s,c4,i)}addRecoveryBit(e){return new f(this.r,this.s,e)}recoverPublicKey(e){let{r:s,s:n,recovery:c}=this,l=m(cl("msgHash",e));if(null==c||![0,1,2,3].includes(c))throw Error("recovery id invalid");let h=2===c||3===c?s+t.n:s;if(h>=r.ORDER)throw Error("recovery id 2 or 3 invalid");let d=(1&c)==0?"02":"03",p=a.fromHex(d+u(h)),f=cR(h,i),g=o(-l*f),y=o(n*f),b=a.BASE.multiplyAndAddUnsafe(p,g,y);if(!b)throw Error("point at infinify");return b.assertValidity(),b}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return cs(this.toDERHex())}toDERHex(){return c5.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return cs(this.toCompactHex())}toCompactHex(){return u(this.r)+u(this.s)}}function g(e){let t=a5(e),r="string"==typeof e,i=(t||r)&&e.length;return t?i===s||i===n:r?i===2*s||i===2*n:e instanceof a}let y=t.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let r=cn(e),i=8*e.length-t.nBitLength;return i>0?r>>BigInt(i):r},m=t.bits2int_modN||function(e){return o(y(e))},b=cg(t.nBitLength);function w(e){return cp("num < 2^"+t.nBitLength,e,c6,b),ca(e,t.nByteLength)}let v={lowS:t.lowS,prehash:!1},E={lowS:t.lowS,prehash:!1};return a.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return a.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(g(e))throw Error("first arg must be private key");if(!g(t))throw Error("second arg must be public key");return a.fromHex(t).multiply(c(e)).toRawBytes(r)},sign:function(e,s,n=v){let{seed:l,k2sig:u}=function(e,s,n=v){if(["recovered","canonical"].some(e=>e in n))throw Error("sign() legacy options not supported");let{hash:l,randomBytes:u}=t,{lowS:p,prehash:g,extraEntropy:b}=n;null==p&&(p=!0),e=cl("msgHash",e),c2(n),g&&(e=cl("prehashed msgHash",l(e)));let E=m(e),_=c(s),I=[w(_),w(E)];if(null!=b&&!1!==b){let e=!0===b?u(r.BYTES):b;I.push(cl("extraEntropy",e))}let D=ch(...I);return{seed:D,k2sig:function(e){let t=y(e);if(!h(t))return;let r=cR(t,i),s=a.BASE.multiply(t).toAffine(),n=o(s.x);if(n===c6)return;let c=o(r*o(E+n*_));if(c===c6)return;let l=(s.x===n?0:2)|Number(s.y&c4),u=c;return p&&d(c)&&(u=d(c)?o(-c):c,l^=1),new f(n,u,l)}}}(e,s,n);return cb(t.hash.outputLen,t.nByteLength,t.hmac)(l,u)},verify:function(e,r,s,n=E){let c,l;r=cl("msgHash",r),s=cl("publicKey",s);let{lowS:h,prehash:u,format:d}=n;if(c2(n),"strict"in n)throw Error("options.strict was renamed to lowS");if(void 0!==d&&"compact"!==d&&"der"!==d)throw Error("format must be compact or der");let p="string"==typeof e||a5(e),g=!p&&!d&&"object"==typeof e&&null!==e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!p&&!g)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(g&&(c=new f(e.r,e.s)),p){try{"compact"!==d&&(c=f.fromDER(e))}catch(e){if(!(e instanceof c5.Err))throw e}c||"der"===d||(c=f.fromCompact(e))}l=a.fromHex(s)}catch{return!1}if(!c||h&&c.hasHighS())return!1;u&&(r=t.hash(r));let{r:y,s:b}=c,w=m(r),v=cR(b,i),_=o(w*v),I=o(y*v),D=a.BASE.multiplyAndAddUnsafe(l,_,I)?.toAffine();return!!D&&o(D.x)===y},ProjectivePoint:a,Signature:f,utils:{isValidPrivateKey(e){try{return c(e),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{let e=cL(t.n);return function(e,t,r=!1){let i=e.length,s=cB(t),n=cL(t);if(i<16||i<n||i>1024)throw Error("expected "+n+"-1024 bytes of input, got "+i);let o=r?co(e):cn(e),a=cC(o,t-cD)+cD;return r?cc(a,s):ca(a,s)}(t.randomBytes(e),t.n)},precompute:(e=8,t=a.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}})({...e,hash:t,hmac:(e,...r)=>aK(t,e,function(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];ow(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let s=e[t];r.set(s,i),i+=s.length}return r}(...r)),randomBytes:oB});return{...r(t),create:r}}({a:le,b:lt,Fp:c7,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},a1),li="base10",ls="base16",ln="base64pad",lo="base64url",la="utf8";function lc(){let e=oB(32);return nz(e,ls)}function ll(e){let t=a1(nM(e,ls));return nz(t,ls)}function lh(e){let t=a1(nM(e,la));return nz(t,ls)}function lu(e){return Number(nz(e,li))}function ld(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function lp(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4;return t+"=".repeat(r)}function lf(e){if(2===lu(e.type))return nz(sw([e.type,e.sealed]),ln);if(1===lu(e.type)){if(typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return nz(sw([e.type,e.senderPublicKey,e.iv,e.sealed]),ln)}return nz(sw([e.type,e.iv,e.sealed]),ln)}function lg(e){let t=(e.encoding||ln)===lo?lp(e.encoded):e.encoded,r=nM(t,ln),i=r.slice(0,1);if(1===lu(i)){let e=r.slice(1,33),t=r.slice(33,45),s=r.slice(45);return{type:i,sealed:s,iv:t,senderPublicKey:e}}if(2===lu(i)){let e=r.slice(1),t=oB(12);return{type:i,sealed:e,iv:t}}let s=r.slice(1,13),n=r.slice(13);return{type:i,sealed:n,iv:s}}function ly(e){let t=e?.type||0;if(1===t){if(typeof e?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function lm(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function lb(e){return e?.relay||{protocol:"irn"}}function lw(e){let t=nF[e];if(typeof t>"u")throw Error(`Relay Protocol not supported: ${e}`);return t}function lv(e){var t;if(!e.includes("wc:")){let t=om(e);null!=t&&t.includes("wc:")&&(e=t)}e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e;let r=e.indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,s=e.substring(0,r),n=e.substring(r+1,i).split("@"),o="u">typeof i?e.substring(i):"",a=new URLSearchParams(o),c={};a.forEach((e,t)=>{c[t]=e});let l="string"==typeof c.methods?c.methods.split(","):void 0;return{protocol:s,topic:(t=n[0]).startsWith("//")?t.substring(2):t,version:parseInt(n[1],10),symKey:c.symKey,relay:function(e,t="-"){let r={},i="relay"+t;return Object.keys(e).forEach(t=>{if(t.startsWith(i)){let s=t.replace(i,""),n=e[t];r[s]=n}}),r}(c),methods:l,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function lE(e){let t=new URLSearchParams,r=function(e,t="-"){let r={};return Object.keys(e).forEach(i=>{e[i]&&(r["relay"+t+i]=e[i])}),r}(e.relay);Object.keys(r).sort().forEach(e=>{t.set(e,r[e])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));let i=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${i}`}function l_(e,t,r){return`${e}?wc_ev=${r}&topic=${t}`}function lI(e){let t=[];return e.forEach(e=>{let[r,i]=e.split(":");t.push(`${r}:${i}`)}),t}function lD(e){return e.includes(":")}function lS(e){return lD(e)?e.split(":")[0]:e}function lP(e,t){t=t.map(e=>e.replace("did:pkh:",""));let r=function(e){let t={};return e?.forEach(e=>{var r;let[i,s]=e.split(":");t[i]||(t[i]={accounts:[],chains:[],events:[],methods:[]}),t[i].accounts.push(e),null==(r=t[i].chains)||r.push(`${i}:${s}`)}),t}(t);for(let[t,i]of Object.entries(r))i.methods?i.methods=ou(i.methods,e):i.methods=e,i.events=["chainChanged","accountsChanged"];return r}Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let lO={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},lx={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function lA(e,t){let{message:r,code:i}=lx[e];return{message:t?`${r} ${t}`:r,code:i}}function lC(e,t){let{message:r,code:i}=lO[e];return{message:t?`${r} ${t}`:r,code:i}}function lT(e,t){return!!Array.isArray(e)&&(!("u">typeof t)||!e.length||e.every(t))}function lN(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function lR(e){return typeof e>"u"}function lj(e,t){return!!(t&&lR(e))||"string"==typeof e&&!!e.trim().length}function lk(e,t){return!!(t&&lR(e))||"number"==typeof e&&!isNaN(e)}function lU(e){return!!(lj(e,!1)&&e.includes(":"))&&2===e.split(":").length}function lB(e){let t=!0;return lT(e)?e.length&&(t=e.every(e=>lj(e,!1))):t=!1,t}function lL(e,t){let r=null;return Object.values(e).forEach(e=>{var i;let s;if(r)return;let n=(i=`${t}, namespace`,s=null,lB(e?.methods)?lB(e?.events)||(s=lC("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):s=lC("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),s);n&&(r=n)}),r}function lq(e,t){let r=null;if(e&&lN(e)){let i;let s=lL(e,t);s&&(r=s);let n=(i=null,Object.values(e).forEach(e=>{var r,s;let n;if(i)return;let o=(r=e?.accounts,s=`${t} namespace`,n=null,lT(r)?r.forEach(e=>{n||function(e){if(lj(e,!1)&&e.includes(":")){let t=e.split(":");if(3===t.length){let e=t[0]+":"+t[1];return!!t[2]&&lU(e)}}return!1}(e)||(n=lC("UNSUPPORTED_ACCOUNTS",`${s}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):n=lC("UNSUPPORTED_ACCOUNTS",`${s}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n);o&&(i=o)}),i);n&&(r=n)}else r=lA("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function l$(e){return lj(e.protocol,!0)}function lM(e){return"u">typeof e}function lz(e,t){return!(!lU(t)||!(function(e){let t=[];return Object.values(e).forEach(e=>{t.push(...lI(e.accounts))}),t})(e).includes(t))}function lF(e,t,r){let i=null,s=function(e){let t={};return Object.keys(e).forEach(r=>{var i;r.includes(":")?t[r]=e[r]:null==(i=e[r].chains)||i.forEach(i=>{t[i]={methods:e[r].methods,events:e[r].events}})}),t}(e),n=function(e){let t={};return Object.keys(e).forEach(r=>{if(r.includes(":"))t[r]=e[r];else{let i=lI(e[r].accounts);i?.forEach(i=>{t[i]={accounts:e[r].accounts.filter(e=>e.includes(`${i}:`)),methods:e[r].methods,events:e[r].events}})}}),t}(t),o=Object.keys(s),a=Object.keys(n),c=lH(Object.keys(e)),l=lH(Object.keys(t)),h=c.filter(e=>!l.includes(e));return h.length&&(i=lA("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(t).toString()}`)),ot(o,a)||(i=lA("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(":")||i)return;let s=lI(t[e].accounts);s.includes(e)||(i=lA("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${e}
        Required: ${e}
        Approved: ${s.toString()}`))}),o.forEach(e=>{i||(ot(s[e].methods,n[e].methods)?ot(s[e].events,n[e].events)||(i=lA("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${e}`)):i=lA("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${e}`))}),i}function lH(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function lV(){let e=n4();return new Promise(t=>{switch(e){case n8.browser:t(n6()&&navigator?.onLine);break;case n8.reactNative:t(lK());break;case n8.node:default:t(!0)}})}async function lK(){if(n5()&&"u">typeof r.g&&null!=r.g&&r.g.NetInfo){let e=await (null==r.g?void 0:r.g.NetInfo.fetch());return e?.isConnected}return!0}let lW={};class lG{static get(e){return lW[e]}static set(e,t){lW[e]=t}static delete(e){delete lW[e]}}let lY="INTERNAL_ERROR",lJ="SERVER_ERROR",lZ=[-32700,-32600,-32601,-32602,-32603],lQ={PARSE_ERROR:{code:-32700,message:"Parse error"},INVALID_REQUEST:{code:-32600,message:"Invalid Request"},METHOD_NOT_FOUND:{code:-32601,message:"Method not found"},INVALID_PARAMS:{code:-32602,message:"Invalid params"},[lY]:{code:-32603,message:"Internal error"},[lJ]:{code:-32e3,message:"Server error"}};function lX(e){return Object.keys(lQ).includes(e)?lQ[e]:lQ[lJ]}function l0(e,t,r){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?Error(`Unavailable ${r} RPC url at ${t}`):e}var l1=r(97303);function l2(e=3){let t=Date.now()*Math.pow(10,e);return t+Math.floor(Math.random()*Math.pow(10,e))}function l8(e=6){return BigInt(l2(e))}function l3(e,t,r){return{id:r||l2(),jsonrpc:"2.0",method:e,params:t}}function l5(e,t){return{id:e,jsonrpc:"2.0",result:t}}function l6(e,t,r){var i,s;return{id:e,jsonrpc:"2.0",error:void 0===(i=t)?lX(lY):("string"==typeof i&&(i=Object.assign(Object.assign({},lX(lJ)),{message:i})),void 0!==r&&(i.data=r),s=i.code,lZ.includes(s)&&(i=function(e){let t=Object.values(lQ).find(t=>t.code===e);return t||lQ[lJ]}(i.code)),i)}}class l4{}class l9 extends l4{constructor(){super()}}class l7 extends l9{constructor(e){super()}}function he(e,t){let r=function(e){let t=e.match(RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}(e);return void 0!==r&&new RegExp(t).test(r)}function ht(e){return he(e,"^https?:")}function hr(e){return he(e,"^wss?:")}function hi(e){return"object"==typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function hs(e){return hi(e)&&"method"in e}function hn(e){return hi(e)&&(ho(e)||ha(e))}function ho(e){return"result"in e}function ha(e){return"error"in e}class hc extends l7{constructor(e){super(e),this.events=new b.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(l3(e.method,e.params||[],e.id||l8().toString()),t)}async requestStrict(e,t){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(e){i(e)}this.events.on(`${e.id}`,e=>{ha(e)?i(e.error):r(e.result)});try{await this.connection.send(e,t)}catch(e){i(e)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),hn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&3e3===e.code&&this.events.emit("error",Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof e&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}let hl=()=>"u">typeof WebSocket||"u">typeof r.g&&"u">typeof r.g.WebSocket||"u">typeof window&&"u">typeof window.WebSocket||"u">typeof self&&"u">typeof self.WebSocket,hh=e=>e.split("?")[0],hu="u">typeof WebSocket?WebSocket:"u">typeof r.g&&"u">typeof r.g.WebSocket?r.g.WebSocket:"u">typeof window&&"u">typeof window.WebSocket?window.WebSocket:"u">typeof self&&"u">typeof self.WebSocket?self.WebSocket:r(69032);class hd{constructor(e){if(this.url=e,this.events=new b.EventEmitter,this.registering=!1,!hr(e))throw Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return"u">typeof this.socket}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(Error("Connection already closed"));return}this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(W(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!hr(e))throw Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){let e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((e,t)=>{this.events.once("register_error",e=>{this.resetMaxListeners(),t(e)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return t(Error("WebSocket connection is missing or invalid"));e(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{let i=(0,l1.isReactNative)()?void 0:{rejectUnauthorized:!RegExp("wss?://localhost(:d{2,5})?").test(e)},s=new hu(e,[],i);hl()?s.onerror=e=>{r(this.emitError(e.error))}:s.on("error",e=>{r(this.emitError(e))}),s.onopen=()=>{this.onOpen(s),t(s)}})}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;let t="string"==typeof e.data?K(e.data):e.data;this.events.emit("payload",t)}onError(e,t){let r=this.parseError(t),i=r.message||r.toString(),s=l6(e,i);this.events.emit("payload",s)}parseError(e,t=this.url){return l0(e,hh(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(e){let t=this.parseError(Error(e?.message||`WebSocket connection failed for host: ${hh(this.url)}`));return this.events.emit("register_error",t),t}}var hp=r(27669).Buffer,hf=r(28611);let hg="core",hy=`wc@2:${hg}:`,hm={name:hg,logger:"error"},hb={database:":memory:"},hw="client_ed25519_seed",hv=v.ONE_DAY,hE=v.SIX_HOURS,h_="wss://relay.walletconnect.org",hI={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},hD={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},hS="2.19.2",hP={link_mode:"link_mode",relay:"relay"},hO={inbound:"inbound",outbound:"outbound"},hx="WALLETCONNECT_LINK_MODE_APPS",hA={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},hC=(v.FIVE_SECONDS,{wc_pairingDelete:{req:{ttl:v.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:v.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:v.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:v.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:v.ONE_DAY,prompt:!1,tag:0},res:{ttl:v.ONE_DAY,prompt:!1,tag:0}}}),hT={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},hN={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},hR={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},hj="https://verify.walletconnect.org",hk=`${hj}/v3`,hU=["https://verify.walletconnect.com",hj],hB={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},hL={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},hq={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},h$={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},hM={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},hz={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"};var hF=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),o=n.charCodeAt(0);if(255!==r[o])throw TypeError(n+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var i=0,s=0;e[t]===c;)i++,t++;for(var n=(e.length-t)*l+1>>>0,o=new Uint8Array(n);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var u=0,d=n-1;(0!==h||u<s)&&-1!==d;d--,u++)h+=a*o[d]>>>0,o[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var p=n-s;p!==n&&0===o[p];)p++;for(var f=new Uint8Array(i+(n-p)),g=i;p!==n;)f[g++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,s=0,n=t.length;s!==n&&0===t[s];)s++,r++;for(var o=(n-s)*h+1>>>0,l=new Uint8Array(o);s!==n;){for(var u=t[s],d=0,p=o-1;(0!==u||d<i)&&-1!==p;p--,d++)u+=256*l[p]>>>0,l[p]=u%a>>>0,u=u/a>>>0;if(0!==u)throw Error("Non-zero carry");i=d,s++}for(var f=o-i;f!==o&&0===l[f];)f++;for(var g=c.repeat(r);f<o;++f)g+=e.charAt(l[f]);return g},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}};let hH=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")},hV=e=>new TextEncoder().encode(e),hK=e=>new TextDecoder().decode(e);class hW{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class hG{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return hJ(this,e)}}class hY{constructor(e){this.decoders=e}or(e){return hJ(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let hJ=(e,t)=>new hY({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class hZ{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new hW(e,t,r),this.decoder=new hG(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let hQ=({name:e,prefix:t,encode:r,decode:i})=>new hZ(e,t,r,i),hX=({prefix:e,name:t,alphabet:r})=>{let{encode:i,decode:s}=hF(r,t);return hQ({prefix:e,name:t,encode:i,decode:e=>hH(s(e))})},h0=(e,t,r,i)=>{let s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let n=e.length;for(;"="===e[n-1];)--n;let o=new Uint8Array(n*r/8|0),a=0,c=0,l=0;for(let t=0;t<n;++t){let n=s[e[t]];if(void 0===n)throw SyntaxError(`Non-${i} character`);c=c<<r|n,(a+=r)>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw SyntaxError("Unexpected end of data");return o},h1=(e,t,r)=>{let i="="===t[t.length-1],s=(1<<r)-1,n="",o=0,a=0;for(let i=0;i<e.length;++i)for(a=a<<8|e[i],o+=8;o>r;)o-=r,n+=t[s&a>>o];if(o&&(n+=t[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},h2=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>hQ({prefix:t,name:e,encode:e=>h1(e,i,r),decode:t=>h0(t,i,r,e)}),h8=hQ({prefix:"\x00",name:"identity",encode:e=>hK(e),decode:e=>hV(e)});var h3=Object.freeze({__proto__:null,identity:h8});let h5=h2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var h6=Object.freeze({__proto__:null,base2:h5});let h4=h2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var h9=Object.freeze({__proto__:null,base8:h4});let h7=hX({prefix:"9",name:"base10",alphabet:"0123456789"});var ue=Object.freeze({__proto__:null,base10:h7});let ut=h2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ur=h2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ui=Object.freeze({__proto__:null,base16:ut,base16upper:ur});let us=h2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),un=h2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),uo=h2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ua=h2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),uc=h2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ul=h2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uh=h2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),uu=h2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ud=h2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var up=Object.freeze({__proto__:null,base32:us,base32upper:un,base32pad:uo,base32padupper:ua,base32hex:uc,base32hexupper:ul,base32hexpad:uh,base32hexpadupper:uu,base32z:ud});let uf=hX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ug=hX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var uy=Object.freeze({__proto__:null,base36:uf,base36upper:ug});let um=hX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ub=hX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uw=Object.freeze({__proto__:null,base58btc:um,base58flickr:ub});let uv=h2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),uE=h2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),u_=h2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),uI=h2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var uD=Object.freeze({__proto__:null,base64:uv,base64pad:uE,base64url:u_,base64urlpad:uI});let uS=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),uP=uS.reduce((e,t,r)=>(e[r]=t,e),[]),uO=uS.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]),ux=hQ({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=uP[t],"")},decode:function(e){let t=[];for(let r of e){let e=uO[r.codePointAt(0)];if(void 0===e)throw Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var uA=Object.freeze({__proto__:null,base256emoji:ux});function uC(e,t,r){t=t||[],r=r||0;for(var i=r;e>=2147483648;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,uC.bytes=r-i+1,t}function uT(e,t){var r,i=0,t=t||0,s=0,n=t,o=e.length;do{if(n>=o)throw uT.bytes=0,RangeError("Could not decode varint");r=e[n++],i+=s<28?(127&r)<<s:(127&r)*Math.pow(2,s),s+=7}while(r>=128);return uT.bytes=n-t,i}var uN={encode:uC,decode:uT,encodingLength:function(e){return e<128?1:e<16384?2:e<2097152?3:e<268435456?4:e<34359738368?5:e<4398046511104?6:e<562949953421312?7:e<72057594037927940?8:e<0x7fffffffffffffff?9:10}};let uR=(e,t,r=0)=>(uN.encode(e,t,r),t),uj=e=>uN.encodingLength(e),uk=(e,t)=>{let r=t.byteLength,i=uj(e),s=i+uj(r),n=new Uint8Array(s+r);return uR(e,n,0),uR(r,n,i),n.set(t,s),new uU(e,r,t,n)};class uU{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}let uB=({name:e,code:t,encode:r})=>new uL(e,t,r);class uL{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?uk(this.code,t):t.then(e=>uk(this.code,e))}throw Error("Unknown type, must be binary type")}}let uq=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),u$=uB({name:"sha2-256",code:18,encode:uq("SHA-256")}),uM=uB({name:"sha2-512",code:19,encode:uq("SHA-512")});var uz=Object.freeze({__proto__:null,sha256:u$,sha512:uM}),uF=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:hH,digest:e=>uk(0,hH(e))}});new TextEncoder,new TextDecoder;let uH={...h3,...h6,...h9,...ue,...ui,...up,...uy,...uw,...uD,...uA};function uV(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}({...uz,...uF});let uK=uV("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),uW=uV("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),uG={utf8:uK,"utf-8":uK,hex:uH.base16,latin1:uW,ascii:uW,binary:uW,...uH};var uY=Object.defineProperty,uJ=(e,t,r)=>t in e?uY(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uZ=(e,t,r)=>uJ(e,"symbol"!=typeof t?t+"":t,r);class uQ{constructor(e,t){this.core=e,this.logger=t,uZ(this,"keychain",new Map),uZ(this,"name","keychain"),uZ(this,"version","0.3"),uZ(this,"initialized",!1),uZ(this,"storagePrefix",hy),uZ(this,"init",async()=>{if(!this.initialized){let e=await this.getKeyChain();"u">typeof e&&(this.keychain=e),this.initialized=!0}}),uZ(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),uZ(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),uZ(this,"get",e=>{this.isInitialized();let t=this.keychain.get(e);if(typeof t>"u"){let{message:t}=lA("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}),uZ(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=eI(t,this.name)}get context(){return e_(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,or(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?oi(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}}var uX=Object.defineProperty,u0=(e,t,r)=>t in e?uX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u1=(e,t,r)=>u0(e,"symbol"!=typeof t?t+"":t,r);class u2{constructor(e,t,r){this.core=e,this.logger=t,u1(this,"name","crypto"),u1(this,"keychain"),u1(this,"randomSessionIdentifier",lc()),u1(this,"initialized",!1),u1(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),u1(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),u1(this,"getClientId",async()=>{this.isInitialized();let e=await this.getClientSeed(),t=iy(e);return ip(t.publicKey)}),u1(this,"generateKeyPair",()=>{this.isInitialized();let e=function(){let e=c1.utils.randomPrivateKey(),t=c1.getPublicKey(e);return{privateKey:nz(e,ls),publicKey:nz(t,ls)}}();return this.setPrivateKey(e.publicKey,e.privateKey)}),u1(this,"signJWT",async e=>{this.isInitialized();let t=await this.getClientSeed(),r=iy(t),i=this.randomSessionIdentifier;return await im(i,e,hv,r)}),u1(this,"generateSharedKey",(e,t,r)=>{this.isInitialized();let i=this.getPrivateKey(e),s=function(e,t){let r=c1.getSharedSecret(nM(e,ls),nM(t,ls)),i=aY(a1,r,void 0,void 0,32);return nz(i,ls)}(i,t);return this.setSymKey(s,r)}),u1(this,"setSymKey",async(e,t)=>{this.isInitialized();let r=t||ll(e);return await this.keychain.set(r,e),r}),u1(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),u1(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),u1(this,"encode",async(e,t,r)=>{this.isInitialized();let i=ly(r),s=W(t);if(2===i.type)return function(e,t){let r=nM("2",li),i=oB(12),s=nM(e,la),n=lf({type:r,sealed:s,iv:i});return t===lo?ld(n):n}(s,r?.encoding);if(lm(i)){let t=i.senderPublicKey,r=i.receiverPublicKey;e=await this.generateSharedKey(t,r)}let n=this.getSymKey(e),{type:o,senderPublicKey:a}=i;return function(e){let t=nM(`${"u">typeof e.type?e.type:0}`,li);if(1===lu(t)&&typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let r="u">typeof e.senderPublicKey?nM(e.senderPublicKey,ls):void 0,i="u">typeof e.iv?nM(e.iv,ls):oB(12),s=nM(e.symKey,ls),n=aH(s,i).encrypt(nM(e.message,la)),o=lf({type:t,sealed:n,iv:i,senderPublicKey:r});return e.encoding===lo?ld(o):o}({type:o,symKey:n,message:s,senderPublicKey:a,encoding:r?.encoding})}),u1(this,"decode",async(e,t,r)=>{this.isInitialized();let i=function(e,t){let r=lg({encoded:e,encoding:t?.encoding});return ly({type:lu(r.type),senderPublicKey:"u">typeof r.senderPublicKey?nz(r.senderPublicKey,ls):void 0,receiverPublicKey:t?.receiverPublicKey})}(t,r);if(2===i.type){let e=function(e,t){let{sealed:r}=lg({encoded:e,encoding:t});return nz(r,la)}(t,r?.encoding);return K(e)}if(lm(i)){let t=i.receiverPublicKey,r=i.senderPublicKey;e=await this.generateSharedKey(t,r)}try{let i=this.getSymKey(e),s=function(e){let t=nM(e.symKey,ls),{sealed:r,iv:i}=lg({encoded:e.encoded,encoding:e.encoding}),s=aH(t,i).decrypt(r);if(null===s)throw Error("Failed to decrypt");return nz(s,la)}({symKey:i,encoded:t,encoding:r?.encoding});return K(s)}catch(t){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(t)}}),u1(this,"getPayloadType",(e,t=ln)=>{let r=lg({encoded:e,encoding:t});return lu(r.type)}),u1(this,"getPayloadSenderPublicKey",(e,t=ln)=>{let r=lg({encoded:e,encoding:t});return r.senderPublicKey?nz(r.senderPublicKey,ls):void 0}),this.core=e,this.logger=eI(t,this.name),this.keychain=r||new uQ(this.core,this.logger)}get context(){return e_(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(hw)}catch{e=lc(),await this.keychain.set(hw,e)}return function(e,t="utf8"){let r=uG[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(e,"utf8"):r.decoder.decode(`${r.prefix}${e}`)}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}}var u8=Object.defineProperty,u3=Object.defineProperties,u5=Object.getOwnPropertyDescriptors,u6=Object.getOwnPropertySymbols,u4=Object.prototype.hasOwnProperty,u9=Object.prototype.propertyIsEnumerable,u7=(e,t,r)=>t in e?u8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,de=(e,t)=>{for(var r in t||(t={}))u4.call(t,r)&&u7(e,r,t[r]);if(u6)for(var r of u6(t))u9.call(t,r)&&u7(e,r,t[r]);return e},dt=(e,t)=>u3(e,u5(t)),dr=(e,t,r)=>u7(e,"symbol"!=typeof t?t+"":t,r);class di extends eN{constructor(e,t){super(e,t),this.logger=e,this.core=t,dr(this,"messages",new Map),dr(this,"messagesWithoutClientAck",new Map),dr(this,"name","messages"),dr(this,"version","0.3"),dr(this,"initialized",!1),dr(this,"storagePrefix",hy),dr(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let e=await this.getRelayerMessages();"u">typeof e&&(this.messages=e);let t=await this.getRelayerMessagesWithoutClientAck();"u">typeof t&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),dr(this,"set",async(e,t,r)=>{this.isInitialized();let i=lh(t),s=this.messages.get(e);if(typeof s>"u"&&(s={}),"u">typeof s[i])return i;if(s[i]=t,this.messages.set(e,s),r===hO.inbound){let r=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,dt(de({},r),{[i]:t}))}return await this.persist(),i}),dr(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),dr(this,"getWithoutAck",e=>{this.isInitialized();let t={};for(let r of e){let e=this.messagesWithoutClientAck.get(r)||{};t[r]=Object.values(e)}return t}),dr(this,"has",(e,t)=>{this.isInitialized();let r=this.get(e),i=lh(t);return"u">typeof r[i]}),dr(this,"ack",async(e,t)=>{this.isInitialized();let r=this.messagesWithoutClientAck.get(e);if(typeof r>"u")return;let i=lh(t);delete r[i],0===Object.keys(r).length?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,r),await this.persist()}),dr(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=eI(e,this.name),this.core=t}get context(){return e_(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,or(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,or(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?oi(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof e?oi(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}}var ds=Object.defineProperty,dn=Object.defineProperties,da=Object.getOwnPropertyDescriptors,dc=Object.getOwnPropertySymbols,dl=Object.prototype.hasOwnProperty,dh=Object.prototype.propertyIsEnumerable,du=(e,t,r)=>t in e?ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dd=(e,t)=>{for(var r in t||(t={}))dl.call(t,r)&&du(e,r,t[r]);if(dc)for(var r of dc(t))dh.call(t,r)&&du(e,r,t[r]);return e},dp=(e,t)=>dn(e,da(t)),df=(e,t,r)=>du(e,"symbol"!=typeof t?t+"":t,r);class dg extends eR{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,df(this,"events",new b.EventEmitter),df(this,"name","publisher"),df(this,"queue",new Map),df(this,"publishTimeout",(0,v.toMiliseconds)(v.ONE_MINUTE)),df(this,"initialPublishTimeout",(0,v.toMiliseconds)(15*v.ONE_SECOND)),df(this,"needsTransportRestart",!1),df(this,"publish",async(e,t,r)=>{var i;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:r}});let s=r?.ttl||hE,n=lb(r),o=r?.prompt||!1,a=r?.tag||0,c=r?.id||l8().toString(),l={topic:e,message:t,opts:{ttl:s,relay:n,prompt:o,tag:a,id:c,attestation:r?.attestation,tvf:r?.tvf}},h=`Failed to publish payload, please try again. id:${c} tag:${a}`;try{let i=new Promise(async i=>{let n=({id:e})=>{l.opts.id===e&&(this.removeRequestFromQueue(e),this.relayer.events.removeListener(hI.publish,n),i(l))};this.relayer.events.on(hI.publish,n);let h=on(new Promise((i,n)=>{this.rpcPublish({topic:e,message:t,ttl:s,prompt:o,tag:a,id:c,attestation:r?.attestation,tvf:r?.tvf}).then(i).catch(e=>{this.logger.warn(e,e?.message),n(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${c} tag:${a}`);try{await h,this.events.removeListener(hI.publish,n)}catch(e){this.queue.set(c,dp(dd({},l),{attempt:1})),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:c,topic:e,message:t,opts:r}}),await on(i,this.publishTimeout,h)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(i=r?.internal)&&i.throwOnFailedPublish)throw e}finally{this.queue.delete(c)}}),df(this,"on",(e,t)=>{this.events.on(e,t)}),df(this,"once",(e,t)=>{this.events.once(e,t)}),df(this,"off",(e,t)=>{this.events.off(e,t)}),df(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=eI(t,this.name),this.registerEventListeners()}get context(){return e_(this.logger)}async rpcPublish(e){var t,r,i,s;let{topic:n,message:o,ttl:a=hE,prompt:c,tag:l,id:h,attestation:u,tvf:d}=e,p={method:lw(lb().protocol).publish,params:dd({topic:n,message:o,ttl:a,prompt:c,tag:l,attestation:u},d),id:h};lR(null==(t=p.params)?void 0:t.prompt)&&(null==(r=p.params)||delete r.prompt),lR(null==(i=p.params)?void 0:i.tag)&&(null==(s=p.params)||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});let f=await this.relayer.request(p);return this.relayer.events.emit(hI.publish,e),this.logger.debug("Successfully Published Payload"),f}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{let r=e.attempt+1;this.queue.set(t,dp(dd({},e),{attempt:r}));let{topic:i,message:s,opts:n,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(dp(dd({},e),{topic:i,message:s,ttl:n.ttl,prompt:n.prompt,tag:n.tag,id:n.id,attestation:o,tvf:n.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(D.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(hI.connection_stalled);return}this.checkQueue()}),this.relayer.on(hI.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var dy=Object.defineProperty,dm=(e,t,r)=>t in e?dy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,db=(e,t,r)=>dm(e,"symbol"!=typeof t?t+"":t,r);class dw{constructor(){db(this,"map",new Map),db(this,"set",(e,t)=>{let r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),db(this,"get",e=>this.map.get(e)||[]),db(this,"exists",(e,t)=>this.get(e).includes(t)),db(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,t))return;let i=r.filter(e=>e!==t);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),db(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var dv=Object.defineProperty,dE=Object.defineProperties,d_=Object.getOwnPropertyDescriptors,dI=Object.getOwnPropertySymbols,dD=Object.prototype.hasOwnProperty,dS=Object.prototype.propertyIsEnumerable,dP=(e,t,r)=>t in e?dv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dO=(e,t)=>{for(var r in t||(t={}))dD.call(t,r)&&dP(e,r,t[r]);if(dI)for(var r of dI(t))dS.call(t,r)&&dP(e,r,t[r]);return e},dx=(e,t)=>dE(e,d_(t)),dA=(e,t,r)=>dP(e,"symbol"!=typeof t?t+"":t,r);class dC extends eU{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,dA(this,"subscriptions",new Map),dA(this,"topicMap",new dw),dA(this,"events",new b.EventEmitter),dA(this,"name","subscription"),dA(this,"version","0.3"),dA(this,"pending",new Map),dA(this,"cached",[]),dA(this,"initialized",!1),dA(this,"storagePrefix",hy),dA(this,"subscribeTimeout",(0,v.toMiliseconds)(v.ONE_MINUTE)),dA(this,"initialSubscribeTimeout",(0,v.toMiliseconds)(15*v.ONE_SECOND)),dA(this,"clientId"),dA(this,"batchSubscribeTopicsLimit",500),dA(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),dA(this,"subscribe",async(e,t)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{let r=lb(t),i={topic:e,relay:r,transportType:t?.transportType};this.pending.set(e,i);let s=await this.rpcSubscribe(e,r,t);return"string"==typeof s&&(this.onSubscribe(s,i),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),s}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}),dA(this,"unsubscribe",async(e,t)=>{this.isInitialized(),"u">typeof t?.id?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),dA(this,"isSubscribed",e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),dA(this,"isKnownTopic",e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),dA(this,"on",(e,t)=>{this.events.on(e,t)}),dA(this,"once",(e,t)=>{this.events.once(e,t)}),dA(this,"off",(e,t)=>{this.events.off(e,t)}),dA(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),dA(this,"start",async()=>{await this.onConnect()}),dA(this,"stop",async()=>{await this.onDisconnect()}),dA(this,"restart",async()=>{await this.restore(),await this.onRestart()}),dA(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),dA(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(D.pulse,async()=>{await this.checkPending()}),this.events.on(hA.created,async e=>{let t=hA.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(hA.deleted,async e=>{let t=hA.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}),this.relayer=e,this.logger=eI(t,this.name),this.clientId=""}get context(){return e_(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let r=this.topicMap.get(e);await Promise.all(r.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{let i=lb(r);await this.restartToComplete({topic:e,id:t,relay:i}),await this.rpcUnsubscribe(e,t,i);let s=lC("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}async rpcSubscribe(e,t,r){var i;r&&r?.transportType!==hP.relay||await this.restartToComplete({topic:e,id:e,relay:t});let s={method:lw(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let n=null==(i=r?.internal)?void 0:i.throwOnFailedPublish;try{let t=await this.getSubscriptionId(e);if(r?.transportType===hP.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(e=>this.logger.warn(e))},(0,v.toMiliseconds)(v.ONE_SECOND)),t;let i=new Promise(async t=>{let r=i=>{i.topic===e&&(this.events.removeListener(hA.created,r),t(i.id))};this.events.on(hA.created,r);try{let i=await on(new Promise((e,t)=>{this.relayer.request(s).catch(e=>{this.logger.warn(e,e?.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(hA.created,r),t(i)}catch{}}),o=await on(i,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!o&&n)throw Error(`Subscribing to ${e} failed, please try again`);return o?t:null}catch(e){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(hI.connection_stalled),n)throw e}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t=e[0].relay,r={method:lw(t.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await on(new Promise(e=>{this.relayer.request(r).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(hI.connection_stalled)}}async rpcBatchFetchMessages(e){let t;if(!e.length)return;let r=e[0].relay,i={method:lw(r.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{t=await await on(new Promise((e,t)=>{this.relayer.request(i).catch(e=>{this.logger.warn(e),t(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(hI.connection_stalled)}return t}rpcUnsubscribe(e,t,r){let i={method:lw(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,dx(dO({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,dO({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,dO({},t)),this.topicMap.set(t.topic,e),this.events.emit(hA.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:t}=lA("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(hA.deleted,dx(dO({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(hA.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){let t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(hA.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){let{message:e}=lA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>dx(dO({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(e){var t;if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await (t=(0,v.toMiliseconds)(v.ONE_SECOND),new Promise(e=>setTimeout(e,t))),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}async restartToComplete(e){this.relayer.connected||this.relayer.connecting||(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return lh(e+await this.getClientId())}}var dT=Object.defineProperty,dN=Object.getOwnPropertySymbols,dR=Object.prototype.hasOwnProperty,dj=Object.prototype.propertyIsEnumerable,dk=(e,t,r)=>t in e?dT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dU=(e,t)=>{for(var r in t||(t={}))dR.call(t,r)&&dk(e,r,t[r]);if(dN)for(var r of dN(t))dj.call(t,r)&&dk(e,r,t[r]);return e},dB=(e,t,r)=>dk(e,"symbol"!=typeof t?t+"":t,r);class dL extends ej{constructor(e){super(e),dB(this,"protocol","wc"),dB(this,"version",2),dB(this,"core"),dB(this,"logger"),dB(this,"events",new b.EventEmitter),dB(this,"provider"),dB(this,"messages"),dB(this,"subscriber"),dB(this,"publisher"),dB(this,"name","relayer"),dB(this,"transportExplicitlyClosed",!1),dB(this,"initialized",!1),dB(this,"connectionAttemptInProgress",!1),dB(this,"relayUrl"),dB(this,"projectId"),dB(this,"packageName"),dB(this,"bundleId"),dB(this,"hasExperiencedNetworkDisruption",!1),dB(this,"pingTimeout"),dB(this,"heartBeatTimeout",(0,v.toMiliseconds)(v.THIRTY_SECONDS+v.FIVE_SECONDS)),dB(this,"reconnectTimeout"),dB(this,"connectPromise"),dB(this,"reconnectInProgress",!1),dB(this,"requestsInFlight",[]),dB(this,"connectTimeout",(0,v.toMiliseconds)(15*v.ONE_SECOND)),dB(this,"request",async e=>{var t,r;this.logger.debug("Publishing Request Payload");let i=e.id||l8().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");let s=`${i}:${(null==(r=e.params)?void 0:r.tag)||""}`;this.requestsInFlight.push(s);let n=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==s),n}catch(e){throw this.logger.debug(`Failed to Publish Request: ${i}`),e}}),dB(this,"resetPingTimeout",()=>{n3()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,r,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(i=null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.terminate)||i.call(r)}catch(e){this.logger.warn(e,e?.message)}},this.heartBeatTimeout))}),dB(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),dB(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \uD83D\uDEDC"),this.startPingTimeout(),this.events.emit(hI.connect)}),dB(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \uD83D\uDED1"),this.requestsInFlight=[],this.onProviderDisconnect()}),dB(this,"onProviderErrorHandler",e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit(hI.error,e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),dB(this,"registerProviderListeners",()=>{this.provider.on(hD.payload,this.onPayloadHandler),this.provider.on(hD.connect,this.onConnectHandler),this.provider.on(hD.disconnect,this.onDisconnectHandler),this.provider.on(hD.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger="u">typeof e.logger&&"string"!=typeof e.logger?eI(e.logger,this.name):es()(eE({level:e.logger||"error"})),this.messages=new di(this.logger,e.core),this.subscriber=new dC(this,this.logger),this.publisher=new dg(this,this.logger),this.relayUrl=e?.relayUrl||h_,this.projectId=e.projectId,n5()&&"u">typeof r.g&&"u">typeof(null==r.g?void 0:r.g.Platform)&&(null==r.g?void 0:r.g.Platform.OS)==="android"?this.packageName=n9():n5()&&"u">typeof r.g&&"u">typeof(null==r.g?void 0:r.g.Platform)&&(null==r.g?void 0:r.g.Platform.OS)==="ios"&&(this.bundleId=n9()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return e_(this.logger)}get connected(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===1}get connecting(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===0||void 0!==this.connectPromise}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:hP.relay},hO.outbound)}async subscribe(e,t){var r,i,s;this.isInitialized(),null!=t&&t.transportType&&t?.transportType!=="relay"||await this.toEstablishConnection();let n=typeof(null==(r=t?.internal)?void 0:r.throwOnFailedPublish)>"u"||(null==(i=t?.internal)?void 0:i.throwOnFailedPublish),o=(null==(s=this.subscriber.topicMap.get(e))?void 0:s[0])||"",a,c=t=>{t.topic===e&&(this.subscriber.off(hA.created,c),a())};return await Promise.all([new Promise(e=>{a=e,this.subscriber.on(hA.created,c)}),new Promise(async(r,i)=>{o=await this.subscriber.subscribe(e,dU({internal:{throwOnFailedPublish:n}},t)).catch(e=>{n&&i(e)})||o,r()})]),o}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await on(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,r)=>{await this.connect(e).then(t).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await lV())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let t=e.sort((e,t)=>e.publishedAt-t.publishedAt);for(let e of(this.logger.debug(`Batch of ${t.length} message events sorted`),t))try{await this.onMessageEvent(e)}catch(e){this.logger.warn(e,"Error while processing batch message event: "+e?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:r}=e;if(!t.sessionExists){let e=oc(v.FIVE_MINUTES);await this.core.pairing.pairings.set(r,{topic:r,expiry:e,relay:{protocol:"irn"},active:!1})}this.events.emit(hI.message,e),await this.recordMessageEvent(e,hO.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{let r=()=>{t(Error("Connection interrupted while trying to subscribe"))};this.provider.once(hD.disconnect,r),await on(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(hD.disconnect,r),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,t)=>{let r=()=>{t(Error("Connection interrupted while trying to subscribe"))};this.provider.once(hD.disconnect,r),await this.subscriber.start().then(e).catch(t).finally(()=>{this.provider.off(hD.disconnect,r)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(e){await this.subscriber.stop(),this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,(0,v.toMiliseconds)(1*t))),t++}}startPingTimeout(){var e,t,r,i,s;if(n3())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(s=null==(i=null==(r=this.provider)?void 0:r.connection)?void 0:i.socket)||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(e){this.logger.warn(e,e?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hc(new hd(function({protocol:e,version:t,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){let l=r.split("?"),h=oe(e,t,i),u=function(e,t){let r=new URLSearchParams(e);for(let e of Object.keys(t).sort())if(t.hasOwnProperty(e)){let i=t[e];void 0!==i&&r.set(e,i)}return r.toString()}(l[1]||"",{auth:s,ua:h,projectId:n,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0});return l[0]+"?"+u}({sdkVersion:hS,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:r,message:i}=e;await this.messages.set(r,i,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:r}=e;if(!r||0===r.length)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let i=this.messages.has(t,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),hs(e)){if(!e.method.endsWith("_subscription"))return;let t=e.params,{topic:r,message:i,publishedAt:s,attestation:n}=t.data,o={topic:r,message:i,publishedAt:s,transportType:hP.relay,attestation:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(dU({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else hn(e)&&this.events.emit(hI.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,hO.inbound),this.events.emit(hI.message,e))}async acknowledgePayload(e){let t=l5(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(hD.payload,this.onPayloadHandler),this.provider.off(hD.connect,this.onConnectHandler),this.provider.off(hD.disconnect,this.onDisconnectHandler),this.provider.off(hD.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await lV();!function(e){switch(n4()){case n8.browser:!n5()&&n6()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)));break;case n8.reactNative:n5()&&"u">typeof r.g&&null!=r.g&&r.g.NetInfo&&r.g?.NetInfo.addEventListener(t=>e(t?.isConnected));case n8.node:}}(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(e=>this.logger.error(e,e?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(hI.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,v.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),this.connected||await this.connect()}}function dq(){}function d$(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}function dM(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function dz(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let dF="[object Arguments]",dH="[object Object]";var dV=Object.defineProperty,dK=Object.getOwnPropertySymbols,dW=Object.prototype.hasOwnProperty,dG=Object.prototype.propertyIsEnumerable,dY=(e,t,r)=>t in e?dV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dJ=(e,t)=>{for(var r in t||(t={}))dW.call(t,r)&&dY(e,r,t[r]);if(dK)for(var r of dK(t))dG.call(t,r)&&dY(e,r,t[r]);return e},dZ=(e,t,r)=>dY(e,"symbol"!=typeof t?t+"":t,r);class dQ extends ek{constructor(e,t,r,i=hy,s){super(e,t,r,i),this.core=e,this.logger=t,this.name=r,dZ(this,"map",new Map),dZ(this,"version","0.3"),dZ(this,"cached",[]),dZ(this,"initialized",!1),dZ(this,"getKey"),dZ(this,"storagePrefix",hy),dZ(this,"recentlyDeleted",[]),dZ(this,"recentlyDeletedLimit",200),dZ(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{var t;this.getKey&&null!==e&&!lR(e)?this.map.set(this.getKey(e),e):(null==(t=e?.proposer)?void 0:t.publicKey)?this.map.set(e.id,e):e?.topic&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),dZ(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),dZ(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),dZ(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(r=>(function e(t,r,i,s,n,o,a){let c=a(t,r,i,s,n,o);if(void 0!==c)return c;if(typeof t==typeof r)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return t===r;case"number":return t===r||Object.is(t,r)}return function t(r,i,s,n){if(Object.is(r,i))return!0;let o=dz(r),a=dz(i);if(o===dF&&(o=dH),a===dF&&(a=dH),o!==a)return!1;switch(o){case"[object String]":return r.toString()===i.toString();case"[object Number]":{let e=r.valueOf(),t=i.valueOf();return e===t||Number.isNaN(e)&&Number.isNaN(t)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(r.valueOf(),i.valueOf());case"[object RegExp]":return r.source===i.source&&r.flags===i.flags;case"[object Function]":return r===i}s=s??new Map;let c=s.get(r),l=s.get(i);if(null!=c&&null!=l)return c===i;s.set(r,i),s.set(i,r);try{switch(o){case"[object Map]":if(r.size!==i.size)return!1;for(let[t,o]of r.entries())if(!i.has(t)||!e(o,i.get(t),t,r,i,s,n))return!1;return!0;case"[object Set]":{if(r.size!==i.size)return!1;let t=Array.from(r.values()),o=Array.from(i.values());for(let a=0;a<t.length;a++){let c=t[a],l=o.findIndex(t=>e(c,t,void 0,r,i,s,n));if(-1===l)return!1;o.splice(l,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof hp&&hp.isBuffer(r)!==hp.isBuffer(i)||r.length!==i.length)return!1;for(let t=0;t<r.length;t++)if(!e(r[t],i[t],t,r,i,s,n))return!1;return!0;case"[object ArrayBuffer]":return r.byteLength===i.byteLength&&t(new Uint8Array(r),new Uint8Array(i),s,n);case"[object DataView]":return r.byteLength===i.byteLength&&r.byteOffset===i.byteOffset&&t(new Uint8Array(r),new Uint8Array(i),s,n);case"[object Error]":return r.name===i.name&&r.message===i.message;case dH:{if(!(t(r.constructor,i.constructor,s,n)||d$(r)&&d$(i)))return!1;let o=[...Object.keys(r),...dM(r)],a=[...Object.keys(i),...dM(i)];if(o.length!==a.length)return!1;for(let t=0;t<o.length;t++){let a=o[t],c=r[a];if(!Object.hasOwn(i,a))return!1;let l=i[a];if(!e(c,l,a,r,i,s,n))return!1}return!0}default:return!1}}finally{s.delete(r),s.delete(i)}}(t,r,o,a)})(t[r],e[r],void 0,void 0,void 0,void 0,dq))):this.values)),dZ(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});let r=dJ(dJ({},this.getData(e)),t);this.map.set(e,r),await this.persist()}),dZ(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=eI(t,this.name),this.storagePrefix=i,this.getKey=s}get context(){return e_(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:t}=lA("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),Error(t)}let{message:t}=lA("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:e}=lA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}}var dX=Object.defineProperty,d0=(e,t,r)=>t in e?dX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d1=(e,t,r)=>d0(e,"symbol"!=typeof t?t+"":t,r);class d2{constructor(e,t){this.core=e,this.logger=t,d1(this,"name","pairing"),d1(this,"version","0.3"),d1(this,"events",new(w())),d1(this,"pairings"),d1(this,"initialized",!1),d1(this,"storagePrefix",hy),d1(this,"ignoredPayloadTypes",[1]),d1(this,"registeredMethods",[]),d1(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),d1(this,"register",({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),d1(this,"create",async e=>{this.isInitialized();let t=lc(),r=await this.core.crypto.setSymKey(t),i=oc(v.FIVE_MINUTES),s={protocol:"irn"},n={topic:r,expiry:i,relay:s,active:!1,methods:e?.methods},o=lE({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:t,relay:s,expiryTimestamp:i,methods:e?.methods});return this.events.emit(hT.create,n),this.core.expirer.set(r,i),await this.pairings.set(r,n),await this.core.relayer.subscribe(r,{transportType:e?.transportType}),{topic:r,uri:o}}),d1(this,"pair",async e=>{let t;this.isInitialized();let r=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:[hB.pairing_started]}});this.isValidPair(e,r);let{topic:i,symKey:s,relay:n,expiryTimestamp:o,methods:a}=lv(e.uri);if(r.props.properties.topic=i,r.addTrace(hB.pairing_uri_validation_success),r.addTrace(hB.pairing_uri_not_expired),this.pairings.keys.includes(i)){if(t=this.pairings.get(i),r.addTrace(hB.existing_pairing),t.active)throw r.setError(hL.active_pairing_already_exists),Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);r.addTrace(hB.pairing_not_expired)}let c=o||oc(v.FIVE_MINUTES),l={topic:i,relay:n,expiry:c,active:!1,methods:a};this.core.expirer.set(i,c),await this.pairings.set(i,l),r.addTrace(hB.store_new_pairing),e.activatePairing&&await this.activate({topic:i}),this.events.emit(hT.create,l),r.addTrace(hB.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(s,i),r.addTrace(hB.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError(hL.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:n})}catch(e){throw r.setError(hL.subscribe_pairing_topic_failure),e}return r.addTrace(hB.subscribe_pairing_topic_success),l}),d1(this,"activate",async({topic:e})=>{this.isInitialized();let t=oc(v.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),d1(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:t}=e;if(this.pairings.keys.includes(t)){let e=await this.sendRequest(t,"wc_pairingPing",{}),{done:r,resolve:i,reject:s}=os();this.events.once(oh("pairing_ping",e),({error:e})=>{e?s(e):i()}),await r()}}),d1(this,"updateExpiry",async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),d1(this,"updateMetadata",async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),d1(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),d1(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);let{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",lC("USER_DISCONNECTED")),await this.deletePairing(t))}),d1(this,"formatUriFromPairing",e=>{this.isInitialized();let{topic:t,relay:r,expiry:i,methods:s}=e,n=this.core.crypto.keychain.get(t);return lE({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:n,relay:r,expiryTimestamp:i,methods:s})}),d1(this,"sendRequest",async(e,t,r)=>{let i=l3(t,r),s=await this.core.crypto.encode(e,i),n=hC[t].req;return this.core.history.set(e,i),this.core.relayer.publish(e,s,n),i.id}),d1(this,"sendResult",async(e,t,r)=>{let i=l5(e,r),s=await this.core.crypto.encode(t,i),n=(await this.core.history.get(t,e)).request.method,o=hC[n].res;await this.core.relayer.publish(t,s,o),await this.core.history.resolve(i)}),d1(this,"sendError",async(e,t,r)=>{let i=l6(e,r),s=await this.core.crypto.encode(t,i),n=(await this.core.history.get(t,e)).request.method,o=hC[n]?hC[n].res:hC.unregistered_method.res;await this.core.relayer.publish(t,s,o),await this.core.history.resolve(i)}),d1(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,lC("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),d1(this,"cleanup",async()=>{let e=this.pairings.getAll().filter(e=>ol(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),d1(this,"onRelayEventRequest",async e=>{let{topic:t,payload:r}=e;switch(r.method){case"wc_pairingPing":return await this.onPairingPingRequest(t,r);case"wc_pairingDelete":return await this.onPairingDeleteRequest(t,r);default:return await this.onUnknownRpcMethodRequest(t,r)}}),d1(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r}=e,i=(await this.core.history.get(t,r.id)).request.method;return"wc_pairingPing"===i?this.onPairingPingResponse(t,r):this.onUnknownRpcMethodResponse(i)}),d1(this,"onPairingPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult(r,e,!0),this.events.emit(hT.ping,{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),d1(this,"onPairingPingResponse",(e,t)=>{let{id:r}=t;setTimeout(()=>{ho(t)?this.events.emit(oh("pairing_ping",r),{}):ha(t)&&this.events.emit(oh("pairing_ping",r),{error:t.error})},500)}),d1(this,"onPairingDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(hT.delete,{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),d1(this,"onUnknownRpcMethodRequest",async(e,t)=>{let{id:r,method:i}=t;try{if(this.registeredMethods.includes(i))return;let t=lC("WC_METHOD_UNSUPPORTED",i);await this.sendError(r,e,t),this.logger.error(t)}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),d1(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(lC("WC_METHOD_UNSUPPORTED",e))}),d1(this,"isValidPair",(e,t)=>{var r;if(!lM(e)){let{message:r}=lA("MISSING_OR_INVALID",`pair() params: ${e}`);throw t.setError(hL.malformed_pairing_uri),Error(r)}if(!function(e){function t(e){try{return"u">typeof new URL(e)}catch{return!1}}try{if(lj(e,!1)){if(t(e))return!0;let r=om(e);return t(r)}}catch{}return!1}(e.uri)){let{message:r}=lA("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw t.setError(hL.malformed_pairing_uri),Error(r)}let i=lv(e?.uri);if(!(null!=(r=i?.relay)&&r.protocol)){let{message:e}=lA("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(hL.malformed_pairing_uri),Error(e)}if(!(null!=i&&i.symKey)){let{message:e}=lA("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(hL.malformed_pairing_uri),Error(e)}if(null!=i&&i.expiryTimestamp&&(0,v.toMiliseconds)(i?.expiryTimestamp)<Date.now()){t.setError(hL.pairing_expired);let{message:e}=lA("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(e)}}),d1(this,"isValidPing",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),d1(this,"isValidDisconnect",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),d1(this,"isValidPairingTopic",async e=>{if(!lj(e,!1)){let{message:t}=lA("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.pairings.keys.includes(e)){let{message:t}=lA("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(ol(this.pairings.get(e).expiry)){await this.deletePairing(e);let{message:t}=lA("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}),this.core=e,this.logger=eI(t,this.name),this.pairings=new dQ(this.core,this.logger,this.name,this.storagePrefix)}get context(){return e_(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}registerRelayerEvents(){this.core.relayer.on(hI.message,async e=>{let{topic:t,message:r,transportType:i}=e;if(this.pairings.keys.includes(t)&&i!==hP.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let e=await this.core.crypto.decode(t,r);hs(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):hn(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,r)}catch(e){this.logger.error(e)}})}registerExpirerEvents(){this.core.expirer.on(hR.expired,async e=>{let{topic:t}=oa(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(hT.expire,{topic:t}))})}}var d8=Object.defineProperty,d3=(e,t,r)=>t in e?d8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d5=(e,t,r)=>d3(e,"symbol"!=typeof t?t+"":t,r);class d6 extends eT{constructor(e,t){super(e,t),this.core=e,this.logger=t,d5(this,"records",new Map),d5(this,"events",new b.EventEmitter),d5(this,"name","history"),d5(this,"version","0.3"),d5(this,"cached",[]),d5(this,"initialized",!1),d5(this,"storagePrefix",hy),d5(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),d5(this,"set",(e,t,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),this.records.has(t.id))return;let i={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r,expiry:oc(v.THIRTY_DAYS)};this.records.set(i.id,i),this.persist(),this.events.emit(hN.created,i)}),d5(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;let t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=ha(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(hN.updated,t))}),d5(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),d5(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(r=>{r.topic!==e||"u">typeof t&&r.id!==t||(this.records.delete(r.id),this.events.emit(hN.deleted,r))}),this.persist()}),d5(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),d5(this,"on",(e,t)=>{this.events.on(e,t)}),d5(this,"once",(e,t)=>{this.events.once(e,t)}),d5(this,"off",(e,t)=>{this.events.off(e,t)}),d5(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=eI(t,this.name)}get context(){return e_(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if("u">typeof t.response)return;let r={topic:t.topic,request:l3(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:t}=lA("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(hN.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:e}=lA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(hN.created,e=>{let t=hN.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(hN.updated,e=>{let t=hN.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(hN.deleted,e=>{let t=hN.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(D.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,v.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(hN.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}}var d4=Object.defineProperty,d9=(e,t,r)=>t in e?d4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d7=(e,t,r)=>d9(e,"symbol"!=typeof t?t+"":t,r);class pe extends eB{constructor(e,t){super(e,t),this.core=e,this.logger=t,d7(this,"expirations",new Map),d7(this,"events",new b.EventEmitter),d7(this,"name","expirer"),d7(this,"version","0.3"),d7(this,"cached",[]),d7(this,"initialized",!1),d7(this,"storagePrefix",hy),d7(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),d7(this,"has",e=>{try{let t=this.formatTarget(e);return"u">typeof this.getExpiration(t)}catch{return!1}}),d7(this,"set",(e,t)=>{this.isInitialized();let r=this.formatTarget(e),i={target:r,expiry:t};this.expirations.set(r,i),this.checkExpiry(r,i),this.events.emit(hR.created,{target:r,expiration:i})}),d7(this,"get",e=>{this.isInitialized();let t=this.formatTarget(e);return this.getExpiration(t)}),d7(this,"del",e=>{if(this.isInitialized(),this.has(e)){let t=this.formatTarget(e),r=this.getExpiration(t);this.expirations.delete(t),this.events.emit(hR.deleted,{target:t,expiration:r})}}),d7(this,"on",(e,t)=>{this.events.on(e,t)}),d7(this,"once",(e,t)=>{this.events.once(e,t)}),d7(this,"off",(e,t)=>{this.events.off(e,t)}),d7(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=eI(t,this.name)}get context(){return e_(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return oo("topic",e);if("number"==typeof e)return oo("id",e);let{message:t}=lA("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(hR.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:e}=lA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:t}=lA("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),Error(t)}return t}checkExpiry(e,t){let{expiry:r}=t;(0,v.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(hR.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(D.pulse,()=>this.checkExpirations()),this.events.on(hR.created,e=>{let t=hR.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(hR.expired,e=>{let t=hR.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(hR.deleted,e=>{let t=hR.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}}var pt=Object.defineProperty,pr=(e,t,r)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pi=(e,t,r)=>pr(e,"symbol"!=typeof t?t+"":t,r);class ps extends eL{constructor(e,t,r){super(e,t,r),this.core=e,this.logger=t,this.store=r,pi(this,"name","verify-api"),pi(this,"abortController"),pi(this,"isDevEnv"),pi(this,"verifyUrlV3",hk),pi(this,"storagePrefix",hy),pi(this,"version",2),pi(this,"publicKey"),pi(this,"fetchPromise"),pi(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,v.toMiliseconds)(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),pi(this,"register",async e=>{if(!n6()||this.isDevEnv)return;let t=window.location.origin,{id:r,decryptedId:i}=e,s=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${r}&decryptedId=${i}`;try{let e=(0,iA.getDocument)(),t=this.startAbortTimer(5*v.ONE_SECOND),i=await new Promise((i,n)=>{let o=()=>{window.removeEventListener("message",c),e.body.removeChild(a),n("attestation aborted")};this.abortController.signal.addEventListener("abort",o);let a=e.createElement("iframe");a.src=s,a.style.display="none",a.addEventListener("error",o,{signal:this.abortController.signal});let c=s=>{if(s.data&&"string"==typeof s.data)try{let n=JSON.parse(s.data);if("verify_attestation"===n.type){if(ig(n.attestation).payload.id!==r)return;clearInterval(t),e.body.removeChild(a),this.abortController.signal.removeEventListener("abort",o),window.removeEventListener("message",c),i(null===n.attestation?"":n.attestation)}}catch(e){this.logger.warn(e)}};e.body.appendChild(a),window.addEventListener("message",c,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",i),i}catch(e){this.logger.warn(e)}return""}),pi(this,"resolve",async e=>{if(this.isDevEnv)return"";let{attestationId:t,hash:r,encryptedId:i}=e;if(""===t){this.logger.debug("resolve: attestationId is empty, skipping");return}if(t){if(ig(t).payload.id!==i)return;let e=await this.isValidJwtAttestation(t);if(e){if(!e.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return e}}if(!r)return;let s=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(r,s)}),pi(this,"fetchAttestation",async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);let r=this.startAbortTimer(5*v.ONE_SECOND),i=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(r),200===i.status?await i.json():void 0}),pi(this,"getVerifyUrl",e=>{let t=e||hj;return hU.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: ${hj}`),t=hj),t}),pi(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let e=this.startAbortTimer(v.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),pi(this,"persistPublicKey",async e=>{this.logger.debug("persisting public key to local storage",e),await this.store.setItem(this.storeKey,e),this.publicKey=e}),pi(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),pi(this,"isValidJwtAttestation",async e=>{let t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}let r=await this.fetchAndPersistPublicKey();try{if(r)return this.validateAttestation(e,r)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}}),pi(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),pi(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{let t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});let e=await this.fetchPromise;return this.fetchPromise=void 0,e}),pi(this,"validateAttestation",(e,t)=>{let r=function(e,t){let[r,i,s]=e.split("."),n=nV.from(lp(s),"base64");if(64!==n.length)throw Error("Invalid signature length");let o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,l=a1(c),h=function(e){let t=nV.from(e.x,"base64"),r=nV.from(e.y,"base64");return sw([new Uint8Array([4]),t,r])}(t);if(!lr.verify(sw([o,a]),l,h))throw Error("Invalid signature");return ig(e).payload}(e,t.publicKey),i={hasExpired:(0,v.toMiliseconds)(r.exp)<Date.now(),payload:r};if(i.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:i.payload.origin,isScam:i.payload.isScam,isVerified:i.payload.isVerified}}),this.logger=eI(t,this.name),this.abortController=new AbortController,this.isDevEnv=oy(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return e_(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,v.toMiliseconds)(e))}}var pn=Object.defineProperty,po=(e,t,r)=>t in e?pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pa=(e,t,r)=>po(e,"symbol"!=typeof t?t+"":t,r);class pc extends eq{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,pa(this,"context","echo"),pa(this,"registerDeviceToken",async e=>{let{clientId:t,token:r,notificationType:i,enableEncrypted:s=!1}=e,n=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:i,token:r,always_raw:s})})}),this.logger=eI(t,this.context)}}var pl=Object.defineProperty,ph=Object.getOwnPropertySymbols,pu=Object.prototype.hasOwnProperty,pd=Object.prototype.propertyIsEnumerable,pp=(e,t,r)=>t in e?pl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pf=(e,t)=>{for(var r in t||(t={}))pu.call(t,r)&&pp(e,r,t[r]);if(ph)for(var r of ph(t))pd.call(t,r)&&pp(e,r,t[r]);return e},pg=(e,t,r)=>pp(e,"symbol"!=typeof t?t+"":t,r);class py extends e${constructor(e,t,r=!0){super(e,t,r),this.core=e,this.logger=t,pg(this,"context","event-client"),pg(this,"storagePrefix",hy),pg(this,"storageVersion",.1),pg(this,"events",new Map),pg(this,"shouldPersist",!1),pg(this,"init",async()=>{if(!oy())try{let e={eventId:og(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:oe(this.core.relayer.protocol,this.core.relayer.version,hS)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),pg(this,"createEvent",e=>{let{event:t="ERROR",type:r="",properties:{topic:i,trace:s}}=e,n=og(),o=this.core.projectId||"",a=Date.now(),c=pf({eventId:n,timestamp:a,props:{event:t,type:r,properties:{topic:i,trace:s}},bundleId:o,domain:this.getAppDomain()},this.setMethods(n));return this.telemetryEnabled&&(this.events.set(n,c),this.shouldPersist=!0),c}),pg(this,"getEvent",e=>{let{eventId:t,topic:r}=e;if(t)return this.events.get(t);let i=Array.from(this.events.values()).find(e=>e.props.properties.topic===r);if(i)return pf(pf({},i),this.setMethods(i.eventId))}),pg(this,"deleteEvent",e=>{let{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),pg(this,"setEventListeners",()=>{this.core.heartbeat.on(D.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{(0,v.fromMiliseconds)(Date.now())-(0,v.fromMiliseconds)(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),pg(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),pg(this,"addTrace",(e,t)=>{let r=this.events.get(e);r&&(r.props.properties.trace.push(t),this.events.set(e,r),this.shouldPersist=!0)}),pg(this,"setError",(e,t)=>{let r=this.events.get(e);r&&(r.props.type=t,r.timestamp=Date.now(),this.events.set(e,r),this.shouldPersist=!0)}),pg(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),pg(this,"restore",async()=>{try{let e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,pf(pf({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),pg(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let e=[];for(let[t,r]of this.events)r.props.type&&e.push(r);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(let t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(e){this.logger.warn(e)}}),pg(this,"sendEvent",async e=>{let t=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${hS}${t}`,{method:"POST",body:JSON.stringify(e)})}),pg(this,"getAppDomain",()=>n7().url),this.logger=eI(t,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var pm=Object.defineProperty,pb=Object.getOwnPropertySymbols,pw=Object.prototype.hasOwnProperty,pv=Object.prototype.propertyIsEnumerable,pE=(e,t,r)=>t in e?pm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,p_=(e,t)=>{for(var r in t||(t={}))pw.call(t,r)&&pE(e,r,t[r]);if(pb)for(var r of pb(t))pv.call(t,r)&&pE(e,r,t[r]);return e},pI=(e,t,r)=>pE(e,"symbol"!=typeof t?t+"":t,r);class pD extends eO{constructor(e){var t,r;super(e),pI(this,"protocol","wc"),pI(this,"version",2),pI(this,"name",hg),pI(this,"relayUrl"),pI(this,"projectId"),pI(this,"customStoragePrefix"),pI(this,"events",new b.EventEmitter),pI(this,"logger"),pI(this,"heartbeat"),pI(this,"relayer"),pI(this,"crypto"),pI(this,"storage"),pI(this,"history"),pI(this,"expirer"),pI(this,"pairing"),pI(this,"verify"),pI(this,"echoClient"),pI(this,"linkModeSupportedApps"),pI(this,"eventClient"),pI(this,"initialized",!1),pI(this,"logChunkController"),pI(this,"on",(e,t)=>this.events.on(e,t)),pI(this,"once",(e,t)=>this.events.once(e,t)),pI(this,"off",(e,t)=>this.events.off(e,t)),pI(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),pI(this,"dispatchEnvelope",({topic:e,message:t,sessionExists:r})=>{if(!e||!t)return;let i={topic:e,message:t,publishedAt:Date.now(),transportType:hP.link_mode};this.relayer.onLinkMessageEvent(i,{sessionExists:r})});let i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(e){console.warn("Failed to copy global core",e)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||h_,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let s=eE({level:"string"==typeof e?.logger&&e.logger?e.logger:hm.logger,name:hg}),{logger:n,chunkLoggerController:o}="u">typeof(r={opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger}).loggerOverride&&"string"!=typeof r.loggerOverride?{logger:r.loggerOverride,chunkLoggerController:null}:"u">typeof window?function(e){var t,r;let i=new eh(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes);return{logger:es()(ev(ew({},e.opts),{level:"trace",browser:ev(ew({},null==(r=e.opts)?void 0:r.browser),{write:e=>i.write(e)})})),chunkLoggerController:i}}(r):function(e){var t;let r=new eu(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes);return{logger:es()(ev(ew({},e.opts),{level:"trace"}),r),chunkLoggerController:r}}(r);this.logChunkController=o,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=eI(n,this.name),this.heartbeat=new S,this.crypto=new u2(this,this.logger,e?.keychain),this.history=new d6(this,this.logger),this.expirer=new pe(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new er(p_(p_({},hb),e?.storageOptions)),this.relayer=new dL({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new d2(this,this.logger),this.verify=new ps(this,this.logger,this.storage),this.echoClient=new pc(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new py(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let t=new pD(e);await t.initialize();let r=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",r),t}get context(){return e_(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(hx,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(hx)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(e){console.warn("Failed to get global WalletConnect core",e);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(e){console.warn("Failed to set global WalletConnect core",e)}}isGlobalCoreDisabled(){try{return"u">typeof hf&&"true"===hf.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let pS="client",pP=`wc@2:${pS}:`,pO={name:pS,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},px="WALLETCONNECT_DEEPLINK_CHOICE",pA="Proposal expired",pC=v.SEVEN_DAYS,pT={wc_sessionPropose:{req:{ttl:v.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:v.ONE_DAY,prompt:!1,tag:1104},res:{ttl:v.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:v.ONE_DAY,prompt:!1,tag:1106},res:{ttl:v.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:v.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:v.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:v.ONE_DAY,prompt:!1,tag:1112},res:{ttl:v.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:v.ONE_DAY,prompt:!1,tag:1114},res:{ttl:v.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:v.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:v.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:v.FIVE_MINUTES,prompt:!1,tag:1119}}},pN={min:v.FIVE_MINUTES,max:v.SEVEN_DAYS},pR={idle:"IDLE",active:"ACTIVE"},pj={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},pk=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],pU="wc@1.5:auth:",pB=`${pU}:PUB_KEY`;var pL=Object.defineProperty,pq=Object.defineProperties,p$=Object.getOwnPropertyDescriptors,pM=Object.getOwnPropertySymbols,pz=Object.prototype.hasOwnProperty,pF=Object.prototype.propertyIsEnumerable,pH=(e,t,r)=>t in e?pL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pV=(e,t)=>{for(var r in t||(t={}))pz.call(t,r)&&pH(e,r,t[r]);if(pM)for(var r of pM(t))pF.call(t,r)&&pH(e,r,t[r]);return e},pK=(e,t)=>pq(e,p$(t)),pW=(e,t,r)=>pH(e,"symbol"!=typeof t?t+"":t,r);class pG extends eV{constructor(e){super(e),pW(this,"name","engine"),pW(this,"events",new(w())),pW(this,"initialized",!1),pW(this,"requestQueue",{state:pR.idle,queue:[]}),pW(this,"sessionRequestQueue",{state:pR.idle,queue:[]}),pW(this,"requestQueueDelay",v.ONE_SECOND),pW(this,"expectedPairingMethodMap",new Map),pW(this,"recentlyDeletedMap",new Map),pW(this,"recentlyDeletedLimit",200),pW(this,"relayMessageCache",[]),pW(this,"pendingSessions",new Map),pW(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(pT)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,v.toMiliseconds)(this.requestQueueDelay)))}),pW(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=pK(pV({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t);let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:n,scopedProperties:o,relays:a}=t,c=r,l,h=!1;try{if(c){let e=this.client.core.pairing.pairings.get(c);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=e.active}}catch(e){throw this.client.logger.error(`connect() -> pairing.get(${c}) failed`),e}if(!c||!h){let{topic:e,uri:t}=await this.client.core.pairing.create();c=e,l=t}if(!c){let{message:e}=lA("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw Error(e)}let u=await this.client.core.crypto.generateKeyPair(),d=pT.wc_sessionPropose.req.ttl||v.FIVE_MINUTES,p=oc(d),f=pK(pV(pV({requiredNamespaces:i,optionalNamespaces:s,relays:a??[{protocol:"irn"}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:c},n&&{sessionProperties:n}),o&&{scopedProperties:o}),{id:l2()}),g=oh("session_connect",f.id),{reject:y,resolve:m,done:b}=os(d,pA),w=({id:e})=>{e===f.id&&(this.client.events.off("proposal_expire",w),this.pendingSessions.delete(f.id),this.events.emit(g,{error:{message:pA,code:0}}))};return this.client.events.on("proposal_expire",w),this.events.once(g,({error:e,session:t})=>{this.client.events.off("proposal_expire",w),e?y(e):t&&m(t)}),await this.sendRequest({topic:c,method:"wc_sessionPropose",params:f,throwOnFailedPublish:!0,clientRpcId:f.id}),await this.setProposal(f.id,f),{uri:l,approval:b}}),pW(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(e){throw this.client.logger.error("pair() failed"),e}}),pW(this,"approve",async e=>{var t,r,i;let s=this.client.core.eventClient.createEvent({properties:{topic:null==(t=e?.id)?void 0:t.toString(),trace:[hq.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(e){throw s.setError(h$.no_internet_connection),e}try{await this.isValidProposalId(e?.id)}catch(t){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),s.setError(h$.proposal_not_found),t}try{await this.isValidApprove(e)}catch(e){throw this.client.logger.error("approve() -> isValidApprove() failed"),s.setError(h$.session_approve_namespace_validation_failure),e}let{id:n,relayProtocol:o,namespaces:a,sessionProperties:c,scopedProperties:l,sessionConfig:h}=e,u=this.client.proposal.get(n);this.client.core.eventClient.deleteEvent({eventId:s.eventId});let{pairingTopic:d,proposer:p,requiredNamespaces:f,optionalNamespaces:g}=u,y=null==(r=this.client.core.eventClient)?void 0:r.getEvent({topic:d});y||(y=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:hq.session_approve_started,properties:{topic:d,trace:[hq.session_approve_started,hq.session_namespaces_validation_success]}}));let m=await this.client.core.crypto.generateKeyPair(),b=p.publicKey,w=await this.client.core.crypto.generateSharedKey(m,b),v=pV(pV(pV({relay:{protocol:o??"irn"},namespaces:a,controller:{publicKey:m,metadata:this.client.metadata},expiry:oc(pC)},c&&{sessionProperties:c}),l&&{scopedProperties:l}),h&&{sessionConfig:h}),E=hP.relay;y.addTrace(hq.subscribing_session_topic);try{await this.client.core.relayer.subscribe(w,{transportType:E})}catch(e){throw y.setError(h$.subscribe_session_topic_failure),e}y.addTrace(hq.subscribe_session_topic_success);let _=pK(pV({},v),{topic:w,requiredNamespaces:f,optionalNamespaces:g,pairingTopic:d,acknowledged:!1,self:v.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:hP.relay});await this.client.session.set(w,_),y.addTrace(hq.store_session);try{y.addTrace(hq.publishing_session_settle),await this.sendRequest({topic:w,method:"wc_sessionSettle",params:v,throwOnFailedPublish:!0}).catch(e=>{throw y?.setError(h$.session_settle_publish_failure),e}),y.addTrace(hq.session_settle_publish_success),y.addTrace(hq.publishing_session_approve),await this.sendResult({id:n,topic:d,result:{relay:{protocol:o??"irn"},responderPublicKey:m},throwOnFailedPublish:!0}).catch(e=>{throw y?.setError(h$.session_approve_publish_failure),e}),y.addTrace(hq.session_approve_publish_success)}catch(e){throw this.client.logger.error(e),this.client.session.delete(w,lC("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(w),e}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:p.metadata}),await this.client.proposal.delete(n,lC("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(w,oc(pC)),{topic:w,acknowledged:()=>Promise.resolve(this.client.session.get(w))}}),pW(this,"reject",async e=>{let t;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(e){throw this.client.logger.error("reject() -> isValidReject() failed"),e}let{id:r,reason:i}=e;try{t=this.client.proposal.get(r).pairingTopic}catch(e){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),e}t&&(await this.sendError({id:r,topic:t,error:i,rpcOpts:pT.wc_sessionPropose.reject}),await this.client.proposal.delete(r,lC("USER_DISCONNECTED")))}),pW(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(e){throw this.client.logger.error("update() -> isValidUpdate() failed"),e}let{topic:t,namespaces:r}=e,{done:i,resolve:s,reject:n}=os(),o=l2(),a=l8().toString(),c=this.client.session.get(t).namespaces;return this.events.once(oh("session_update",o),({error:e})=>{e?n(e):s()}),await this.client.session.update(t,{namespaces:r}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:a}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),n(e)}),{acknowledged:i}}),pW(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(e){throw this.client.logger.error("extend() -> isValidExtend() failed"),e}let{topic:t}=e,r=l2(),{done:i,resolve:s,reject:n}=os();return this.events.once(oh("session_extend",r),({error:e})=>{e?n(e):s()}),await this.setExpiry(t,oc(pC)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(e=>{n(e)}),{acknowledged:i}}),pW(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(e){throw this.client.logger.error("request() -> isValidRequest() failed"),e}let{chainId:t,request:r,topic:i,expiry:s=pT.wc_sessionRequest.req.ttl}=e,n=this.client.session.get(i);n?.transportType===hP.relay&&await this.confirmOnlineStateOrThrow();let o=l2(),a=l8().toString(),{done:c,resolve:l,reject:h}=os(s,"Request expired. Please try again.");this.events.once(oh("session_request",o),({error:e,result:t})=>{e?h(e):l(t)});let u="wc_sessionRequest",d=this.getAppLinkIfEnabled(n.peer.metadata,n.transportType);if(d)return await this.sendRequest({clientRpcId:o,relayRpcId:a,topic:i,method:u,params:{request:pK(pV({},r),{expiryTimestamp:oc(s)}),chainId:t},expiry:s,throwOnFailedPublish:!0,appLink:d}).catch(e=>h(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:o}),await c();let p={request:pK(pV({},r),{expiryTimestamp:oc(s)}),chainId:t},f=this.shouldSetTVF(u,p);return await Promise.all([new Promise(async e=>{await this.sendRequest(pV({clientRpcId:o,relayRpcId:a,topic:i,method:u,params:p,expiry:s,throwOnFailedPublish:!0},f&&{tvf:this.getTVFParams(o,p)})).catch(e=>h(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:o}),e()}),new Promise(async e=>{var t;if(!(null!=(t=n.sessionConfig)&&t.disableDeepLink)){let e=await op(this.client.core.storage,px);await od({id:o,topic:i,wcDeepLink:e})}e()}),c()]).then(e=>e[2])}),pW(this,"respond",async e=>{this.isInitialized(),await this.isValidRespond(e);let{topic:t,response:r}=e,{id:i}=r,s=this.client.session.get(t);s.transportType===hP.relay&&await this.confirmOnlineStateOrThrow();let n=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);ho(r)?await this.sendResult({id:i,topic:t,result:r.result,throwOnFailedPublish:!0,appLink:n}):ha(r)&&await this.sendError({id:i,topic:t,error:r.error,appLink:n}),this.cleanupAfterResponse(e)}),pW(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(e){throw this.client.logger.error("ping() -> isValidPing() failed"),e}let{topic:t}=e;if(this.client.session.keys.includes(t)){let e=l2(),r=l8().toString(),{done:i,resolve:s,reject:n}=os();this.events.once(oh("session_ping",e),({error:e})=>{e?n(e):s()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:r}),i()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),pW(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);let{topic:t,event:r,chainId:i}=e,s=l8().toString(),n=l2();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:r,chainId:i},throwOnFailedPublish:!0,relayRpcId:s,clientRpcId:n})}),pW(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);let{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:lC("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:e}=lA("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw Error(e)}}),pW(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>(function(e,t){let{requiredNamespaces:r}=t,i=Object.keys(e.namespaces),s=Object.keys(r),n=!0;return!!ot(s,i)&&(i.forEach(t=>{let{accounts:i,methods:s,events:o}=e.namespaces[t],a=lI(i),c=r[t];ot(nW(t,c),a)&&ot(c.methods,s)&&ot(c.events,o)||(n=!1)}),n)})(t,e)))),pW(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),pW(this,"authenticate",async(e,t)=>{var r;let i;this.isInitialized(),this.isValidAuthenticate(e);let s=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(r=this.client.metadata.redirect)?void 0:r.linkMode),n=s?hP.link_mode:hP.relay;n===hP.relay&&await this.confirmOnlineStateOrThrow();let{chains:o,statement:a="",uri:c,domain:l,nonce:h,type:u,exp:d,nbf:p,methods:f=[],expiry:g}=e,y=[...e.resources||[]],{topic:m,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:n});this.client.logger.info({message:"Generated new pairing",pairing:{topic:m,uri:b}});let w=await this.client.core.crypto.generateKeyPair(),v=ll(w);if(await Promise.all([this.client.auth.authKeys.set(pB,{responseTopic:v,publicKey:w}),this.client.auth.pairingTopics.set(v,{topic:v,pairingTopic:m})]),await this.client.core.relayer.subscribe(v,{transportType:n}),this.client.logger.info(`sending request to new pairing topic: ${m}`),f.length>0){let{namespace:e}=nK(o[0]),t=function(e,t,r){let i=function(e,t,r,i={}){return r?.sort((e,t)=>e.localeCompare(t)),{att:{[e]:function(e,t,r={}){t=t?.sort((e,t)=>e.localeCompare(t));let i=t.map(t=>({[`${e}/${t}`]:[r]}));return Object.assign({},...i)}(t,r,i)}}}(e,t,r);return al(i)}(e,"request",f);ap(y)&&(t=function(e,t){let r=ah(e),i=ah(t),s=function(e,t){ac(e),ac(t);let r=Object.keys(e.att).concat(Object.keys(t.att)).sort((e,t)=>e.localeCompare(t)),i={att:{}};return r.forEach(r=>{var s,n;Object.keys((null==(s=e.att)?void 0:s[r])||{}).concat(Object.keys((null==(n=t.att)?void 0:n[r])||{})).sort((e,t)=>e.localeCompare(t)).forEach(s=>{var n,o;i.att[r]=at(ae({},i.att[r]),{[s]:(null==(n=e.att[r])?void 0:n[s])||(null==(o=t.att[r])?void 0:o[s])})})}),i}(r,i);return al(s)}(t,y.pop())),y.push(t)}let E=g&&g>pT.wc_sessionAuthenticate.req.ttl?g:pT.wc_sessionAuthenticate.req.ttl,_={authPayload:{type:u??"caip122",chains:o,statement:a,aud:c,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:p,resources:y},requester:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:oc(E)},I={eip155:{chains:o,methods:[...new Set(["personal_sign",...f])],events:["chainChanged","accountsChanged"]}},D={requiredNamespaces:{},optionalNamespaces:I,relays:[{protocol:"irn"}],pairingTopic:m,proposer:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:oc(pT.wc_sessionPropose.req.ttl),id:l2()},{done:S,resolve:P,reject:O}=os(E,"Request expired"),x=l2(),A=oh("session_connect",D.id),C=oh("session_request",x),T=async({error:e,session:t})=>{this.events.off(C,N),e?O(e):t&&P({session:t})},N=async e=>{var r,i,s;let o;if(await this.deletePendingAuthRequest(x,{message:"fulfilled",code:0}),e.error){let t=lC("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(A,T),O(e.error.message))}await this.deleteProposal(D.id),this.events.off(A,T);let{cacaos:a,responder:c}=e.result,l=[],h=[];for(let e of a){await ao({cacao:e,projectId:this.client.core.projectId})||(this.client.logger.error(e,"Signature verification failed"),O(lC("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:t}=e,r=ap(t.resources),i=[as(t.iss)],s=an(t.iss);if(r){let e=au(r),t=ad(r);l.push(...e),i.push(...t)}for(let e of i)h.push(`${e}:${s}`)}let u=await this.client.core.crypto.generateSharedKey(w,c.publicKey);l.length>0&&(o={topic:u,acknowledged:!0,self:{publicKey:w,metadata:this.client.metadata},peer:c,controller:c.publicKey,expiry:oc(pC),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:m,namespaces:lP([...new Set(l)],[...new Set(h)]),transportType:n},await this.client.core.relayer.subscribe(u,{transportType:n}),await this.client.session.set(u,o),m&&await this.client.core.pairing.updateMetadata({topic:m,metadata:c.metadata}),o=this.client.session.get(u)),null!=(r=this.client.metadata.redirect)&&r.linkMode&&null!=(i=c.metadata.redirect)&&i.linkMode&&null!=(s=c.metadata.redirect)&&s.universal&&t&&(this.client.core.addLinkModeSupportedApp(c.metadata.redirect.universal),this.client.session.update(u,{transportType:hP.link_mode})),P({auths:a,session:o})};this.events.once(A,T),this.events.once(C,N);try{if(s){let e=l3("wc_sessionAuthenticate",_,x);this.client.core.history.set(m,e);let r=await this.client.core.crypto.encode("",e,{type:2,encoding:lo});i=l_(t,m,r)}else await Promise.all([this.sendRequest({topic:m,method:"wc_sessionAuthenticate",params:_,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:x}),this.sendRequest({topic:m,method:"wc_sessionPropose",params:D,expiry:pT.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:D.id})])}catch(e){throw this.events.off(A,T),this.events.off(C,N),e}return await this.setProposal(D.id,D),await this.setAuthRequest(x,{request:pK(pV({},_),{verifyContext:{}}),pairingTopic:m,transportType:n}),{uri:i??b,response:S}}),pW(this,"approveSessionAuthenticate",async e=>{let t;let{id:r,auths:i}=e,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[hM.authenticated_session_approve_started]}});try{this.isInitialized()}catch(e){throw s.setError(hz.no_internet_connection),e}let n=this.getPendingAuthRequest(r);if(!n)throw s.setError(hz.authenticated_session_pending_request_not_found),Error(`Could not find pending auth request with id ${r}`);let o=n.transportType||hP.relay;o===hP.relay&&await this.confirmOnlineStateOrThrow();let a=n.requester.publicKey,c=await this.client.core.crypto.generateKeyPair(),l=ll(a),h={type:1,receiverPublicKey:a,senderPublicKey:c},u=[],d=[];for(let e of i){if(!await ao({cacao:e,projectId:this.client.core.projectId})){s.setError(hz.invalid_cacao);let e=lC("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:l,error:e,encodeOpts:h}),Error(e.message)}s.addTrace(hM.cacaos_verified);let{p:t}=e,i=ap(t.resources),n=[as(t.iss)],o=an(t.iss);if(i){let e=au(i),t=ad(i);u.push(...e),n.push(...t)}for(let e of n)d.push(`${e}:${o}`)}let p=await this.client.core.crypto.generateSharedKey(c,a);if(s.addTrace(hM.create_authenticated_session_topic),u?.length>0){t={topic:p,acknowledged:!0,self:{publicKey:c,metadata:this.client.metadata},peer:{publicKey:a,metadata:n.requester.metadata},controller:a,expiry:oc(pC),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:n.pairingTopic,namespaces:lP([...new Set(u)],[...new Set(d)]),transportType:o},s.addTrace(hM.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:o})}catch(e){throw s.setError(hz.subscribe_authenticated_session_topic_failure),e}s.addTrace(hM.subscribe_authenticated_session_topic_success),await this.client.session.set(p,t),s.addTrace(hM.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:n.pairingTopic,metadata:n.requester.metadata})}s.addTrace(hM.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:r,result:{cacaos:i,responder:{publicKey:c,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(n.requester.metadata,o)})}catch(e){throw s.setError(hz.authenticated_session_approve_publish_failure),e}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:n.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:t}}),pW(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();let{id:t,reason:r}=e,i=this.getPendingAuthRequest(t);if(!i)throw Error(`Could not find pending auth request with id ${t}`);i.transportType===hP.relay&&await this.confirmOnlineStateOrThrow();let s=i.requester.publicKey,n=await this.client.core.crypto.generateKeyPair(),o=ll(s);await this.sendError({id:t,topic:o,error:r,encodeOpts:{type:1,receiverPublicKey:s,senderPublicKey:n},rpcOpts:pT.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.client.proposal.delete(t,lC("USER_DISCONNECTED"))}),pW(this,"formatAuthMessage",e=>{this.isInitialized();let{request:t,iss:r}=e;return aa(t,r)}),pW(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),pW(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{let t=this.client.core.pairing.pairings.get(e.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(r=>{var i,s;return(null==(i=r.peerMetadata)?void 0:i.url)&&(null==(s=r.peerMetadata)?void 0:s.url)===e.peer.metadata.url&&r.topic&&r.topic!==t.topic});if(0===r.length)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(e){this.client.logger.error(e)}}),pW(this,"deleteSession",async e=>{var t;let{topic:r,expirerHasDeleted:i=!1,emitEvent:s=!0,id:n=0}=e,{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,lC("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(px).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===r&&this.deletePendingSessionRequest(e.id,lC("USER_DISCONNECTED"))}),r===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=pR.idle),s&&this.client.events.emit("session_delete",{id:n,topic:r})}),pW(this,"deleteProposal",async(e,t)=>{if(t)try{let t=this.client.proposal.get(e),r=this.client.core.eventClient.getEvent({topic:t.pairingTopic});r?.setError(h$.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(e,lC("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),pW(this,"deletePendingSessionRequest",async(e,t,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),r&&(this.sessionRequestQueue.state=pR.idle,this.client.events.emit("session_request_expire",{id:e}))}),pW(this,"deletePendingAuthRequest",async(e,t,r=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)])}),pW(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),pW(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,oc(pT.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),pW(this,"setAuthRequest",async(e,t)=>{let{request:r,pairingTopic:i,transportType:s=hP.relay}=t;this.client.core.expirer.set(e,r.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:e,pairingTopic:i,verifyContext:r.verifyContext,transportType:s})}),pW(this,"setPendingSessionRequest",async e=>{let{id:t,topic:r,params:i,verifyContext:s}=e,n=i.request.expiryTimestamp||oc(pT.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,n),await this.client.pendingRequest.set(t,{id:t,topic:r,params:i,verifyContext:s})}),pW(this,"sendRequest",async e=>{let t,i;let{topic:s,method:n,params:o,expiry:a,relayRpcId:c,clientRpcId:l,throwOnFailedPublish:h,appLink:u,tvf:d}=e,p=l3(n,o,l),f=!!u;try{let e=f?lo:ln;t=await this.client.core.crypto.encode(s,p,{encoding:e})}catch(e){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),e}if(pk.includes(n)){let e=lh(JSON.stringify(p)),r=lh(t);i=await this.client.core.verify.register({id:r,decryptedId:e})}let g=pT[n].req;if(g.attestation=i,a&&(g.ttl=a),c&&(g.id=c),this.client.core.history.set(s,p),f){let e=l_(u,s,t);await r.g.Linking.openURL(e,this.client.name)}else{let e=pT[n].req;a&&(e.ttl=a),c&&(e.id=c),e.tvf=pK(pV({},d),{correlationId:p.id}),h?(e.internal=pK(pV({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,t,e)):this.client.core.relayer.publish(s,t,e).catch(e=>this.client.logger.error(e))}return p.id}),pW(this,"sendResult",async e=>{let t,i,s;let{id:n,topic:o,result:a,throwOnFailedPublish:c,encodeOpts:l,appLink:h}=e,u=l5(n,a),d=h&&"u">typeof(null==r.g?void 0:r.g.Linking);try{let e=d?lo:ln;t=await this.client.core.crypto.encode(o,u,pK(pV({},l||{}),{encoding:e}))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${o} failed`),e}try{i=await this.client.core.history.get(o,n);let e=i.request;try{this.shouldSetTVF(e.method,e.params)&&(s=this.getTVFParams(n,e.params,a))}catch(e){this.client.logger.warn("sendResult() -> getTVFParams() failed",e)}}catch(e){throw this.client.logger.error(`sendResult() -> history.get(${o}, ${n}) failed`),e}if(d){let e=l_(h,o,t);await r.g.Linking.openURL(e,this.client.name)}else{let e=i.request.method,r=pT[e].res;r.tvf=pK(pV({},s),{correlationId:n}),c?(r.internal=pK(pV({},r.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,t,r)):this.client.core.relayer.publish(o,t,r).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(u)}),pW(this,"sendError",async e=>{let t,i;let{id:s,topic:n,error:o,encodeOpts:a,rpcOpts:c,appLink:l}=e,h=l6(s,o),u=l&&"u">typeof(null==r.g?void 0:r.g.Linking);try{let e=u?lo:ln;t=await this.client.core.crypto.encode(n,h,pK(pV({},a||{}),{encoding:e}))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),e}try{i=await this.client.core.history.get(n,s)}catch(e){throw this.client.logger.error(`sendError() -> history.get(${n}, ${s}) failed`),e}if(u){let e=l_(l,n,t);await r.g.Linking.openURL(e,this.client.name)}else{let e=i.request.method,r=c||pT[e].res;this.client.core.relayer.publish(n,t,r)}await this.client.core.history.resolve(h)}),pW(this,"cleanup",async()=>{let e=[],t=[];this.client.session.getAll().forEach(t=>{let r=!1;ol(t.expiry)&&(r=!0),this.client.core.crypto.keychain.has(t.topic)||(r=!0),r&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{ol(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),pW(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),pW(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),pW(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===pR.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=pR.active;let e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=pR.idle}),pW(this,"processRequest",async e=>{let{topic:t,payload:r,attestation:i,transportType:s,encryptedId:n}=e,o=r.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:r,attestation:i,encryptedId:n});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,r);case"wc_sessionPing":return await this.onSessionPingRequest(t,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:r,attestation:i,encryptedId:n,transportType:s});case"wc_sessionEvent":return await this.onSessionEventRequest(t,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:r,attestation:i,encryptedId:n,transportType:s});default:return this.client.logger.info(`Unsupported request method ${o}`)}}),pW(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r,transportType:i}=e,s=(await this.client.core.history.get(t,r.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(t,r,i);case"wc_sessionSettle":return this.onSessionSettleResponse(t,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,r);case"wc_sessionExtend":return this.onSessionExtendResponse(t,r);case"wc_sessionPing":return this.onSessionPingResponse(t,r);case"wc_sessionRequest":return this.onSessionRequestResponse(t,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,r);default:return this.client.logger.info(`Unsupported response method ${s}`)}}),pW(this,"onRelayEventUnknownPayload",e=>{let{topic:t}=e,{message:r}=lA("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw Error(r)}),pW(this,"shouldIgnorePairingRequest",e=>{let{topic:t,requestMethod:r}=e,i=this.expectedPairingMethodMap.get(t);return!(!i||i.includes(r))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),pW(this,"onSessionProposeRequest",async e=>{let{topic:t,payload:r,attestation:i,encryptedId:s}=e,{params:n,id:o}=r;try{let e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),e?.setError(hL.proposal_listener_not_found)),this.isValidConnect(pV({},r.params));let a=n.expiryTimestamp||oc(pT.wc_sessionPropose.req.ttl),c=pV({id:o,pairingTopic:t,expiryTimestamp:a},n);await this.setProposal(o,c);let l=await this.getVerifyContext({attestationId:i,hash:lh(JSON.stringify(r)),encryptedId:s,metadata:c.proposer.metadata});e?.addTrace(hB.emit_session_proposal),this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:l})}catch(e){await this.sendError({id:o,topic:t,error:e,rpcOpts:pT.wc_sessionPropose.autoReject}),this.client.logger.error(e)}}),pW(this,"onSessionProposeResponse",async(e,t,r)=>{let{id:i}=t;if(ho(t)){let{result:s}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});let n=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:n});let o=n.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});let a=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:a});let c=await this.client.core.crypto.generateSharedKey(o,a);this.pendingSessions.set(i,{sessionTopic:c,pairingTopic:e,proposalId:i,publicKey:o});let l=await this.client.core.relayer.subscribe(c,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:e})}else if(ha(t)){await this.client.proposal.delete(i,lC("USER_DISCONNECTED"));let e=oh("session_connect",i);if(0===this.events.listenerCount(e))throw Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),pW(this,"onSessionSettleRequest",async(e,t)=>{let{id:r,params:i}=t;try{this.isValidSessionSettleRequest(i);let{relay:r,controller:s,expiry:n,namespaces:o,sessionProperties:a,scopedProperties:c,sessionConfig:l}=t.params,h=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!h)return this.client.logger.error(`Pending session not found for topic ${e}`);let u=this.client.proposal.get(h.proposalId),d=pK(pV(pV(pV({topic:e,relay:r,expiry:n,namespaces:o,acknowledged:!0,pairingTopic:h.pairingTopic,requiredNamespaces:u.requiredNamespaces,optionalNamespaces:u.optionalNamespaces,controller:s.publicKey,self:{publicKey:h.publicKey,metadata:this.client.metadata},peer:{publicKey:s.publicKey,metadata:s.metadata}},a&&{sessionProperties:a}),c&&{scopedProperties:c}),l&&{sessionConfig:l}),{transportType:hP.relay});await this.client.session.set(d.topic,d),await this.setExpiry(d.topic,d.expiry),await this.client.core.pairing.updateMetadata({topic:h.pairingTopic,metadata:d.peer.metadata}),this.client.events.emit("session_connect",{session:d}),this.events.emit(oh("session_connect",h.proposalId),{session:d}),this.pendingSessions.delete(h.proposalId),this.deleteProposal(h.proposalId,!1),this.cleanupDuplicatePairings(d),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),pW(this,"onSessionSettleResponse",async(e,t)=>{let{id:r}=t;ho(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(oh("session_approve",r),{})):ha(t)&&(await this.client.session.delete(e,lC("USER_DISCONNECTED")),this.events.emit(oh("session_approve",r),{error:t.error}))}),pW(this,"onSessionUpdateRequest",async(e,t)=>{let{params:r,id:i}=t;try{let t=`${e}_session_update`,s=lG.get(t);if(s&&this.isRequestOutOfSync(s,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:e,error:lC("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(pV({topic:e},r));try{lG.set(t,i),await this.client.session.update(e,{namespaces:r.namespaces}),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0})}catch(e){throw lG.delete(t),e}this.client.events.emit("session_update",{id:i,topic:e,params:r})}catch(t){await this.sendError({id:i,topic:e,error:t}),this.client.logger.error(t)}}),pW(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),pW(this,"onSessionUpdateResponse",(e,t)=>{let{id:r}=t,i=oh("session_update",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);ho(t)?this.events.emit(oh("session_update",r),{}):ha(t)&&this.events.emit(oh("session_update",r),{error:t.error})}),pW(this,"onSessionExtendRequest",async(e,t)=>{let{id:r}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,oc(pC)),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),pW(this,"onSessionExtendResponse",(e,t)=>{let{id:r}=t,i=oh("session_extend",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);ho(t)?this.events.emit(oh("session_extend",r),{}):ha(t)&&this.events.emit(oh("session_extend",r),{error:t.error})}),pW(this,"onSessionPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),pW(this,"onSessionPingResponse",(e,t)=>{let{id:r}=t,i=oh("session_ping",r);setTimeout(()=>{if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners 2176`);ho(t)?this.events.emit(oh("session_ping",r),{}):ha(t)&&this.events.emit(oh("session_ping",r),{error:t.error})},500)}),pW(this,"onSessionDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(t=>{this.client.core.relayer.once(hI.publish,async()=>{t(await this.deleteSession({topic:e,id:r}))})}),this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:lC("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(e){this.client.logger.error(e)}}),pW(this,"onSessionRequest",async e=>{var t,r,i;let{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=e,{id:l,params:h}=n;try{await this.isValidRequest(pV({topic:s},h));let e=this.client.session.get(s),n=await this.getVerifyContext({attestationId:o,hash:lh(JSON.stringify(l3("wc_sessionRequest",h,l))),encryptedId:a,metadata:e.peer.metadata,transportType:c}),u={id:l,topic:s,params:h,verifyContext:n};await this.setPendingSessionRequest(u),c===hP.link_mode&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(r=e.peer.metadata.redirect)?void 0:r.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(u):(this.addSessionRequestToSessionRequestQueue(u),this.processSessionRequestQueue())}catch(e){await this.sendError({id:l,topic:s,error:e}),this.client.logger.error(e)}}),pW(this,"onSessionRequestResponse",(e,t)=>{let{id:r}=t,i=oh("session_request",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);ho(t)?this.events.emit(oh("session_request",r),{result:t.result}):ha(t)&&this.events.emit(oh("session_request",r),{error:t.error})}),pW(this,"onSessionEventRequest",async(e,t)=>{let{id:r,params:i}=t;try{let t=`${e}_session_event_${i.event.name}`,s=lG.get(t);if(s&&this.isRequestOutOfSync(s,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(pV({topic:e},i)),this.client.events.emit("session_event",{id:r,topic:e,params:i}),lG.set(t,r)}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),pW(this,"onSessionAuthenticateResponse",(e,t)=>{let{id:r}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),ho(t)?this.events.emit(oh("session_request",r),{result:t.result}):ha(t)&&this.events.emit(oh("session_request",r),{error:t.error})}),pW(this,"onSessionAuthenticateRequest",async e=>{var t;let{topic:r,payload:i,attestation:s,encryptedId:n,transportType:o}=e;try{let{requester:e,authPayload:a,expiryTimestamp:c}=i.params,l=await this.getVerifyContext({attestationId:s,hash:lh(JSON.stringify(i)),encryptedId:n,metadata:e.metadata,transportType:o}),h={requester:e,pairingTopic:r,id:i.id,authPayload:a,verifyContext:l,expiryTimestamp:c};await this.setAuthRequest(i.id,{request:h,pairingTopic:r,transportType:o}),o===hP.link_mode&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:i.params,id:i.id,verifyContext:l})}catch(n){this.client.logger.error(n);let e=i.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),s=this.getAppLinkIfEnabled(i.params.requester.metadata,o);await this.sendError({id:i.id,topic:r,error:n,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:t},rpcOpts:pT.wc_sessionAuthenticate.autoReject,appLink:s})}}),pW(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),pW(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=pR.idle,this.processSessionRequestQueue()},(0,v.toMiliseconds)(this.requestQueueDelay))}),pW(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:t})=>{let r=this.client.core.history.pending;r.length>0&&r.filter(t=>t.topic===e&&"wc_sessionRequest"===t.request.method).forEach(e=>{let r=e.request.id,i=oh("session_request",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);this.events.emit(oh("session_request",e.request.id),{error:t})})}),pW(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===pR.active){this.client.logger.info("session request queue is already active.");return}let e=this.sessionRequestQueue.queue[0];if(!e){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=pR.active,this.emitSessionRequest(e)}catch(e){this.client.logger.error(e)}}),pW(this,"emitSessionRequest",e=>{this.client.events.emit("session_request",e)}),pW(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;let t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:l3("wc_sessionPropose",pK(pV({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties}),t.id)})}),pW(this,"isValidConnect",async e=>{let t;if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw Error(t)}let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:n,scopedProperties:o,relays:a}=e;if(lR(r)||await this.isValidPairingTopic(r),t=!1,a?a&&lT(a)&&a.length&&a.forEach(e=>{t=l$(e)}):t=!0,!t){let{message:e}=lA("MISSING_OR_INVALID",`connect() relays: ${a}`);throw Error(e)}if(lR(i)||0===lN(i)||this.validateNamespaces(i,"requiredNamespaces"),lR(s)||0===lN(s)||this.validateNamespaces(s,"optionalNamespaces"),lR(n)||this.validateSessionProps(n,"sessionProperties"),!lR(o)){this.validateSessionProps(o,"scopedProperties");let e=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(o).every(t=>e.includes(t)))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(o)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),pW(this,"validateNamespaces",(e,t)=>{let r=function(e,t,r){let i=null;if(e&&lN(e)){let s;let n=lL(e,t);n&&(i=n);let o=(s=null,Object.entries(e).forEach(([e,i])=>{var n,o;let a;if(s)return;let c=(n=nW(e,i),o=`${t} ${r}`,a=null,lT(n)&&n.length?n.forEach(e=>{a||lU(e)||(a=lC("UNSUPPORTED_CHAINS",`${o}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):lU(e)||(a=lC("UNSUPPORTED_CHAINS",`${o}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),a);c&&(s=c)}),s);o&&(i=o)}else i=lA("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return i}(e,"connect()",t);if(r)throw Error(r.message)}),pW(this,"isValidApprove",async e=>{if(!lM(e))throw Error(lA("MISSING_OR_INVALID",`approve() params: ${e}`).message);let{id:t,namespaces:r,relayProtocol:i,sessionProperties:s,scopedProperties:n}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let o=this.client.proposal.get(t),a=lq(r,"approve()");if(a)throw Error(a.message);let c=lF(o.requiredNamespaces,r,"approve()");if(c)throw Error(c.message);if(!lj(i,!0)){let{message:e}=lA("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw Error(e)}if(lR(s)||this.validateSessionProps(s,"sessionProperties"),!lR(n)){this.validateSessionProps(n,"scopedProperties");let e=new Set(Object.keys(r));if(!Object.keys(n).every(t=>e.has(t)))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(n)}, approved namespaces: ${Array.from(e).join(", ")}`)}}),pW(this,"isValidReject",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`reject() params: ${e}`);throw Error(t)}let{id:t,reason:r}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!r||"object"!=typeof r||!r.code||!lk(r.code,!1)||!r.message||!lj(r.message,!1)){let{message:e}=lA("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw Error(e)}}),pW(this,"isValidSessionSettleRequest",e=>{let t;if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw Error(t)}let{relay:r,controller:i,namespaces:s,expiry:n}=e;if(!l$(r)){let{message:e}=lA("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(e)}let o=(t=null,lj(i?.publicKey,!1)||(t=lA("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),t);if(o)throw Error(o.message);let a=lq(s,"onSessionSettleRequest()");if(a)throw Error(a.message);if(ol(n)){let{message:e}=lA("EXPIRED","onSessionSettleRequest()");throw Error(e)}}),pW(this,"isValidUpdate",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`update() params: ${e}`);throw Error(t)}let{topic:t,namespaces:r}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let i=this.client.session.get(t),s=lq(r,"update()");if(s)throw Error(s.message);let n=lF(i.requiredNamespaces,r,"update()");if(n)throw Error(n.message)}),pW(this,"isValidExtend",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`extend() params: ${e}`);throw Error(t)}let{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),pW(this,"isValidRequest",async e=>{var t;if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`request() params: ${e}`);throw Error(t)}let{topic:r,request:i,chainId:s,expiry:n}=e;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);let{namespaces:o}=this.client.session.get(r);if(!lz(o,s)){let{message:e}=lA("MISSING_OR_INVALID",`request() chainId: ${s}`);throw Error(e)}if(lR(i)||!lj(i.method,!1)){let{message:e}=lA("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw Error(e)}if(!(lj(t=i.method,!1)&&(function(e,t){let r=[];return Object.values(e).forEach(e=>{lI(e.accounts).includes(t)&&r.push(...e.methods)}),r})(o,s).includes(t))){let{message:e}=lA("MISSING_OR_INVALID",`request() method: ${i.method}`);throw Error(e)}if(n&&(!lk(n,!1)||!(n<=pN.max)||!(n>=pN.min))){let{message:e}=lA("MISSING_OR_INVALID",`request() expiry: ${n}. Expiry must be a number (in seconds) between ${pN.min} and ${pN.max}`);throw Error(e)}}),pW(this,"isValidRespond",async e=>{var t;if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`respond() params: ${e}`);throw Error(t)}let{topic:r,response:i}=e;try{await this.isValidSessionTopic(r)}catch(r){throw null!=(t=e?.response)&&t.id&&this.cleanupAfterResponse(e),r}if(lR(i)||lR(i.result)&&lR(i.error)||!lk(i.id,!1)||!lj(i.jsonrpc,!1)){let{message:e}=lA("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw Error(e)}}),pW(this,"isValidPing",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),pW(this,"isValidEmit",async e=>{var t;if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`emit() params: ${e}`);throw Error(t)}let{topic:r,event:i,chainId:s}=e;await this.isValidSessionTopic(r);let{namespaces:n}=this.client.session.get(r);if(!lz(n,s)){let{message:e}=lA("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw Error(e)}if(lR(i)||!lj(i.name,!1)){let{message:e}=lA("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw Error(e)}if(!(lj(t=i.name,!1)&&(function(e,t){let r=[];return Object.values(e).forEach(e=>{lI(e.accounts).includes(t)&&r.push(...e.events)}),r})(n,s).includes(t))){let{message:e}=lA("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw Error(e)}}),pW(this,"isValidDisconnect",async e=>{if(!lM(e)){let{message:t}=lA("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),pW(this,"isValidAuthenticate",e=>{let{chains:t,uri:r,domain:i,nonce:s}=e;if(!Array.isArray(t)||0===t.length)throw Error("chains is required and must be a non-empty array");if(!lj(r,!1))throw Error("uri is required parameter");if(!lj(i,!1))throw Error("domain is required parameter");if(!lj(s,!1))throw Error("nonce is required parameter");if([...new Set(t.map(e=>nK(e).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:n}=nK(t[0]);if("eip155"!==n)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),pW(this,"getVerifyContext",async e=>{let{attestationId:t,hash:r,encryptedId:i,metadata:s,transportType:n}=e,o={verified:{verifyUrl:s.verifyUrl||hj,validation:"UNKNOWN",origin:s.url||""}};try{if(n===hP.link_mode){let e=this.getAppLinkIfEnabled(s,n);return o.verified.validation=e&&new URL(e).origin===new URL(s.url).origin?"VALID":"INVALID",o}let e=await this.client.core.verify.resolve({attestationId:t,hash:r,encryptedId:i,verifyUrl:s.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(e){this.client.logger.warn(e)}return this.client.logger.debug(`Verify context: ${JSON.stringify(o)}`),o}),pW(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((r,i)=>{if(null==r){let{message:s}=lA("MISSING_OR_INVALID",`${t} must contain an existing value for each key. Received: ${r} for key ${Object.keys(e)[i]}`);throw Error(s)}})}),pW(this,"getPendingAuthRequest",e=>{let t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),pW(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0,t=this.recentlyDeletedLimit/2;for(let r of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(r)}}}),pW(this,"checkRecentlyDeleted",e=>{let t=this.recentlyDeletedMap.get(e);if(t){let{message:r}=lA("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw Error(r)}}),pW(this,"isLinkModeEnabled",(e,t)=>{var i,s,n,o,a,c,l,h,u;return!!e&&t===hP.link_mode&&(null==(s=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:s.linkMode)===!0&&(null==(o=null==(n=this.client.metadata)?void 0:n.redirect)?void 0:o.universal)!==void 0&&(null==(c=null==(a=this.client.metadata)?void 0:a.redirect)?void 0:c.universal)!==""&&(null==(l=e?.redirect)?void 0:l.universal)!==void 0&&(null==(h=e?.redirect)?void 0:h.universal)!==""&&(null==(u=e?.redirect)?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&"u">typeof(null==r.g?void 0:r.g.Linking)}),pW(this,"getAppLinkIfEnabled",(e,t)=>{var r;return this.isLinkModeEnabled(e,t)?null==(r=e?.redirect)?void 0:r.universal:void 0}),pW(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;let t=of(e,"topic")||"",r=decodeURIComponent(of(e,"wc_ev")||""),i=this.client.session.keys.includes(t);i&&this.client.session.update(t,{transportType:hP.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:r,sessionExists:i})}),pW(this,"registerLinkModeListeners",async()=>{var e;if(oy()||n5()&&null!=(e=this.client.metadata.redirect)&&e.linkMode){let e=null==r.g?void 0:r.g.Linking;if("u">typeof e){e.addEventListener("url",this.handleLinkModeMessage,this.client.name);let t=await e.getInitialURL();t&&setTimeout(()=>{this.handleLinkModeMessage({url:t})},50)}}}),pW(this,"shouldSetTVF",(e,t)=>{if(!t||"wc_sessionRequest"!==e)return!1;let{request:r}=t;return Object.keys(pj).includes(r.method)}),pW(this,"getTVFParams",(e,t,r)=>{var i,s;try{let n=t.request.method,o=this.extractTxHashesFromResult(n,r);return pK(pV({correlationId:e,rpcMethods:[n],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[null==(s=null==(i=t.request.params)?void 0:i[0])?void 0:s.to]}),{txHashes:o})}catch(e){this.client.logger.warn("Error getting TVF params",e)}return{}}),pW(this,"isValidContractData",e=>{var t;if(!e)return!1;try{let r=e?.data||(null==(t=e?.[0])?void 0:t.data);if(!r.startsWith("0x"))return!1;let i=r.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2==0}catch{}return!1}),pW(this,"extractTxHashesFromResult",(e,t)=>{try{let r=pj[e];if("string"==typeof t)return[t];let i=t[r.key];if(lT(i))return"solana_signAllTransactions"===e?i.map(e=>(function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);let i=r[0];if(0===i)throw Error("No signatures found");if(r.length<1+64*i)throw Error("Transaction data too short for claimed signature count");if(r.length<100)throw Error("Transaction too short");let s=nV.from(e,"base64").slice(1,65);return sm.encode(s)})(e)):i;if("string"==typeof i)return[i]}catch(e){this.client.logger.warn("Error extracting tx hashes from result",e)}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[e,r]of Object.entries(t))for(let t of r)try{await this.onProviderMessageEvent({topic:e,message:t,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${t}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){let{message:e}=lA("NOT_INITIALIZED",this.name);throw Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(hI.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:r,attestation:i,transportType:s}=e,{publicKey:n}=this.client.auth.authKeys.keys.includes(pB)?this.client.auth.authKeys.get(pB):{responseTopic:void 0,publicKey:void 0};try{let e=await this.client.core.crypto.decode(t,r,{receiverPublicKey:n,encoding:s===hP.link_mode?lo:ln});hs(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:i,transportType:s,encryptedId:lh(r)})):hn(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:s}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:s}),await this.client.core.relayer.messages.ack(t,r)}catch(e){this.client.logger.error(e)}}registerExpirerEvents(){this.client.core.expirer.on(hR.expired,async e=>{let{topic:t,id:r}=oa(e.target);return r&&this.client.pendingRequest.keys.includes(r)?await this.deletePendingSessionRequest(r,lA("EXPIRED"),!0):r&&this.client.auth.requests.keys.includes(r)?await this.deletePendingAuthRequest(r,lA("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r})))})}registerPairingEvents(){this.client.core.pairing.events.on(hT.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(hT.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!lj(e,!1)){let{message:t}=lA("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=lA("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(ol(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=lA("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}async isValidSessionTopic(e){if(!lj(e,!1)){let{message:t}=lA("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=lA("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw Error(t)}if(ol(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=lA("EXPIRED",`session topic: ${e}`);throw Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=lA("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(lj(e,!1)){let{message:t}=lA("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw Error(t)}else{let{message:t}=lA("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw Error(t)}}async isValidProposalId(e){if("number"!=typeof e){let{message:t}=lA("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=lA("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw Error(t)}if(ol(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=lA("EXPIRED",`proposal id: ${e}`);throw Error(t)}}}class pY extends dQ{constructor(e,t){super(e,t,"proposal",pP),this.core=e,this.logger=t}}class pJ extends dQ{constructor(e,t){super(e,t,"session",pP),this.core=e,this.logger=t}}class pZ extends dQ{constructor(e,t){super(e,t,"request",pP,e=>e.id),this.core=e,this.logger=t}}class pQ extends dQ{constructor(e,t){super(e,t,"authKeys",pU,()=>pB),this.core=e,this.logger=t}}class pX extends dQ{constructor(e,t){super(e,t,"pairingTopics",pU),this.core=e,this.logger=t}}class p0 extends dQ{constructor(e,t){super(e,t,"requests",pU,e=>e.id),this.core=e,this.logger=t}}var p1=Object.defineProperty,p2=(e,t,r)=>t in e?p1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,p8=(e,t,r)=>p2(e,"symbol"!=typeof t?t+"":t,r);class p3{constructor(e,t){this.core=e,this.logger=t,p8(this,"authKeys"),p8(this,"pairingTopics"),p8(this,"requests"),this.authKeys=new pQ(this.core,this.logger),this.pairingTopics=new pX(this.core,this.logger),this.requests=new p0(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var p5=Object.defineProperty,p6=(e,t,r)=>t in e?p5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,p4=(e,t,r)=>p6(e,"symbol"!=typeof t?t+"":t,r);class p9 extends eH{constructor(e){super(e),p4(this,"protocol","wc"),p4(this,"version",2),p4(this,"name",pO.name),p4(this,"metadata"),p4(this,"core"),p4(this,"logger"),p4(this,"events",new b.EventEmitter),p4(this,"engine"),p4(this,"session"),p4(this,"proposal"),p4(this,"pendingRequest"),p4(this,"auth"),p4(this,"signConfig"),p4(this,"on",(e,t)=>this.events.on(e,t)),p4(this,"once",(e,t)=>this.events.once(e,t)),p4(this,"off",(e,t)=>this.events.off(e,t)),p4(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),p4(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),p4(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"update",async e=>{try{return await this.engine.update(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"request",async e=>{try{return await this.engine.request(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"find",e=>{try{return this.engine.find(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),p4(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),p4(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),this.name=e?.name||pO.name,this.metadata=function(e){var t,r;let i=n7();try{return null!=e&&e.url&&i.url&&e.url!==i.url&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),e.url=i.url),null!=(t=e?.icons)&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>""!==e)),n2(n1(n1({},i),e),{url:e?.url||i.url,name:e?.name||i.name,description:e?.description||i.description,icons:null!=(r=e?.icons)&&r.length&&e.icons.length>0?e.icons:i.icons})}catch(t){return console.warn("Error populating app metadata",t),e||i}}(e?.metadata),this.signConfig=e?.signConfig;let t="u">typeof e?.logger&&"string"!=typeof e?.logger?e.logger:es()(eE({level:e?.logger||pO.logger}));this.core=e?.core||new pD(e),this.logger=eI(t,this.name),this.session=new pJ(this.core,this.logger),this.proposal=new pY(this.core,this.logger),this.pendingRequest=new pZ(this.core,this.logger),this.engine=new pG(this),this.auth=new p3(this.core,this.logger)}static async init(e){let t=new p9(e);return await t.initialize(),t}get context(){return e_(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,v.toMiliseconds)(v.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var p7=r(71795),fe=r.n(p7),ft=Object.defineProperty,fr=Object.defineProperties,fi=Object.getOwnPropertyDescriptors,fs=Object.getOwnPropertySymbols,fn=Object.prototype.hasOwnProperty,fo=Object.prototype.propertyIsEnumerable,fa=(e,t,r)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fc=(e,t)=>{for(var r in t||(t={}))fn.call(t,r)&&fa(e,r,t[r]);if(fs)for(var r of fs(t))fo.call(t,r)&&fa(e,r,t[r]);return e},fl=(e,t)=>fr(e,fi(t));let fh={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class fu{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new b.EventEmitter,this.isAvailable=!1,this.registering=!1,!ht(e))throw Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{let t=W(e),r=await (await fe()(this.url,fl(fc({},fh),{body:t}))).json();this.onPayload({data:r})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!ht(e))throw Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){let e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((e,t)=>{this.events.once("register_error",e=>{this.resetMaxListeners(),t(e)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return t(Error("HTTP connection is missing or invalid"));e()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){let t=W({id:1,jsonrpc:"2.0",method:"test",params:[]});await fe()(e,fl(fc({},fh),{body:t}))}this.onOpen()}catch(t){let e=this.parseError(t);throw this.events.emit("register_error",e),this.onClose(),e}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;let t="string"==typeof e.data?K(e.data):e.data;this.events.emit("payload",t)}onError(e,t){let r=this.parseError(t),i=r.message||r.toString(),s=l6(e,i);this.events.emit("payload",s)}parseError(e,t=this.url){return l0(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}}var fd=r(27669).Buffer;let fp="error",ff="wc@2:universal_provider:",fg="https://rpc.walletconnect.org/v1/",fy="generic",fm=`${fg}bundler`,fb={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function fw(){}function fv(e){return null==e||"object"!=typeof e&&"function"!=typeof e}function fE(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function f_(e){return"object"==typeof e&&null!==e}function fI(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function fD(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let fS="[object String]",fP="[object Number]",fO="[object Boolean]",fx="[object Arguments]";function fA(e,t,r,i=new Map,s){let n=s?.(e,t,r,i);if(null!=n)return n;if(fv(e))return e;if(i.has(e))return i.get(e);if(Array.isArray(e)){let t=Array(e.length);i.set(e,t);for(let n=0;n<e.length;n++)t[n]=fA(e[n],n,r,i,s);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;for(let[n,o]of(i.set(e,t),e))t.set(n,fA(o,n,r,i,s));return t}if(e instanceof Set){let t=new Set;for(let n of(i.set(e,t),e))t.add(fA(n,void 0,r,i,s));return t}if("u">typeof fd&&fd.isBuffer(e))return e.subarray();if(fE(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);i.set(e,t);for(let n=0;n<e.length;n++)t[n]=fA(e[n],n,r,i,s);return t}if(e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return i.set(e,t),fC(t,e,r,i,s),t}if("u">typeof File&&e instanceof File){let t=new File([e],e.name,{type:e.type});return i.set(e,t),fC(t,e,r,i,s),t}if(e instanceof Blob){let t=new Blob([e],{type:e.type});return i.set(e,t),fC(t,e,r,i,s),t}if(e instanceof Error){let t=new e.constructor;return i.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,fC(t,e,r,i,s),t}if("object"==typeof e&&function(e){switch(fD(e)){case fx:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case fO:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case fP:case"[object Object]":case"[object RegExp]":case"[object Set]":case fS:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(e)){let t=Object.create(Object.getPrototypeOf(e));return i.set(e,t),fC(t,e,r,i,s),t}return e}function fC(e,t,r=e,i,s){let n=[...Object.keys(t),...fI(t)];for(let o=0;o<n.length;o++){let a=n[o],c=Object.getOwnPropertyDescriptor(e,a);(null==c||c.writable)&&(e[a]=fA(t[a],a,r,i,s))}}function fT(e){return fA(e,void 0,e,new Map,(t,r,i,s)=>{let n=void 0;if(null!=n)return n;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case fP:case fS:case fO:{let t=new e.constructor(e?.valueOf());return fC(t,e),t}case fx:{let t={};return fC(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}function fN(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===fD(e)}var fR=Object.defineProperty,fj=Object.defineProperties,fk=Object.getOwnPropertyDescriptors,fU=Object.getOwnPropertySymbols,fB=Object.prototype.hasOwnProperty,fL=Object.prototype.propertyIsEnumerable,fq=(e,t,r)=>t in e?fR(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f$=(e,t)=>{for(var r in t||(t={}))fB.call(t,r)&&fq(e,r,t[r]);if(fU)for(var r of fU(t))fL.call(t,r)&&fq(e,r,t[r]);return e},fM=(e,t)=>fj(e,fk(t));function fz(e,t,r){var i;let s=nK(e);return(null==(i=t.rpcMap)?void 0:i[s.reference])||`${fg}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function fF(e){return e.includes(":")?e.split(":")[1]:e}function fH(e){return e.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function fV(e={},t={}){let r=fK(e),i=fK(t);return function(e,...t){return function(e,...t){let r=t.slice(0,-1),i=t[t.length-1],s=e;for(let e=0;e<r.length;e++){let t=r[e];s=function e(t,r,i,s){if(fv(t)&&(t=Object(t)),null==r||"object"!=typeof r)return t;if(s.has(r))return function(e){if(fv(e))return e;if(Array.isArray(e)||fE(e)||e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),r=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new r(e);if(e instanceof RegExp){let t=new r(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new r(e.buffer.slice(0));if(e instanceof Error){let t=new r(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}if("u">typeof File&&e instanceof File)return new r([e],e.name,{type:e.type,lastModified:e.lastModified});if("object"==typeof e){let r=Object.create(t);return Object.assign(r,e)}return e}(s.get(r));if(s.set(r,t),Array.isArray(r)){r=r.slice();for(let e=0;e<r.length;e++)r[e]=r[e]??void 0}let n=[...Object.keys(r),...fI(r)];for(let o=0;o<n.length;o++){let a=n[o],c=r[a],l=t[a];if(fN(c)&&(c={...c}),fN(l)&&(l={...l}),"u">typeof fd&&fd.isBuffer(c)&&(c=fT(c)),Array.isArray(c)){if("object"==typeof l&&null!=l){let e=[],t=Reflect.ownKeys(l);for(let r=0;r<t.length;r++){let i=t[r];e[i]=l[i]}l=e}else l=[]}let h=i(l,c,a,t,r,s);null!=h?t[a]=h:Array.isArray(c)||f_(l)&&f_(c)?t[a]=e(l,c,i,s):null==l&&function(e){if("object"!=typeof e||null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){let t=e[Symbol.toStringTag];return!!(null!=t&&Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable)&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(c)?t[a]=e({},c,i,s):null==l&&fE(c)?t[a]=fT(c):(void 0===l||void 0!==c)&&(t[a]=c)}return t}(s,t,i,new Map)}return s}(e,...t,fw)}(r,i)}function fK(e){var t,r,i,s;let n={};if(!lN(e))return n;for(let[o,a]of Object.entries(e)){let e=lD(o)?[o]:a.chains,c=a.methods||[],l=a.events||[],h=a.rpcMap||{},u=lS(o);n[u]=fM(f$(f$({},n[u]),a),{chains:ou(e,null==(t=n[u])?void 0:t.chains),methods:ou(c,null==(r=n[u])?void 0:r.methods),events:ou(l,null==(i=n[u])?void 0:i.events),rpcMap:f$(f$({},h),null==(s=n[u])?void 0:s.rpcMap)})}return n}function fW(e){return e.includes(":")?e.split(":")[2]:e}function fG(e){let t={};for(let[r,i]of Object.entries(e)){let e=i.methods||[],s=i.events||[],n=i.accounts||[],o=lD(r)?[r]:i.chains?i.chains:fH(i.accounts);t[r]={chains:o,methods:e,events:s,accounts:n}}return t}function fY(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):isNaN(Number(e=e.includes(":")?e.split(":")[1]:e))?e:Number(e)}let fJ={},fZ=e=>fJ[e],fQ=(e,t)=>{fJ[e]=t};var fX=Object.defineProperty,f0=(e,t,r)=>t in e?fX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f1=(e,t,r)=>f0(e,"symbol"!=typeof t?t+"":t,r);class f2{constructor(e){f1(this,"name","polkadot"),f1(this,"client"),f1(this,"httpProviders"),f1(this,"events"),f1(this,"namespace"),f1(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=fF(t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var f8=Object.defineProperty,f3=Object.defineProperties,f5=Object.getOwnPropertyDescriptors,f6=Object.getOwnPropertySymbols,f4=Object.prototype.hasOwnProperty,f9=Object.prototype.propertyIsEnumerable,f7=(e,t,r)=>t in e?f8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ge=(e,t)=>{for(var r in t||(t={}))f4.call(t,r)&&f7(e,r,t[r]);if(f6)for(var r of f6(t))f9.call(t,r)&&f7(e,r,t[r]);return e},gt=(e,t)=>f3(e,f5(t)),gr=(e,t,r)=>f7(e,"symbol"!=typeof t?t+"":t,r);class gi{constructor(e){gr(this,"name","eip155"),gr(this,"client"),gr(this,"chainId"),gr(this,"namespace"),gr(this,"httpProviders"),gr(this,"events"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){let r=t||fz(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=parseInt(fF(t));e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(){let e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,r;let i=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;let s=parseInt(i,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:null==(r=this.namespace.chains)?void 0:r[0]}),this.setDefaultChain(`${s}`);else throw Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,r,i;let s=null==(r=null==(t=e.request)?void 0:t.params)?void 0:r[0];if(!s)throw Error("Missing address parameter in `wallet_getCapabilities` request");let n=this.client.session.get(e.topic),o=(null==(i=n?.sessionProperties)?void 0:i.capabilities)||{};if(null!=o&&o[s])return o?.[s];let a=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:gt(ge({},n.sessionProperties||{}),{capabilities:gt(ge({},o||{}),{[s]:a})})})}catch(e){console.warn("Failed to update session with capabilities",e)}return a}async getCallStatus(e){var t,r;let i=this.client.session.get(e.topic),s=null==(t=i.sessionProperties)?void 0:t.bundler_name;if(s){let t=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(t,e)}catch(e){console.warn("Failed to fetch call status from bundler",e,t)}}let n=null==(r=i.sessionProperties)?void 0:r.bundler_url;if(n)try{return await this.getUserOperationReceipt(n,e)}catch(e){console.warn("Failed to fetch call status from custom bundler",e,n)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var r;let i=new URL(e),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l3("eth_getUserOperationReceipt",[null==(r=t.request.params)?void 0:r[0]]))});if(!s.ok)throw Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,t){return`${fm}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var gs=Object.defineProperty,gn=(e,t,r)=>t in e?gs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,go=(e,t,r)=>gn(e,"symbol"!=typeof t?t+"":t,r);class ga{constructor(e){go(this,"name","solana"),go(this,"client"),go(this,"httpProviders"),go(this,"events"),go(this,"namespace"),go(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=fF(t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var gc=Object.defineProperty,gl=(e,t,r)=>t in e?gc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gh=(e,t,r)=>gl(e,"symbol"!=typeof t?t+"":t,r);class gu{constructor(e){gh(this,"name","cosmos"),gh(this,"client"),gh(this,"httpProviders"),gh(this,"events"),gh(this,"namespace"),gh(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=fF(t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var gd=Object.defineProperty,gp=(e,t,r)=>t in e?gd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gf=(e,t,r)=>gp(e,"symbol"!=typeof t?t+"":t,r);class gg{constructor(e){gf(this,"name","algorand"),gf(this,"client"),gf(this,"httpProviders"),gf(this,"events"),gf(this,"namespace"),gf(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){let r=t||fz(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new hc(new fu(r,fZ("disableProviderPing")))}}var gy=Object.defineProperty,gm=(e,t,r)=>t in e?gy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gb=(e,t,r)=>gm(e,"symbol"!=typeof t?t+"":t,r);class gw{constructor(e){gb(this,"name","cip34"),gb(this,"client"),gb(this,"httpProviders"),gb(this,"events"),gb(this,"namespace"),gb(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let r=this.getCardanoRPCUrl(t),i=fF(t);e[i]=this.createHttpProvider(i,r)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){let t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||this.getCardanoRPCUrl(e);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var gv=Object.defineProperty,gE=(e,t,r)=>t in e?gv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g_=(e,t,r)=>gE(e,"symbol"!=typeof t?t+"":t,r);class gI{constructor(e){g_(this,"name","elrond"),g_(this,"client"),g_(this,"httpProviders"),g_(this,"events"),g_(this,"namespace"),g_(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=fF(t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var gD=Object.defineProperty,gS=(e,t,r)=>t in e?gD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gP=(e,t,r)=>gS(e,"symbol"!=typeof t?t+"":t,r);class gO{constructor(e){gP(this,"name","multiversx"),gP(this,"client"),gP(this,"httpProviders"),gP(this,"events"),gP(this,"namespace"),gP(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=fF(t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var gx=Object.defineProperty,gA=(e,t,r)=>t in e?gx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gC=(e,t,r)=>gA(e,"symbol"!=typeof t?t+"":t,r);class gT{constructor(e){gC(this,"name","near"),gC(this,"client"),gC(this,"httpProviders"),gC(this,"events"),gC(this,"namespace"),gC(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let r=t||fz(`${this.name}:${e}`,this.namespace);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace);return typeof r>"u"?void 0:new hc(new fu(r,fZ("disableProviderPing")))}}var gN=Object.defineProperty,gR=(e,t,r)=>t in e?gN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gj=(e,t,r)=>gR(e,"symbol"!=typeof t?t+"":t,r);class gk{constructor(e){gj(this,"name","tezos"),gj(this,"client"),gj(this,"httpProviders"),gj(this,"events"),gj(this,"namespace"),gj(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let r=t||fz(`${this.name}:${e}`,this.namespace);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace);return typeof r>"u"?void 0:new hc(new fu(r))}}var gU=Object.defineProperty,gB=(e,t,r)=>t in e?gU(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gL=(e,t,r)=>gB(e,"symbol"!=typeof t?t+"":t,r);class gq{constructor(e){gL(this,"name",fy),gL(this,"client"),gL(this,"httpProviders"),gL(this,"events"),gL(this,"namespace"),gL(this,"chainId"),this.namespace=e.namespace,this.events=fZ("events"),this.client=fZ("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(fb.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;let r={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{let t=nK(e);r[`${t.namespace}:${t.reference}`]=this.createHttpProvider(e)}),r}getHttpProvider(e){let t=this.httpProviders[e];if(typeof t>"u")throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||fz(e,this.namespace,this.client.core.projectId);if(!r)throw Error(`No RPC url provided for chainId: ${e}`);return new hc(new fu(r,fZ("disableProviderPing")))}}var g$=Object.defineProperty,gM=Object.defineProperties,gz=Object.getOwnPropertyDescriptors,gF=Object.getOwnPropertySymbols,gH=Object.prototype.hasOwnProperty,gV=Object.prototype.propertyIsEnumerable,gK=(e,t,r)=>t in e?g$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gW=(e,t)=>{for(var r in t||(t={}))gH.call(t,r)&&gK(e,r,t[r]);if(gF)for(var r of gF(t))gV.call(t,r)&&gK(e,r,t[r]);return e},gG=(e,t)=>gM(e,gz(t)),gY=(e,t,r)=>gK(e,"symbol"!=typeof t?t+"":t,r);class gJ{constructor(e){gY(this,"client"),gY(this,"namespaces"),gY(this,"optionalNamespaces"),gY(this,"sessionProperties"),gY(this,"scopedProperties"),gY(this,"events",new(w())),gY(this,"rpcProviders",{}),gY(this,"session"),gY(this,"providerOpts"),gY(this,"logger"),gY(this,"uri"),gY(this,"disableProviderPing",!1),this.providerOpts=e,this.logger="u">typeof e?.logger&&"string"!=typeof e?.logger?e.logger:es()(eE({level:e?.logger||fp})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let t=new gJ(e);return await t.initialize(),t}async request(e,t,r){let[i,s]=this.validateChain(t);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(i).request({request:gW({},e),chainId:`${i}:${s}`,topic:this.session.topic,expiry:r})}sendAsync(e,t,r,i){let s=new Date().getTime();this.request(e,r,i).then(e=>t(null,l5(s,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:lC("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:r,response:i}=await this.client.authenticate(e,t);r&&(this.uri=r,this.events.emit("display_uri",r));let s=await i();if(this.session=s.session,this.session){let e=fG(this.session.namespaces);this.namespaces=fV(this.namespaces,e),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));let i=await r();this.session=i;let s=fG(i.namespaces);return this.namespaces=fV(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[r,i]=this.validateChain(e),s=this.getProvider(r);s.name===fy?s.setDefaultChain(`${r}:${i}`,t):s.setDefaultChain(i,t)}catch(e){if(!/Please call connect/.test(e.message))throw e}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");let t=this.client.pairing.getAll();if(lT(t)){for(let r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await p9.init({core:this.providerOpts.core,logger:this.providerOpts.logger||fp,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error("Failed to get session",r),Error(`The provided session: ${null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic} doesn't exist in the Sign client`)}else{let e=this.client.session.getAll();this.session=e[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(e=>lS(e)))];fQ("client",this.client),fQ("events",this.events),fQ("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;let t=function(e,t){let r=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!r.length)return[];let i=[];return r.forEach(e=>{let r=t.namespaces[e].accounts;i.push(...r)}),i}(e,this.session),r=fH(t),i=fV(this.namespaces,this.optionalNamespaces),s=gG(gW({},i[e]),{accounts:t,chains:r});switch(e){case"eip155":this.rpcProviders[e]=new gi({namespace:s});break;case"algorand":this.rpcProviders[e]=new gg({namespace:s});break;case"solana":this.rpcProviders[e]=new ga({namespace:s});break;case"cosmos":this.rpcProviders[e]=new gu({namespace:s});break;case"polkadot":this.rpcProviders[e]=new f2({namespace:s});break;case"cip34":this.rpcProviders[e]=new gw({namespace:s});break;case"elrond":this.rpcProviders[e]=new gI({namespace:s});break;case"multiversx":this.rpcProviders[e]=new gO({namespace:s});break;case"near":this.rpcProviders[e]=new gT({namespace:s});break;case"tezos":this.rpcProviders[e]=new gk({namespace:s});break;default:this.rpcProviders[fy]?this.rpcProviders[fy].updateNamespace(s):this.rpcProviders[fy]=new gq({namespace:s})}})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;let{topic:r}=e;r===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;let{params:r,topic:i}=e;if(i!==(null==(t=this.session)?void 0:t.topic))return;let{event:s}=r;if("accountsChanged"===s.name){let e=s.data;e&&lT(e)&&this.events.emit("accountsChanged",e.map(fW))}else if("chainChanged"===s.name){let e=r.chainId,t=r.event.data,i=lS(e),s=fY(e)!==fY(t)?`${i}:${fY(t)}`:e;this.onChainChanged(s)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r,i;if(e!==(null==(r=this.session)?void 0:r.topic))return;let{namespaces:s}=t,n=null==(i=this.client)?void 0:i.session.get(e);this.session=gG(gW({},n),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",gG(gW({},lC("USER_DISCONNECTED")),{data:e.topic})))}),this.on(fb.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[fy]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){let{namespaces:t,optionalNamespaces:r,sessionProperties:i,scopedProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),r&&Object.keys(r).length&&(this.optionalNamespaces=r),this.sessionProperties=i,this.scopedProperties=s}validateChain(e){let[t,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map(e=>lS(e)).includes(t))throw Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];let i=lS(Object.keys(this.namespaces)[0]),s=this.rpcProviders[i].getDefaultChain();return[i,s]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;let[r,i]=this.validateChain(e);if(!i)return;this.updateNamespaceChain(r,i),this.events.emit("chainChanged",i);let s=this.getProvider(r).getDefaultChain();t||this.getProvider(r).setDefaultChain(i),this.emitAccountsChangedOnChainChange({namespace:r,previousChainId:s,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:r}){var i,s;try{if(t===r)return;let n=null==(s=null==(i=this.session)?void 0:i.namespaces[e])?void 0:s.accounts;if(!n)return;let o=n.filter(e=>e.includes(`${r}:`)).map(fW);if(!lT(o))return;this.events.emit("accountsChanged",o)}catch(e){this.logger.warn("Failed to emit accountsChanged on chain change",e)}}updateNamespaceChain(e,t){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${t}`;this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=t):this.namespaces[r]={chains:[],methods:[],events:[],defaultChain:t}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var r;let i=(null==(r=this.session)?void 0:r.topic)||"";await this.client.core.storage.setItem(`${ff}/${e}${i}`,t)}async getFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${ff}/${e}${r}`)}async deleteFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${ff}/${e}${r}`)}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;let t=await this.client.core.storage.getKeys();for(let e of t)e.startsWith(ff)&&await this.client.core.storage.removeItem(e)}catch(e){this.logger.warn("Failed to cleanup storage",e)}}}let gZ=gJ},90224:function(e,t){"use strict";function r(e){let t;return"undefined"!=typeof window&&void 0!==window[e]&&(t=window[e]),t}function i(e){let t=r(e);if(!t)throw Error(`${e} is not defined in Window`);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalStorage=t.getLocalStorageOrThrow=t.getCrypto=t.getCryptoOrThrow=t.getLocation=t.getLocationOrThrow=t.getNavigator=t.getNavigatorOrThrow=t.getDocument=t.getDocumentOrThrow=t.getFromWindowOrThrow=t.getFromWindow=void 0,t.getFromWindow=r,t.getFromWindowOrThrow=i,t.getDocumentOrThrow=function(){return i("document")},t.getDocument=function(){return r("document")},t.getNavigatorOrThrow=function(){return i("navigator")},t.getNavigator=function(){return r("navigator")},t.getLocationOrThrow=function(){return i("location")},t.getLocation=function(){return r("location")},t.getCryptoOrThrow=function(){return i("crypto")},t.getCrypto=function(){return r("crypto")},t.getLocalStorageOrThrow=function(){return i("localStorage")},t.getLocalStorage=function(){return r("localStorage")}},45261:function(e,t,r){"use strict";t.D=void 0;let i=r(90224);t.D=function(){let e,t,r;try{e=i.getDocumentOrThrow(),t=i.getLocationOrThrow()}catch(e){return null}function s(...t){let r=e.getElementsByTagName("meta");for(let e=0;e<r.length;e++){let i=r[e],s=["itemprop","property","name"].map(e=>i.getAttribute(e)).filter(e=>!!e&&t.includes(e));if(s.length&&s){let e=i.getAttribute("content");if(e)return e}}return""}let n=((r=s("name","og:site_name","og:title","twitter:title"))||(r=e.title),r),o=function(){let e=s("description","og:description","twitter:description","keywords");return e}(),a=t.origin,c=function(){let r=e.getElementsByTagName("link"),i=[];for(let e=0;e<r.length;e++){let s=r[e],n=s.getAttribute("rel");if(n&&n.toLowerCase().indexOf("icon")>-1){let e=s.getAttribute("href");if(e){if(-1===e.toLowerCase().indexOf("https:")&&-1===e.toLowerCase().indexOf("http:")&&0!==e.indexOf("//")){let r=t.protocol+"//"+t.host;if(0===e.indexOf("/"))r+=e;else{let i=t.pathname.split("/");i.pop();let s=i.join("/");r+=s+"/"+e}i.push(r)}else if(0===e.indexOf("//")){let r=t.protocol+e;i.push(r)}else i.push(e)}}}return i}();return{description:o,url:a,icons:c,name:n}}},71795:function(e,t,r){var i="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g,s=function(){function e(){this.fetch=!1,this.DOMException=i.DOMException}return e.prototype=i,new e}();(function(e){var t=void 0!==s&&s||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},i={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(i.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i.iterable&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function u(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(TypeError("Already read"));e.bodyUsed=!0}}function d(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=d(t);return t.readAsArrayBuffer(e),r}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this.bodyUsed=this.bodyUsed,this._bodyInit=e,e){if("string"==typeof e)this._bodyText=e;else if(i.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else{var t;i.arrayBuffer&&i.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||o(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e)}}else this._noBody=!0,this._bodyText="";!this.headers.get("content-type")&&("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(!this._bodyFormData)return Promise.resolve(new Blob([this._bodyText]));throw Error("could not read FormData body as blob")}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return u(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(i.blob)return this.blob().then(p);throw Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,i,s,n=u(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=d(t=new FileReader),s=(i=/charset=([A-Za-z0-9_-]+)/.exec(e.type))?i[1]:"utf-8",t.readAsText(e,s),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=Array(t.length),i=0;i<t.length;i++)r[i]=String.fromCharCode(t[i]);return r.join("")}(this._bodyArrayBuffer));if(!this._bodyFormData)return Promise.resolve(this._bodyText);throw Error("could not read FormData body as text")},i.formData&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=a(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[a(e)]},h.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},h.prototype.set=function(e,t){this.map[a(e)]=c(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),l(e)},h.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),l(e)},h.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),l(e)},i.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var y=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function m(e,r){if(!(this instanceof m))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var i,s,n=(r=r||{}).body;if(e instanceof m){if(e.bodyUsed)throw TypeError("Already read");this.url=e.url,this.credentials=e.credentials,r.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=r.credentials||this.credentials||"same-origin",(r.headers||!this.headers)&&(this.headers=new h(r.headers)),this.method=(s=(i=r.method||this.method||"GET").toUpperCase(),y.indexOf(s)>-1?s:i),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal||function(){if("AbortController"in t)return new AbortController().signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),("GET"===this.method||"HEAD"===this.method)&&("no-store"===r.cache||"no-cache"===r.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+new Date().getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+new Date().getTime()}}function b(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),i=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(s))}}),t}function w(e,t){if(!(this instanceof w))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},g.call(m.prototype),g.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var v=[301,302,303,307,308];w.redirect=function(e,t){if(-1===v.indexOf(t))throw RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function E(r,s){return new Promise(function(n,o){var l=new m(r,s);if(l.signal&&l.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var u=new XMLHttpRequest;function d(){u.abort()}if(u.onload=function(){var e,t,r={statusText:u.statusText,headers:(e=u.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),i=r.shift().trim();if(i){var s=r.join(":").trim();try{t.append(i,s)}catch(e){console.warn("Response "+e.message)}}}),t)};0===l.url.indexOf("file://")&&(u.status<200||u.status>599)?r.status=200:r.status=u.status,r.url="responseURL"in u?u.responseURL:r.headers.get("X-Request-URL");var i="response"in u?u.response:u.responseText;setTimeout(function(){n(new w(i,r))},0)},u.onerror=function(){setTimeout(function(){o(TypeError("Network request failed"))},0)},u.ontimeout=function(){setTimeout(function(){o(TypeError("Network request timed out"))},0)},u.onabort=function(){setTimeout(function(){o(new e.DOMException("Aborted","AbortError"))},0)},u.open(l.method,function(e){try{return""===e&&t.location.href?t.location.href:e}catch(t){return e}}(l.url),!0),"include"===l.credentials?u.withCredentials=!0:"omit"===l.credentials&&(u.withCredentials=!1),"responseType"in u&&(i.blob?u.responseType="blob":i.arrayBuffer&&(u.responseType="arraybuffer")),s&&"object"==typeof s.headers&&!(s.headers instanceof h||t.Headers&&s.headers instanceof t.Headers)){var p=[];Object.getOwnPropertyNames(s.headers).forEach(function(e){p.push(a(e)),u.setRequestHeader(e,c(s.headers[e]))}),l.headers.forEach(function(e,t){-1===p.indexOf(t)&&u.setRequestHeader(t,e)})}else l.headers.forEach(function(e,t){u.setRequestHeader(t,e)});l.signal&&(l.signal.addEventListener("abort",d),u.onreadystatechange=function(){4===u.readyState&&l.signal.removeEventListener("abort",d)}),u.send(void 0===l._bodyInit?null:l._bodyInit)})}E.polyfill=!0,t.fetch||(t.fetch=E,t.Headers=h,t.Request=m,t.Response=w),e.Headers=h,e.Request=m,e.Response=w,e.fetch=E,Object.defineProperty(e,"__esModule",{value:!0})})({}),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var n=i.fetch?i:s;(t=n.fetch).default=n.fetch,t.fetch=n.fetch,t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response,e.exports=t},66252:function(e){"use strict";function t(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,r,i){var s=i&&i.stringify||t;if("object"==typeof e&&null!==e){var n=r.length+1;if(1===n)return e;var o=Array(n);o[0]=s(e);for(var a=1;a<n;a++)o[a]=s(r[a]);return o.join(" ")}if("string"!=typeof e)return e;var c=r.length;if(0===c)return e;for(var l="",h=0,u=-1,d=e&&e.length||0,p=0;p<d;){if(37===e.charCodeAt(p)&&p+1<d){switch(u=u>-1?u:0,e.charCodeAt(p+1)){case 100:case 102:if(h>=c||null==r[h])break;u<p&&(l+=e.slice(u,p)),l+=Number(r[h]),u=p+2,p++;break;case 105:if(h>=c||null==r[h])break;u<p&&(l+=e.slice(u,p)),l+=Math.floor(Number(r[h])),u=p+2,p++;break;case 79:case 111:case 106:if(h>=c||void 0===r[h])break;u<p&&(l+=e.slice(u,p));var f=typeof r[h];if("string"===f){l+="'"+r[h]+"'",u=p+2,p++;break}if("function"===f){l+=r[h].name||"<anonymous>",u=p+2,p++;break}l+=s(r[h]),u=p+2,p++;break;case 115:if(h>=c)break;u<p&&(l+=e.slice(u,p)),l+=String(r[h]),u=p+2,p++;break;case 37:u<p&&(l+=e.slice(u,p)),l+="%",u=p+2,p++,h--}++h}++p}return -1===u?e:(u<d&&(l+=e.slice(u)),l)}},69032:function(e){"use strict";e.exports=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},60554:function(e,t,r){"use strict";let i=r(66252);e.exports=n;let s=function(){function e(e){return void 0!==e&&e}try{if("undefined"!=typeof globalThis)return globalThis;return Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{};function n(e){var t;(e=e||{}).browser=e.browser||{};let r=e.browser.transmit;if(r&&"function"!=typeof r.send)throw Error("pino: transmit option must have a send function");let i=e.browser.write||s;e.browser.write&&(e.browser.asObject=!0);let h=e.serializers||{},u=function(e,t){if(Array.isArray(e)){let t=e.filter(function(e){return"!stdSerializers.err"!==e});return t}return!0===e&&Object.keys(t)}(e.browser.serialize,h),g=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(g=!1),"function"==typeof i&&(i.error=i.fatal=i.warn=i.info=i.debug=i.trace=i),!1===e.enabled&&(e.level="silent");let y=e.level||"info",m=Object.create(i);m.log||(m.log=d),Object.defineProperty(m,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(m,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,o(b,m,"error","log"),o(b,m,"fatal","error"),o(b,m,"warn","error"),o(b,m,"info","log"),o(b,m,"debug","log"),o(b,m,"trace","log")}});let b={transmit:r,serialize:u,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:"function"==typeof(t=e).timestamp?t.timestamp:!1===t.timestamp?p:f};return m.levels=n.levels,m.level=y,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=d,m.serializers=h,m._serialize=u,m._stdErrSerialize=g,m.child=function(t,i){if(!t)throw Error("missing bindings for child Pino");i=i||{},u&&t.serializers&&(i.serializers=t.serializers);let s=i.serializers;if(u&&s){var n=Object.assign({},h,s),o=!0===e.browser.serialize?Object.keys(n):u;delete t.serializers,a([t],o,n,this._stdErrSerialize)}function d(e){this._childLevel=(0|e._childLevel)+1,this.error=c(e,t,"error"),this.fatal=c(e,t,"fatal"),this.warn=c(e,t,"warn"),this.info=c(e,t,"info"),this.debug=c(e,t,"debug"),this.trace=c(e,t,"trace"),n&&(this.serializers=n,this._serialize=o),r&&(this._logEvent=l([].concat(e._logEvent.bindings,t)))}return d.prototype=this,new d(this)},r&&(m._logEvent=l()),m}function o(e,t,r,o){let c=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?d:c[r]?c[r]:s[r]||s[o]||d,function(e,t,r){if(e.transmit||t[r]!==d){var o;t[r]=(o=t[r],function(){let c=e.timestamp(),h=Array(arguments.length),u=Object.getPrototypeOf&&Object.getPrototypeOf(this)===s?s:this;for(var d=0;d<h.length;d++)h[d]=arguments[d];if(e.serialize&&!e.asObject&&a(h,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?o.call(u,function(e,t,r,s){e._serialize&&a(r,e._serialize,e.serializers,e._stdErrSerialize);let o=r.slice(),c=o[0],l={};s&&(l.time=s),l.level=n.levels.values[t];let h=(0|e._childLevel)+1;if(h<1&&(h=1),null!==c&&"object"==typeof c){for(;h--&&"object"==typeof o[0];)Object.assign(l,o.shift());c=o.length?i(o.shift(),o):void 0}else"string"==typeof c&&(c=i(o.shift(),o));return void 0!==c&&(l.msg=c),l}(this,r,h,c)):o.apply(u,h),e.transmit){let i=e.transmit.level||t.level,s=n.levels.values[i],o=n.levels.values[r];if(o<s)return;(function(e,t,r){let i=t.send,s=t.ts,n=t.methodLevel,o=t.methodValue,c=t.val,h=e._logEvent.bindings;a(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=r.filter(function(e){return -1===h.indexOf(e)}),e._logEvent.level.label=n,e._logEvent.level.value=o,i(n,e._logEvent,c),e._logEvent=l(h)})(this,{ts:c,methodLevel:r,methodValue:o,transmitLevel:i,transmitValue:n.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},h)}})}}(e,t,r)}function a(e,t,r,i){for(let s in e)if(i&&e[s]instanceof Error)e[s]=n.stdSerializers.err(e[s]);else if("object"==typeof e[s]&&!Array.isArray(e[s]))for(let i in e[s])t&&t.indexOf(i)>-1&&i in r&&(e[s][i]=r[i](e[s][i]))}function c(e,t,r){return function(){let i=Array(1+arguments.length);i[0]=t;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return e[r].apply(this,i)}}function l(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function h(){return{}}function u(e){return e}function d(){}function p(){return!1}function f(){return Date.now()}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers={mapHttpRequest:h,mapHttpResponse:h,wrapRequestSerializer:u,wrapResponseSerializer:u,wrapErrorSerializer:u,req:h,res:h,err:function(e){let t={type:e.constructor.name,msg:e.message,stack:e.stack};for(let r in e)void 0===t[r]&&(t[r]=e[r]);return t}},n.stdTimeFunctions=Object.assign({},{nullTime:p,epochTime:f,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}})},16870:function(e,t,r){"use strict";function i(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function s(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function n(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");i(e.outputLen),i(e.blockLen)}function o(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function a(e,t){s(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}r.d(t,{$h:function(){return o},eB:function(){return a},gk:function(){return s},k8:function(){return i},z3:function(){return n}})},25949:function(e,t,r){"use strict";r.d(t,{kb:function(){return d},l1:function(){return l},eV:function(){return u},GL:function(){return o},iA:function(){return c},O6:function(){return f},np:function(){return a},O0:function(){return h},Jq:function(){return n},hE:function(){return p}});let i="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;var s=r(16870);function n(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function o(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function a(e,t){return e<<32-t|e>>>t}let c=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function l(e){for(let r=0;r<e.length;r++){var t;e[r]=(t=e[r])<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}}function h(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}(e)),(0,s.gk)(e),e}function u(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];(0,s.gk)(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let s=e[t];r.set(s,i),i+=s.length}return r}class d{clone(){return this._cloneInto()}}function p(e){let t=t=>e().update(h(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function f(e=32){if(i&&"function"==typeof i.getRandomValues)return i.getRandomValues(new Uint8Array(e));if(i&&"function"==typeof i.randomBytes)return i.randomBytes(e);throw Error("crypto.getRandomValues must be defined")}}}]);